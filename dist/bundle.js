var bluegenesProteinVisualizer=function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=6)}([function(t,e){t.exports=window.React},function(t,e,r){var n,i,a;i=[],void 0===(a="function"==typeof(n=function(){var t,e,r,n,i,a,o,s,u,l,h,c,d,f,_,m,v,p,g,b,A,y,S,R,C,w,E,T,x,M,F,D,V,I,P,L,O,N,B,k,z,q;return t=function(){var t={};if(!e)var e=1e-6;if(!r)var r="undefined"!=typeof Float32Array?Float32Array:Array;if(!n)var n=Math.random;var i={setMatrixArrayType:function(t){r=t}};t.glMatrix=i;var a,o={create:function(){var t=new r(3);return t[0]=0,t[1]=0,t[2]=0,t},clone:function(t){var e=new r(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},fromValues:function(t,e,n){var i=new r(3);return i[0]=t,i[1]=e,i[2]=n,i},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},set:function(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t},add:function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},subtract:function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}};o.sub=o.subtract,o.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t},o.mul=o.multiply,o.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t},o.div=o.divide,o.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t},o.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t},o.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},o.scaleAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t},o.distance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(r*r+n*n+i*i)},o.dist=o.distance,o.squaredDistance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return r*r+n*n+i*i},o.sqrDist=o.squaredDistance,o.length=function(t){var e=t[0],r=t[1],n=t[2];return Math.sqrt(e*e+r*r+n*n)},o.len=o.length,o.squaredLength=function(t){var e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n},o.sqrLen=o.squaredLength,o.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},o.normalize=function(t,e){var r=e[0],n=e[1],i=e[2],a=r*r+n*n+i*i;return a>0&&(a=1/Math.sqrt(a),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a),t},o.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},o.cross=function(t,e,r){var n=e[0],i=e[1],a=e[2],o=r[0],s=r[1],u=r[2];return t[0]=i*u-a*s,t[1]=a*o-n*u,t[2]=n*s-i*o,t},o.lerp=function(t,e,r,n){var i=e[0],a=e[1],o=e[2];return t[0]=i+n*(r[0]-i),t[1]=a+n*(r[1]-a),t[2]=o+n*(r[2]-o),t},o.random=function(t,e){e=e||1;var r=2*n()*Math.PI,i=2*n()-1,a=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(r)*a,t[1]=Math.sin(r)*a,t[2]=i*e,t},o.transformMat4=function(t,e,r){var n=e[0],i=e[1],a=e[2];return t[0]=r[0]*n+r[4]*i+r[8]*a+r[12],t[1]=r[1]*n+r[5]*i+r[9]*a+r[13],t[2]=r[2]*n+r[6]*i+r[10]*a+r[14],t},o.transformMat3=function(t,e,r){var n=e[0],i=e[1],a=e[2];return t[0]=n*r[0]+i*r[3]+a*r[6],t[1]=n*r[1]+i*r[4]+a*r[7],t[2]=n*r[2]+i*r[5]+a*r[8],t},o.transformQuat=function(t,e,r){var n=e[0],i=e[1],a=e[2],o=r[0],s=r[1],u=r[2],l=r[3],h=l*n+s*a-u*i,c=l*i+u*n-o*a,d=l*a+o*i-s*n,f=-o*n-s*i-u*a;return t[0]=h*l+f*-o+c*-u-d*-s,t[1]=c*l+f*-s+d*-o-h*-u,t[2]=d*l+f*-u+h*-s-c*-o,t},o.forEach=(a=o.create(),function(t,e,r,n,i,o){var s,u;for(e||(e=3),r||(r=0),u=n?Math.min(n*e+r,t.length):t.length,s=r;s<u;s+=e)a[0]=t[s],a[1]=t[s+1],a[2]=t[s+2],i(a,a,o),t[s]=a[0],t[s+1]=a[1],t[s+2]=a[2];return t}),o.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},t.vec3=o;var s={create:function(){var t=new r(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},clone:function(t){var e=new r(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},fromValues:function(t,e,n,i){var a=new r(4);return a[0]=t,a[1]=e,a[2]=n,a[3]=i,a},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},set:function(t,e,r,n,i){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t},add:function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},subtract:function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}};s.sub=s.subtract,s.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t},s.mul=s.multiply,s.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t},s.div=s.divide,s.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t},s.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t},s.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},s.scaleAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t},s.distance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2],a=e[3]-t[3];return Math.sqrt(r*r+n*n+i*i+a*a)},s.dist=s.distance,s.squaredDistance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2],a=e[3]-t[3];return r*r+n*n+i*i+a*a},s.sqrDist=s.squaredDistance,s.length=function(t){var e=t[0],r=t[1],n=t[2],i=t[3];return Math.sqrt(e*e+r*r+n*n+i*i)},s.len=s.length,s.squaredLength=function(t){var e=t[0],r=t[1],n=t[2],i=t[3];return e*e+r*r+n*n+i*i},s.sqrLen=s.squaredLength,s.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},s.normalize=function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=r*r+n*n+i*i+a*a;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t[3]=e[3]*o),t},s.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},s.lerp=function(t,e,r,n){var i=e[0],a=e[1],o=e[2],s=e[3];return t[0]=i+n*(r[0]-i),t[1]=a+n*(r[1]-a),t[2]=o+n*(r[2]-o),t[3]=s+n*(r[3]-s),t},s.random=function(t,e){return e=e||1,t[0]=n(),t[1]=n(),t[2]=n(),t[3]=n(),s.normalize(t,t),s.scale(t,t,e),t},s.transformMat4=function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*a+r[12]*o,t[1]=r[1]*n+r[5]*i+r[9]*a+r[13]*o,t[2]=r[2]*n+r[6]*i+r[10]*a+r[14]*o,t[3]=r[3]*n+r[7]*i+r[11]*a+r[15]*o,t},s.transformQuat=function(t,e,r){var n=e[0],i=e[1],a=e[2],o=r[0],s=r[1],u=r[2],l=r[3],h=l*n+s*a-u*i,c=l*i+u*n-o*a,d=l*a+o*i-s*n,f=-o*n-s*i-u*a;return t[0]=h*l+f*-o+c*-u-d*-s,t[1]=c*l+f*-s+d*-o-h*-u,t[2]=d*l+f*-u+h*-s-c*-o,t},s.forEach=function(){var t=s.create();return function(e,r,n,i,a,o){var s,u;for(r||(r=4),n||(n=0),u=i?Math.min(i*r+n,e.length):e.length,s=n;s<u;s+=r)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],a(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}(),s.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},t.vec4=s;var u={create:function(){var t=new r(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromMat4:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},clone:function(t){var e=new r(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},transpose:function(t,e){if(t===e){var r=e[1],n=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},invert:function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],h=e[8],c=h*o-s*l,d=-h*a+s*u,f=l*a-o*u,_=r*c+n*d+i*f;return _?(_=1/_,t[0]=c*_,t[1]=(-h*n+i*l)*_,t[2]=(s*n-i*o)*_,t[3]=d*_,t[4]=(h*r-i*u)*_,t[5]=(-s*r+i*a)*_,t[6]=f*_,t[7]=(-l*r+n*u)*_,t[8]=(o*r-n*a)*_,t):null},adjoint:function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],h=e[8];return t[0]=o*h-s*l,t[1]=i*l-n*h,t[2]=n*s-i*o,t[3]=s*u-a*h,t[4]=r*h-i*u,t[5]=i*a-r*s,t[6]=a*l-o*u,t[7]=n*u-r*l,t[8]=r*o-n*a,t},determinant:function(t){var e=t[0],r=t[1],n=t[2],i=t[3],a=t[4],o=t[5],s=t[6],u=t[7],l=t[8];return e*(l*a-o*u)+r*(-l*i+o*s)+n*(u*i-a*s)},multiply:function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],h=e[7],c=e[8],d=r[0],f=r[1],_=r[2],m=r[3],v=r[4],p=r[5],g=r[6],b=r[7],A=r[8];return t[0]=d*n+f*o+_*l,t[1]=d*i+f*s+_*h,t[2]=d*a+f*u+_*c,t[3]=m*n+v*o+p*l,t[4]=m*i+v*s+p*h,t[5]=m*a+v*u+p*c,t[6]=g*n+b*o+A*l,t[7]=g*i+b*s+A*h,t[8]=g*a+b*u+A*c,t}};u.mul=u.multiply,u.translate=function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],h=e[7],c=e[8],d=r[0],f=r[1];return t[0]=n,t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=d*n+f*o+l,t[7]=d*i+f*s+h,t[8]=d*a+f*u+c,t},u.rotate=function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],h=e[7],c=e[8],d=Math.sin(r),f=Math.cos(r);return t[0]=f*n+d*o,t[1]=f*i+d*s,t[2]=f*a+d*u,t[3]=f*o-d*n,t[4]=f*s-d*i,t[5]=f*u-d*a,t[6]=l,t[7]=h,t[8]=c,t},u.fromQuat=function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=r+r,s=n+n,u=i+i,l=r*o,h=r*s,c=r*u,d=n*s,f=n*u,_=i*u,m=a*o,v=a*s,p=a*u;return t[0]=1-(d+_),t[3]=h+p,t[6]=c-v,t[1]=h-p,t[4]=1-(l+_),t[7]=f+m,t[2]=c+v,t[5]=f-m,t[8]=1-(l+d),t},u.normalFromMat4=function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],h=e[8],c=e[9],d=e[10],f=e[11],_=e[12],m=e[13],v=e[14],p=e[15],g=r*s-n*o,b=r*u-i*o,A=r*l-a*o,y=n*u-i*s,S=n*l-a*s,R=i*l-a*u,C=h*m-c*_,w=h*v-d*_,E=h*p-f*_,T=c*v-d*m,x=c*p-f*m,M=d*p-f*v,F=g*M-b*x+A*T+y*E-S*w+R*C;return F?(F=1/F,t[0]=(s*M-u*x+l*T)*F,t[1]=(u*E-o*M-l*w)*F,t[2]=(o*x-s*E+l*C)*F,t[3]=(i*x-n*M-a*T)*F,t[4]=(r*M-i*E+a*w)*F,t[5]=(n*E-r*x-a*C)*F,t[6]=(m*R-v*S+p*y)*F,t[7]=(v*A-_*R-p*b)*F,t[8]=(_*S-m*A+p*g)*F,t):null},u.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},t.mat3=u;var l={create:function(){var t=new r(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromValues:function(t,e,n,i,a,o,s,u,l,h,c,d,f,_,m,v){var p=new r(16);return p[0]=t,p[1]=e,p[2]=n,p[3]=i,p[4]=a,p[5]=o,p[6]=s,p[7]=u,p[8]=l,p[9]=h,p[10]=c,p[11]=d,p[12]=f,p[13]=_,p[14]=m,p[15]=v,p},clone:function(t){var e=new r(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},transpose:function(t,e){if(t===e){var r=e[1],n=e[2],i=e[3],a=e[6],o=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=a,t[11]=e[14],t[12]=i,t[13]=o,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},invert:function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],h=e[8],c=e[9],d=e[10],f=e[11],_=e[12],m=e[13],v=e[14],p=e[15],g=r*s-n*o,b=r*u-i*o,A=r*l-a*o,y=n*u-i*s,S=n*l-a*s,R=i*l-a*u,C=h*m-c*_,w=h*v-d*_,E=h*p-f*_,T=c*v-d*m,x=c*p-f*m,M=d*p-f*v,F=g*M-b*x+A*T+y*E-S*w+R*C;return F?(F=1/F,t[0]=(s*M-u*x+l*T)*F,t[1]=(i*x-n*M-a*T)*F,t[2]=(m*R-v*S+p*y)*F,t[3]=(d*S-c*R-f*y)*F,t[4]=(u*E-o*M-l*w)*F,t[5]=(r*M-i*E+a*w)*F,t[6]=(v*A-_*R-p*b)*F,t[7]=(h*R-d*A+f*b)*F,t[8]=(o*x-s*E+l*C)*F,t[9]=(n*E-r*x-a*C)*F,t[10]=(_*S-m*A+p*g)*F,t[11]=(c*A-h*S-f*g)*F,t[12]=(s*w-o*T-u*C)*F,t[13]=(r*T-n*w+i*C)*F,t[14]=(m*b-_*y-v*g)*F,t[15]=(h*y-c*b+d*g)*F,t):null},adjoint:function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],h=e[8],c=e[9],d=e[10],f=e[11],_=e[12],m=e[13],v=e[14],p=e[15];return t[0]=s*(d*p-f*v)-c*(u*p-l*v)+m*(u*f-l*d),t[1]=-(n*(d*p-f*v)-c*(i*p-a*v)+m*(i*f-a*d)),t[2]=n*(u*p-l*v)-s*(i*p-a*v)+m*(i*l-a*u),t[3]=-(n*(u*f-l*d)-s*(i*f-a*d)+c*(i*l-a*u)),t[4]=-(o*(d*p-f*v)-h*(u*p-l*v)+_*(u*f-l*d)),t[5]=r*(d*p-f*v)-h*(i*p-a*v)+_*(i*f-a*d),t[6]=-(r*(u*p-l*v)-o*(i*p-a*v)+_*(i*l-a*u)),t[7]=r*(u*f-l*d)-o*(i*f-a*d)+h*(i*l-a*u),t[8]=o*(c*p-f*m)-h*(s*p-l*m)+_*(s*f-l*c),t[9]=-(r*(c*p-f*m)-h*(n*p-a*m)+_*(n*f-a*c)),t[10]=r*(s*p-l*m)-o*(n*p-a*m)+_*(n*l-a*s),t[11]=-(r*(s*f-l*c)-o*(n*f-a*c)+h*(n*l-a*s)),t[12]=-(o*(c*v-d*m)-h*(s*v-u*m)+_*(s*d-u*c)),t[13]=r*(c*v-d*m)-h*(n*v-i*m)+_*(n*d-i*c),t[14]=-(r*(s*v-u*m)-o*(n*v-i*m)+_*(n*u-i*s)),t[15]=r*(s*d-u*c)-o*(n*d-i*c)+h*(n*u-i*s),t},determinant:function(t){var e=t[0],r=t[1],n=t[2],i=t[3],a=t[4],o=t[5],s=t[6],u=t[7],l=t[8],h=t[9],c=t[10],d=t[11],f=t[12],_=t[13],m=t[14],v=t[15];return(e*o-r*a)*(c*v-d*m)-(e*s-n*a)*(h*v-d*_)+(e*u-i*a)*(h*m-c*_)+(r*s-n*o)*(l*v-d*f)-(r*u-i*o)*(l*m-c*f)+(n*u-i*s)*(l*_-h*f)},multiply:function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],h=e[7],c=e[8],d=e[9],f=e[10],_=e[11],m=e[12],v=e[13],p=e[14],g=e[15],b=r[0],A=r[1],y=r[2],S=r[3];return t[0]=b*n+A*s+y*c+S*m,t[1]=b*i+A*u+y*d+S*v,t[2]=b*a+A*l+y*f+S*p,t[3]=b*o+A*h+y*_+S*g,b=r[4],A=r[5],y=r[6],S=r[7],t[4]=b*n+A*s+y*c+S*m,t[5]=b*i+A*u+y*d+S*v,t[6]=b*a+A*l+y*f+S*p,t[7]=b*o+A*h+y*_+S*g,b=r[8],A=r[9],y=r[10],S=r[11],t[8]=b*n+A*s+y*c+S*m,t[9]=b*i+A*u+y*d+S*v,t[10]=b*a+A*l+y*f+S*p,t[11]=b*o+A*h+y*_+S*g,b=r[12],A=r[13],y=r[14],S=r[15],t[12]=b*n+A*s+y*c+S*m,t[13]=b*i+A*u+y*d+S*v,t[14]=b*a+A*l+y*f+S*p,t[15]=b*o+A*h+y*_+S*g,t},fromMat3:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=0,t[4]=e[3],t[5]=e[4],t[6]=e[5],t[7]=0,t[8]=e[6],t[9]=e[7],t[10]=e[8],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}};l.mul=l.multiply,l.translate=function(t,e,r){var n,i,a,o,s,u,l,h,c,d,f,_,m=r[0],v=r[1],p=r[2];return e===t?(t[12]=e[0]*m+e[4]*v+e[8]*p+e[12],t[13]=e[1]*m+e[5]*v+e[9]*p+e[13],t[14]=e[2]*m+e[6]*v+e[10]*p+e[14],t[15]=e[3]*m+e[7]*v+e[11]*p+e[15]):(n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],h=e[7],c=e[8],d=e[9],f=e[10],_=e[11],t[0]=n,t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=l,t[7]=h,t[8]=c,t[9]=d,t[10]=f,t[11]=_,t[12]=n*m+s*v+c*p+e[12],t[13]=i*m+u*v+d*p+e[13],t[14]=a*m+l*v+f*p+e[14],t[15]=o*m+h*v+_*p+e[15]),t},l.scale=function(t,e,r){var n=r[0],i=r[1],a=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},l.rotate=function(t,r,n,i){var a,o,s,u,l,h,c,d,f,_,m,v,p,g,b,A,y,S,R,C,w,E,T,x,M=i[0],F=i[1],D=i[2],V=Math.sqrt(M*M+F*F+D*D);return Math.abs(V)<e?null:(M*=V=1/V,F*=V,D*=V,a=Math.sin(n),s=1-(o=Math.cos(n)),u=r[0],l=r[1],h=r[2],c=r[3],d=r[4],f=r[5],_=r[6],m=r[7],v=r[8],p=r[9],g=r[10],b=r[11],A=M*M*s+o,y=F*M*s+D*a,S=D*M*s-F*a,R=M*F*s-D*a,C=F*F*s+o,w=D*F*s+M*a,E=M*D*s+F*a,T=F*D*s-M*a,x=D*D*s+o,t[0]=u*A+d*y+v*S,t[1]=l*A+f*y+p*S,t[2]=h*A+_*y+g*S,t[3]=c*A+m*y+b*S,t[4]=u*R+d*C+v*w,t[5]=l*R+f*C+p*w,t[6]=h*R+_*C+g*w,t[7]=c*R+m*C+b*w,t[8]=u*E+d*T+v*x,t[9]=l*E+f*T+p*x,t[10]=h*E+_*T+g*x,t[11]=c*E+m*T+b*x,r!==t&&(t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t)},l.rotateX=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],h=e[9],c=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*i+l*n,t[5]=o*i+h*n,t[6]=s*i+c*n,t[7]=u*i+d*n,t[8]=l*i-a*n,t[9]=h*i-o*n,t[10]=c*i-s*n,t[11]=d*i-u*n,t},l.rotateY=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[0],o=e[1],s=e[2],u=e[3],l=e[8],h=e[9],c=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i-l*n,t[1]=o*i-h*n,t[2]=s*i-c*n,t[3]=u*i-d*n,t[8]=a*n+l*i,t[9]=o*n+h*i,t[10]=s*n+c*i,t[11]=u*n+d*i,t},l.rotateZ=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[0],o=e[1],s=e[2],u=e[3],l=e[4],h=e[5],c=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i+l*n,t[1]=o*i+h*n,t[2]=s*i+c*n,t[3]=u*i+d*n,t[4]=l*i-a*n,t[5]=h*i-o*n,t[6]=c*i-s*n,t[7]=d*i-u*n,t},l.fromRotationTranslation=function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=n+n,u=i+i,l=a+a,h=n*s,c=n*u,d=n*l,f=i*u,_=i*l,m=a*l,v=o*s,p=o*u,g=o*l;return t[0]=1-(f+m),t[1]=c+g,t[2]=d-p,t[3]=0,t[4]=c-g,t[5]=1-(h+m),t[6]=_+v,t[7]=0,t[8]=d+p,t[9]=_-v,t[10]=1-(h+f),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},l.fromQuat=function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=r+r,s=n+n,u=i+i,l=r*o,h=r*s,c=r*u,d=n*s,f=n*u,_=i*u,m=a*o,v=a*s,p=a*u;return t[0]=1-(d+_),t[1]=h+p,t[2]=c-v,t[3]=0,t[4]=h-p,t[5]=1-(l+_),t[6]=f+m,t[7]=0,t[8]=c+v,t[9]=f-m,t[10]=1-(l+d),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},l.frustum=function(t,e,r,n,i,a,o){var s=1/(r-e),u=1/(i-n),l=1/(a-o);return t[0]=2*a*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*a*u,t[6]=0,t[7]=0,t[8]=(r+e)*s,t[9]=(i+n)*u,t[10]=(o+a)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*a*2*l,t[15]=0,t},l.perspective=function(t,e,r,n,i){var a=1/Math.tan(e/2),o=1/(n-i);return t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(i+n)*o,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*i*n*o,t[15]=0,t},l.ortho=function(t,e,r,n,i,a,o){var s=1/(e-r),u=1/(n-i),l=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+r)*s,t[13]=(i+n)*u,t[14]=(o+a)*l,t[15]=1,t},l.lookAt=function(t,r,n,i){var a,o,s,u,h,c,d,f,_,m,v=r[0],p=r[1],g=r[2],b=i[0],A=i[1],y=i[2],S=n[0],R=n[1],C=n[2];return Math.abs(v-S)<e&&Math.abs(p-R)<e&&Math.abs(g-C)<e?l.identity(t):(d=v-S,f=p-R,_=g-C,a=A*(_*=m=1/Math.sqrt(d*d+f*f+_*_))-y*(f*=m),o=y*(d*=m)-b*_,s=b*f-A*d,(m=Math.sqrt(a*a+o*o+s*s))?(a*=m=1/m,o*=m,s*=m):(a=0,o=0,s=0),u=f*s-_*o,h=_*a-d*s,c=d*o-f*a,(m=Math.sqrt(u*u+h*h+c*c))?(u*=m=1/m,h*=m,c*=m):(u=0,h=0,c=0),t[0]=a,t[1]=u,t[2]=d,t[3]=0,t[4]=o,t[5]=h,t[6]=f,t[7]=0,t[8]=s,t[9]=c,t[10]=_,t[11]=0,t[12]=-(a*v+o*p+s*g),t[13]=-(u*v+h*p+c*g),t[14]=-(d*v+f*p+_*g),t[15]=1,t)},l.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},t.mat4=l;var h,c,d,f,_,m={create:function(){var t=new r(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}};return m.rotationTo=(h=o.create(),c=o.fromValues(1,0,0),d=o.fromValues(0,1,0),function(t,e,r){var n=o.dot(e,r);return n<-.999999?(o.cross(h,c,e),o.length(h)<1e-6&&o.cross(h,d,e),o.normalize(h,h),m.setAxisAngle(t,h,Math.PI),t):n>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(o.cross(h,e,r),t[0]=h[0],t[1]=h[1],t[2]=h[2],t[3]=1+n,m.normalize(t,t))}),m.setAxes=(f=u.create(),function(t,e,r,n){return f[0]=r[0],f[3]=r[1],f[6]=r[2],f[1]=n[0],f[4]=n[1],f[7]=n[2],f[2]=e[0],f[5]=e[1],f[8]=e[2],m.normalize(t,m.fromMat3(t,f))}),m.clone=s.clone,m.fromValues=s.fromValues,m.copy=s.copy,m.set=s.set,m.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},m.setAxisAngle=function(t,e,r){r*=.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t},m.add=s.add,m.multiply=function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=r[0],u=r[1],l=r[2],h=r[3];return t[0]=n*h+o*s+i*l-a*u,t[1]=i*h+o*u+a*s-n*l,t[2]=a*h+o*l+n*u-i*s,t[3]=o*h-n*s-i*u-a*l,t},m.mul=m.multiply,m.scale=s.scale,m.rotateX=function(t,e,r){r*=.5;var n=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(r),u=Math.cos(r);return t[0]=n*u+o*s,t[1]=i*u+a*s,t[2]=a*u-i*s,t[3]=o*u-n*s,t},m.rotateY=function(t,e,r){r*=.5;var n=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(r),u=Math.cos(r);return t[0]=n*u-a*s,t[1]=i*u+o*s,t[2]=a*u+n*s,t[3]=o*u-i*s,t},m.rotateZ=function(t,e,r){r*=.5;var n=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(r),u=Math.cos(r);return t[0]=n*u+i*s,t[1]=i*u-n*s,t[2]=a*u+o*s,t[3]=o*u-a*s,t},m.calculateW=function(t,e){var r=e[0],n=e[1],i=e[2];return t[0]=r,t[1]=n,t[2]=i,t[3]=-Math.sqrt(Math.abs(1-r*r-n*n-i*i)),t},m.dot=s.dot,m.lerp=s.lerp,m.slerp=function(t,e,r,n){var i,a,o,s,u,l=e[0],h=e[1],c=e[2],d=e[3],f=r[0],_=r[1],m=r[2],v=r[3];return(a=l*f+h*_+c*m+d*v)<0&&(a=-a,f=-f,_=-_,m=-m,v=-v),1-a>1e-6?(i=Math.acos(a),o=Math.sin(i),s=Math.sin((1-n)*i)/o,u=Math.sin(n*i)/o):(s=1-n,u=n),t[0]=s*l+u*f,t[1]=s*h+u*_,t[2]=s*c+u*m,t[3]=s*d+u*v,t},m.invert=function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=r*r+n*n+i*i+a*a,s=o?1/o:0;return t[0]=-r*s,t[1]=-n*s,t[2]=-i*s,t[3]=a*s,t},m.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},m.length=s.length,m.len=m.length,m.squaredLength=s.squaredLength,m.sqrLen=m.squaredLength,m.normalize=s.normalize,m.fromMat3=(_="undefined"!=typeof Int8Array?new Int8Array([1,2,0]):[1,2,0],function(t,e){var r,n=e[0]+e[4]+e[8];if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[7]-e[5])*r,t[1]=(e[2]-e[6])*r,t[2]=(e[3]-e[1])*r;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var a=_[i],o=_[a];r=Math.sqrt(e[3*i+i]-e[3*a+a]-e[3*o+o]+1),t[i]=.5*r,r=.5/r,t[3]=(e[3*o+a]-e[3*a+o])*r,t[a]=(e[3*a+i]+e[3*i+a])*r,t[o]=(e[3*o+i]+e[3*i+o])*r}return t}),m.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},t.quat=m,t}(),e=function(){var e=t.vec4,r={rgb:{}},n=r.rgb;r.rgb.create=e.create,r.rgb.scale=e.scale,r.rgb.copy=e.copy,r.rgb.fromValues=e.fromValues,r.rgb.mix=function(t,e,r,n){var i=1-n;return t[0]=e[0]*n+r[0]*i,t[1]=e[1]*n+r[1]*i,t[2]=e[2]*n+r[2]*i,t[3]=e[3]*n+r[3]*i,t};var i={white:n.fromValues(1,1,1,1),black:n.fromValues(0,0,0,1),grey:n.fromValues(.5,.5,.5,1),lightgrey:n.fromValues(.8,.8,.8,1),darkgrey:n.fromValues(.3,.3,.3,1),red:n.fromValues(1,0,0,1),darkred:n.fromValues(.5,0,0,1),lightred:n.fromValues(1,.5,.5,1),green:n.fromValues(0,1,0,1),darkgreen:n.fromValues(0,.5,0,1),lightgreen:n.fromValues(.5,1,.5,1),blue:n.fromValues(0,0,1,1),darkblue:n.fromValues(0,0,.5,1),lightblue:n.fromValues(.5,.5,1,1),yellow:n.fromValues(1,1,0,1),darkyellow:n.fromValues(.5,.5,0,1),lightyellow:n.fromValues(1,1,.5,1),cyan:n.fromValues(0,1,1,1),darkcyan:n.fromValues(0,.5,.5,1),lightcyan:n.fromValues(.5,1,1,1),magenta:n.fromValues(1,0,1,1),darkmagenta:n.fromValues(.5,0,.5,1),lightmagenta:n.fromValues(1,.5,1,1),orange:n.fromValues(1,.5,0,1),darkorange:n.fromValues(.5,.25,0,1),lightorange:n.fromValues(1,.75,.5,1)};function a(t,e){this._colors=t;for(var n=0;n<this._colors.length;++n)this._colors[n]=r.forceRGB(this._colors[n]);this._stops=e}r.hex2rgb=function(t){var e,r,i,a;return 4===t.length||5===t.length?(e=parseInt(t[1],16),r=parseInt(t[2],16),i=parseInt(t[3],16),a=15,5===t.length&&(a=parseInt(t[4],16)),n.fromValues(1/15*e,1/15*r,1/15*i,1/15*a)):7===t.length||9===t.length?(e=parseInt(t.substr(1,2),16),r=parseInt(t.substr(3,2),16),i=parseInt(t.substr(5,2),16),a=255,9===t.length&&(a=parseInt(t.substr(7,2),16)),n.fromValues(1/255*e,1/255*r,1/255*i,1/255*a)):void 0},r.setColorPalette=function(t){console.log("setting colors"),i=t,r.initGradients()},r.forceRGB=function(t){if("string"==typeof t){var e=i[t];if(void 0!==e)return e;if(t.length>0&&"#"===t[0])return r.hex2rgb(t)}return 3===t.length?[t[0],t[1],t[2],1]:t},a.prototype={colorAt:function(t,r){if(r<=this._stops[0])return e.copy(t,this._colors[0]);if(r>=this._stops[this._stops.length-1])return e.copy(t,this._colors[this._stops.length-1]);for(var i=0,a=1;a<this._stops.length&&!(this._stops[a]>r);++a)i=a;var o=i+1,s=this._stops[i],u=(r-s)/(this._stops[o]-s);return n.mix(t,this._colors[o],this._colors[i],u)}};var o={};r.gradient=function(t,e){if("string"==typeof t)return o[t];if("equal"===(e=e||"equal")){e=[];for(var r=0;r<t.length;++r)e.push(1*r/(t.length-1))}return new a(t,e)};var s=r.gradient;function u(t,e,r){this.colorFor=t,this._beginFunc=e,this._endFunc=r}r.initGradients=function(){o.rainbow=s(["red","yellow","green","blue"]),o.reds=s(["lightred","darkred"]),o.greens=s(["lightgreen","darkgreen"]),o.blues=s(["lightblue","darkblue"]),o.trafficlight=s(["green","yellow","red"]),o.heatmap=s(["red","white","blue"])},u.prototype={begin:function(t){this._beginFunc&&this._beginFunc(t)},end:function(t){this._endFunc&&this._endFunc(t)}},r.ColorOp=u,r.uniform=function(t){return t=r.forceRGB(t||"white"),new u((function(e,r,n){r[n+0]=t[0],r[n+1]=t[1],r[n+2]=t[2],r[n+3]=t[3]}),null,null)};var l={H:[1,1,1],C:[.83,.83,.83],N:[.13,.2,1],O:[1,.13,0],F:[.12,.94,.12],CL:[.12,.94,.12],BR:[.6,.13,0],I:[.4,0,.73],HE:[0,1,1],NE:[0,1,1],AR:[0,1,1],XE:[0,1,1],KR:[0,1,1],P:[1,.6,0],S:[.87,.87,0],B:[1,.67,.47],LI:[.47,0,1],NA:[.47,0,1],K:[.47,0,1],RB:[.47,0,1],CS:[.47,0,1],FR:[.47,0,1],BE:[0,.47,0],MG:[0,.47,0],SR:[0,.47,0],BA:[0,.47,0],RA:[0,.47,0],TI:[.6,.6,.6],FE:[.87,.47,0]};r.byElement=function(){return new u((function(t,e,r){var n=t.element(),i=l[n];return void 0!==i?(e[r]=i[0],e[r+1]=i[1],e[r+2]=i[2],e[r+3]=1,e):(e[r]=1,e[r+1]=0,e[r+2]=1,e[r+3]=1,e)}),null,null)},r.bySS=function(){return new u((function(t,e,r){switch(t.residue().ss()){case"C":return e[r]=.8,e[r+1]=.8,e[r+2]=.8,void(e[r+3]=1);case"H":return e[r]=.6,e[r+1]=.6,e[r+2]=.9,void(e[r+3]=1);case"E":return e[r]=.2,e[r+1]=.8,e[r+2]=.2,void(e[r+3]=1)}}),null,null)},r.rainbow=function(t){return t||(t=s("rainbow")),new u((function(e,r,n){var i=0,a=this.chainLimits[e.residue().chain().name()];void 0!==a&&(i=(e.residue().index()-a[0])/(a[1]-a[0]));var o=[1,1,1,1];t.colorAt(o,i),r[n]=o[0],r[n+1]=o[1],r[n+2]=o[2],r[n+3]=o[3]}),(function(t){var e=t.chains();this.chainLimits={};for(var r=0;r<e.length;++r){var n=e[r].backboneTraces();if(0!==n.length){for(var i=n[0].residueAt(0).index(),a=n[0].residueAt(n[0].length()-1).index(),o=1;o<n.length;++o){var s=n[o];i=Math.min(i,s.residueAt(0).index()),a=Math.max(a,s.residueAt(s.length()-1).index())}i!==a&&(this.chainLimits[e[r].name()]=[i,a])}}}),(function(){this.chainLimits=null}))},r.ssSuccession=function(t,e){return t||(t=s("rainbow")),e||(e=r.forceRGB("lightgrey")),new u((function(r,n,i){var a=r.residue().index(),o=this.chainLimits[r.residue().chain().name()],s=o.indices[a];if(-1===s)return n[i]=e[0],n[i+1]=e[1],n[i+2]=e[2],void(n[i+3]=e[3]);var u=0;o.max,null!==o.max&&(u=s/(o.max>0?o.max:1));var l=[0,0,0,0];t.colorAt(l,u),n[i]=l[0],n[i+1]=l[1],n[i+2]=l[2],n[i+3]=l[3]}),(function(t){var e=t.chains();this.chainLimits={};for(var r=0;r<e.length;++r){for(var n=e[r].residues(),i=null,a={},o=0,s="C",u=0;u<n.length;++u){var l=n[u].ss();"C"===l?("C"!==s&&o++,a[n[u].index()]=-1):(i=o,a[n[u].index()]=o),s=l}this.chainLimits[e[r].name()]={indices:a,max:i}}}),(function(){this.chainLimits=null}))},r.byChain=function(t){return t||(t=s("rainbow")),new u((function(e,r,n){var i=this.chainIndices[e.residue().chain().name()]*this.scale,a=[0,0,0,0];t.colorAt(a,i),r[n+0]=a[0],r[n+1]=a[1],r[n+2]=a[2],r[n+3]=a[3]}),(function(t){var e=t.chains();this.chainIndices={};for(var r=0;r<e.length;++r)this.chainIndices[e[r].name()]=r;this.scale=e.length>1?1/(e.length-1):1}),(function(){this.chainIndices=null}))};var h=function(){var t=e.create();return function(e,r,n,i){n.colorAt(t,i),e[r+0]=t[0],e[r+1]=t[1],e[r+2]=t[2],e[r+3]=t[3]}}();function c(t,e,r,n,i){return e||(e=s("rainbow")),new u((function(r,n,a){var o=0;this._min!==this._max&&(o=(i(r).prop(t)-this._min)/(this._max-this._min)),h(n,a,e,o)}),(function(e){if(void 0!==r)return this._min=r[0],void(this._max=r[1]);r=function(t,e,r){var n=null,i=null;return t[e]((function(t){var e=t.prop(r);null!==n||null!==i?(n=Math.min(n,e),i=Math.max(i,e)):n=i=e})),{min:n,max:i}}(e,n,t),this._min=r.min,this._max=r.max}),(function(){}))}return r.byAtomProp=function(t,e,r){return c(t,e,r,"eachAtom",(function(t){return t}))},r.byResidueProp=function(t,e,r){return c(t,e,r,"eachResidue",(function(t){return t.residue()}))},r.interpolateColor=function(t,r){for(var n=new Float32Array(4*(r*(t.length/4-1)+1)),i=0,a=e.create(),o=e.create(),s=1/r,u=0;u<t.length/4-1;++u){e.set(a,t[4*u+0],t[4*u+1],t[4*u+2],t[4*u+3]),e.set(o,t[4*u+4],t[4*u+5],t[4*u+6],t[4*u+7]);for(var l=0;l<r;++l){var h=s*l;n[i+0]=a[0]*(1-h)+o[0]*h,n[i+1]=a[1]*(1-h)+o[1]*h,n[i+2]=a[2]*(1-h)+o[2]*h,n[i+3]=a[3]*(1-h)+o[3]*h,i+=4}}return n[i+0]=o[0],n[i+1]=o[1],n[i+2]=o[2],n[i+3]=o[3],n},r.initGradients(),r}(),r=function(){function t(t,e,r){this._pool=t,this._start=e,this._next=e,this._end=r}function e(){this.clear()}return t.prototype={nextId:function(t){var e=this._next;return console.assert(this._next<this._end),this._next++,this._pool._objects[e]=t,e},hasLeft:function(){return this._next<this._end},recycle:function(){this._pool.recycle(this)},length:function(){return this._end-this._start}},e.prototype={MAX_ID:16777216,getContinuousRange:function(e){for(var r=-1,n=null,i=0;i<this._free.length;++i){var a=this._free[i].length();a>=e&&(null===n||a<n)&&(n=a,r=i)}if(-1!==r){var o=this._free[r];return this._free.splice(r,1),this._usedCount++,o}var s=this._unusedRangeStart,u=s+e;if(u>this.MAX_ID)return console.error("not enough free object ids."),null;this._unusedRangeStart=u;var l=new t(this,s,u);return this._usedCount++,l},clear:function(){this._objects={},this._unusedRangeStart=1,this._free=[],this._usedCount=0},recycle:function(t){for(var e=t._start;e<t._next;++e)delete this._objects[e];t._next=t._start,this._free.push(t),this._usedCount--,console.assert(this._usedCount>=0),this._free.length>0&&0===this._usedCount&&this.clear()},objectForId:function(t){return this._objects[t]}},e}(),n=function(){var t={};function e(t,e){return t<e}function r(t,e){void 0===t||void 0===e?(this._empty=!0,this._min=this._max=null):(this._empty=!1,this._min=t,this._max=e)}return t.derive=function(t,e,r){for(var n in e.prototype)t.prototype[n]=e.prototype[n];if(void 0!==r)for(var i in r)t.prototype[i]=r[i]},t.bind=function(t,e){return function(){return e.apply(t,arguments)}},t.copy=function(t){t=t||{};var e={};for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e},t.binarySearch=function(t,r,n){if(0===t.length)return-1;n=n||e;for(var i=0,a=t.length,o=i+a>>1;;){var s=t[o];if(n(r,s))a=o;else{if(!n(s,r))return o;i=o}var u=i+a>>1;if(u===o)return-1;o=u}return-1},t.indexFirstLargerEqualThan=function(t,r,n){if(n=n||e,0===t.length||n(t[t.length-1],r))return-1;for(var i=0,a=t.length,o=i+a>>1;;){var s=t[o];n(r,s)?a=o:n(s,r)?i=o+1:a=o;var u=i+a>>1;if(u===o)return o;o=u}},t.indexLastSmallerThan=function(t,r,n){if(n=n||e,0===t.length||n(t[t.length-1],r))return t.length-1;if(n(r,t[0])||!n(t[0],r))return-1;for(var i=0,a=t.length,o=i+a>>1;;){var s=t[o];n(r,s)||!n(s,r)?a=o:i=o;var u=i+a>>1;if(u===o)return o;o=u}},t.indexLastSmallerEqualThan=function(t,r,n){if(n=n||e,0===t.length||n(t[t.length-1],r))return t.length-1;if(n(r,t[0]))return-1;for(var i=0,a=t.length,o=i+a>>1;;){n(r,t[o])?a=o:i=o;var s=i+a>>1;if(s===o)return o;o=s}},r.prototype={min:function(){return this._min},max:function(){return this._max},length:function(){return this._max-this._min},empty:function(){return this._empty},center:function(){return.5*(this._max+this._min)},extend:function(t){this._min-=t,this._max+=t},update:function(t){this._empty?(this._min=this._max=t,this._empty=!1):t<this._min?this._min=t:t>this._max&&(this._max=t)}},t.Range=r,t}(),i=function(){function t(t){if("complete"!==document.readyState&&"loaded"!==document.readyState&&"interactive"!==document.readyState)return console.error("isWebGLSupported only works after DOMContentLoaded"),!1;if(void 0===t)try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("experimental-webgl"))}catch(t){return!1}return!!t}function e(t,e){this._width=e.width,this._antialias=e.antialias,this._height=e.height,this._resize=!1,this._lastTimestamp=null,this._domElement=t,this._initCanvas(),this._backgroundColor=e.backgroundColor,this._forceManualAntialiasing=e.forceManualAntialiasing}return e.prototype={_ensureSize:function(){if(this._resize){this._resize=!1;var t=this._width*this._samples,e=this._height*this._samples;this._realWidth=t,this._realHeight=e,this._gl.viewport(0,0,t,e),this._canvas.width=t,this._canvas.height=e,this._samples>1&&this._initManualAntialiasing(this._samples)}},resize:function(t,e){t===this._width&&e===this._height||(this._resize=!0,this._width=t,this._height=e)},fitParent:function(){var t=this._domElement.getBoundingClientRect();this.resize(t.width,t.height)},gl:function(){return this._gl},imageData:function(){return this._canvas.toDataURL()},_initContext:function(){try{var t={antialias:this._antialias&&!this._forceManualAntialiasing,preserveDrawingBuffer:!0};this._gl=this._canvas.getContext("experimental-webgl",t)}catch(t){return console.error("WebGL not supported",t),!1}return!!this._gl||(console.error("WebGL not supported"),!1)},_initManualAntialiasing:function(t){var e=1/t,r="translate("+.5*-(1-e)*this._realWidth+"px, "+.5*-(1-e)*this._realHeight+"px) scale("+e+", "+e+")";this._canvas.style.webkitTransform=r,this._canvas.style.transform=r,this._canvas.style.ieTransform=r,this._canvas.width=this._realWidth,this._canvas.height=this._realHeight},initGL:function(){var t=1;if(!this._initContext())return!1;var e=this._gl;return e.getContextAttributes().antialias&&!this._forceManualAntialiasing||!this._antialias||(t=2),this._realWidth=this._width*t,this._realHeight=this._height*t,this._samples=t,t>1&&this._initManualAntialiasing(t),e.viewportWidth=this._realWidth,e.viewportHeight=this._realHeight,e.clearColor(this._backgroundColor[0],this._backgroundColor[1],this._backgroundColor[2],1),e.lineWidth(2),e.cullFace(e.FRONT),e.enable(e.CULL_FACE),e.enable(e.DEPTH_TEST),!0},_shaderFromString:function(t,e,r){var n,i=this._gl;if("fragment"===e)n=i.createShader(i.FRAGMENT_SHADER);else{if("vertex"!==e)return console.error("could not determine type for shader"),null;n=i.createShader(i.VERTEX_SHADER)}var a=t.replace("${PRECISION}",r);return i.shaderSource(n,a),i.compileShader(n),i.getShaderParameter(n,i.COMPILE_STATUS)?n:(console.log(a),console.error(i.getShaderInfoLog(n)),null)},initShader:function(t,e,r){var i=this._gl,a=this._shaderFromString(e,"fragment",r),o=this._shaderFromString(t,"vertex",r),s=i.createProgram();if(i.attachShader(s,o),i.attachShader(s,a),i.linkProgram(s),!i.getProgramParameter(s,i.LINK_STATUS))return console.error("could not initialise shaders"),console.error(i.getShaderInfoLog(s)),null;var u=n.bind(i,i.getAttribLocation),l=n.bind(i,i.getUniformLocation);return s.posAttrib=u(s,"attrPos"),s.colorAttrib=u(s,"attrColor"),s.normalAttrib=u(s,"attrNormal"),s.objIdAttrib=u(s,"attrObjId"),s.selectAttrib=u(s,"attrSelect"),s.symId=l(s,"symId"),s.projection=l(s,"projectionMat"),s.modelview=l(s,"modelviewMat"),s.rotation=l(s,"rotationMat"),s.fog=l(s,"fog"),s.fogFar=l(s,"fogFar"),s.fogNear=l(s,"fogNear"),s.fogColor=l(s,"fogColor"),s.outlineColor=l(s,"outlineColor"),s.outlineWidth=l(s,"outlineWidth"),s.relativePixelSize=l(s,"relativePixelSize"),s.screenDoorTransparency=l(s,"screenDoorTransparency"),s.selectionColor=l(s,"selectionColor"),s.pointSize=l(s,"pointSize"),s.zoom=l(s,"zoom"),s},on:function(t,e){this._canvas.addEventListener(t,e,!1)},removeEventListener:function(t,e){this._canvas.removeEventListener(t,e,!1)},onWheel:function(t,e){"onwheel"in this._canvas?this.on("wheel",t):this.on("mousewheel",e)},domElement:function(){return this._canvas},bind:function(){this._ensureSize(),this._gl.viewport(0,0,this._realWidth,this._realHeight)},superSamplingFactor:function(){return this._samples},viewportWidth:function(){return this._realWidth},viewportHeight:function(){return this._realHeight},width:function(){return this._width},height:function(){return this._height},_initCanvas:function(){this._canvas=document.createElement("canvas"),this._canvas.width=this._width,this._canvas.height=this._height,this._domElement.appendChild(this._canvas)},isWebGLSupported:function(){return t(this._gl)},destroy:function(){this._canvas.width=1,this._canvas.height=1,this._canvas.parentElement.removeChild(this._canvas),this._canvas=null}},{Canvas:e,isWebGLSupported:t}}(),a=function(){function t(t,e){this._width=e.width,this._height=e.height,this._colorBufferWidth=this._width,this._colorBufferHeight=this._height,this._gl=t,this._colorHandle=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this._colorHandle),this._depthHandle=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this._depthHandle),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,this._width,this._height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this._depthHandle),this._colorTexture=t.createTexture(),this._initColorBuffer()}return t.prototype={width:function(){return this._width},height:function(){return this._height},bind:function(){var t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,this._colorHandle),t.bindRenderbuffer(t.RENDERBUFFER,this._depthHandle),this._colorBufferWidth===this._width&&this._colorBufferHeight===this._height||this._resizeBuffers(),t.viewport(0,0,this._width,this._height)},colorTexture:function(){return this._colorTexture},_initColorBuffer:function(){this.bind();var t=this._gl;t.bindTexture(t.TEXTURE_2D,this._colorTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this._width,this._height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this._colorTexture,0),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(t.TEXTURE_2D,null),this.release()},_resizeBuffers:function(){var t=this._gl;t.bindRenderbuffer(t.RENDERBUFFER,this._depthHandle),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,this._width,this._height),t.bindTexture(t.TEXTURE_2D,this._colorTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this._width,this._height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this._colorTexture,0),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this._depthHandle),t.bindTexture(t.TEXTURE_2D,null),this._colorBufferWidth=this._width,this._colorBufferHeight=this._height},resize:function(t,e){this._width=t,this._height=e},release:function(){var t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null)}},t}(),o=function(){function t(t){this._freeArrays=[],this._bufferType=t}return t.prototype.request=function(t){for(var e=-1,r=null,n=0;n<this._freeArrays.length;++n){var i=this._freeArrays[n].length;i>=t&&(null===r||i<r)&&(r=i,e=n)}if(-1!==e){var a=this._freeArrays[e];return this._freeArrays.splice(e,1),a}return new this._bufferType(t)},t.prototype.release=function(t){this._freeArrays.push(t)},t}(),s=function(){var e,r,n,i=t.vec3,a=t.mat4;function o(t){this._projection=a.create(),this._camModelView=a.create(),this._modelView=a.create(),this._rotation=a.create(),this._translation=a.create(),this._near=.1,this._far=4e3,this._fogNear=-5,this._fogFar=50,this._fog=!0,this._fovY=45*Math.PI/180,this._fogColor=i.fromValues(1,1,1),this._outlineColor=i.fromValues(.1,.1,.1),this._outlineWidth=1,this._selectionColor=i.fromValues(.1,1,.1),this._center=i.create(),this._zoom=50,this._screenDoorTransparency=!1,this._updateProjectionMat=!0,this._updateModelViewMat=!0,this._upsamplingFactor=1,this._gl=t,this._currentShader=null,this._stateId=0,this.setViewportSize(t.viewportWidth,t.viewportHeight)}return o.prototype={_incrementStateId:function(){this._stateId+=1,this._stateId>68719476735&&(this._stateId=0)},setScreenDoorTransparency:function(t){this._screenDoorTransparency=t,this._incrementStateId()},setOutlineWidth:function(t){this._outlineWidth!==t&&(this._outlineWidth=t,this._incrementStateId())},setRotation:function(t){16===t.length?a.copy(this._rotation,t):a.fromMat3(this._rotation,t),this._updateModelViewMat=!0},upsamplingFactor:function(){return this._upsamplingFactor},setUpsamplingFactor:function(t){if(this._upsamplingFactor!==t){this._incrementStateId(),this._upsamplingFactor=t;var e=this._upsamplingFactor/this._width,r=this._upsamplingFactor/this._height;this._relativePixelSize=new Float32Array([e,r])}},mainAxes:function(){return[i.fromValues(this._rotation[0],this._rotation[4],this._rotation[8]),i.fromValues(this._rotation[1],this._rotation[5],this._rotation[9]),i.fromValues(this._rotation[2],this._rotation[6],this._rotation[10])]},fieldOfViewY:function(){return this._fovY},setFieldOfViewY:function(t){this._fovY=t,this._updateProjectionMat=!0},aspectRatio:function(){return this._width/this._height},rotation:function(){return this._rotation},_updateIfRequired:function(){var t=!1;return this._updateModelViewMat&&(a.identity(this._camModelView),a.translate(this._camModelView,this._camModelView,[-this._center[0],-this._center[1],-this._center[2]]),a.mul(this._camModelView,this._rotation,this._camModelView),a.identity(this._translation),a.translate(this._translation,this._translation,[0,0,-this._zoom]),a.mul(this._camModelView,this._translation,this._camModelView),t=!0),this._updateProjectionMat&&(a.identity(this._projection),a.perspective(this._projection,this._fovY,this._width/this._height,this._near,this._far),t=!0),this._updateProjectionMat=!1,this._updateModelViewMat=!1,t&&this._incrementStateId(),t},setViewportSize:function(t,e){this._updateProjectionMat=!0,this._width=t,this._height=e,this._relativePixelSize=new Float32Array([this._upsamplingFactor/t,this._upsamplingFactor/e])},viewportWidth:function(){return this._width},viewportHeight:function(){return this._height},setCenter:function(t){this._updateModelViewMat=!0,i.copy(this._center,t)},fog:function(t){return void 0!==t&&t!==this._fog&&(this._fog=t,this._incrementStateId()),this._fog},rotateZ:(n=a.create(),function(t){a.identity(n),this._updateModelViewMat=!0,a.rotate(n,n,t,[0,0,1]),a.mul(this._rotation,n,this._rotation)}),rotateX:function(){var t=a.create();return function(e){a.identity(t),this._updateModelViewMat=!0,a.rotate(t,t,e,[1,0,0]),a.mul(this._rotation,t,this._rotation)}}(),rotateY:function(){var t=a.create();return function(e){a.identity(t),this._updateModelViewMat=!0,a.rotate(t,t,e,[0,1,0]),a.mul(this._rotation,t,this._rotation)}}(),panX:function(t){return this.panXY(t,0)},panY:function(t){return this.panXY(0,t)},panXY:(e=a.create(),r=i.create(),function(t,n){a.transpose(e,this._rotation),this._updateModelViewMat=!0,i.set(r,-t,n,0),i.transformMat4(r,r,e),i.add(r,r,this._center),this.setCenter(r)}),nearOffset:function(){return this._near},farOffset:function(){return this._far},setNearFar:function(t,e){t===this._near&&e===this._far||(this._near=t,this._far=e,this._updateProjectionMat=!0)},setFogNearFar:function(t,e){this._fogNear=t,this._fogFar=e,this._updateProjectionMat=!0},setZoom:function(t){return this._updateModelViewMat=!0,this._zoom=t,this._zoom},zoom:function(t){if(void 0===t)return this._zoom;this._updateModelViewMat=!0;var e=1+.1*t;return this._zoom=Math.min(1e3,Math.max(2,e*this._zoom)),this._zoom},center:function(){return this._center},setFogColor:function(t){this._fogColor=i.clone(t)},currentShader:function(){return this._currentShader},invalidateCurrentShader:function(){this._currentShader=null},setOutlineColor:function(t){this._outlineColor=i.clone(t)},setSelectionColor:function(t){this._selectionColor=i.clone(t)},bind:function(t,e){var r=!1,n=this._gl;if(this._currentShader!==t&&(this._currentShader=t,n.useProgram(t),r=!0),r=this._updateIfRequired()||r,e?(a.mul(this._modelView,this._camModelView,e),n.uniformMatrix4fv(t.modelview,!1,this._modelView)):n.uniformMatrix4fv(t.modelview,!1,this._camModelView),this._stateId!==t.stateId){t.stateId=this._stateId,n.uniformMatrix4fv(t.projection,!1,this._projection),t.rotation&&n.uniformMatrix4fv(t.rotation,!1,this._rotation),n.uniform1i(t.fog,this._fog);var i=this._zoom;n.uniform1f(t.fogFar,this._fogFar+i),n.uniform1f(t.zoom,this._zoom),n.uniform1f(t.fogNear,this._fogNear+i),n.uniform3fv(t.fogColor,this._fogColor),n.uniform3fv(t.outlineColor,this._outlineColor),n.uniform3fv(t.selectionColor,this._selectionColor),n.uniform2fv(t.relativePixelSize,this._relativePixelSize),n.uniform1f(t.outlineWidth,this._outlineWidth),n.uniform1i(t.screenDoorTransparency,this._screenDoorTransparency)}}},o}(),u={PRELUDE_FS:"\nprecision ${PRECISION} float;\nuniform bool screenDoorTransparency;\nvec4 handleAlpha(vec4 inColor) {\n  if (screenDoorTransparency) {\n    ivec2 pxCoord = ivec2(gl_FragCoord.xy);\n    ivec2 mod = pxCoord - (pxCoord/2) * 2;\n    if (inColor.a < 0.99 &&\n        (inColor.a < 0.01 || mod.x != 0 || mod.y != 0)) { discard; }\n    return vec4(inColor.rgb, 1.0);\n  } else {\n    if (inColor.a == 0.0) { discard; }\n    return inColor;\n  } \n} \nuniform vec3 selectionColor;\n\nvec3 handleSelect(vec3 inColor, float vertSelect) { \n  return mix(inColor, selectionColor, step(0.5, vertSelect) * 0.7); \n} \n\nuniform bool fog;\nuniform float fogNear;\nuniform float fogFar;\nuniform vec3 fogColor;\nvec3 handleFog(vec3 inColor) {\n  if (fog) {\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\n    float fogFactor = smoothstep(fogNear, fogFar, depth);\n    return mix(inColor, fogColor, fogFactor);\n  } else {\n    return inColor;\n  }\n}",LINES_FS:"\nvarying vec4 vertColor;\nvarying vec3 vertNormal;\n\nvoid main(void) {\n  gl_FragColor = handleAlpha(vertColor);\n  gl_FragColor.rgb = handleFog(gl_FragColor.rgb);\n}",SELECT_LINES_FS:"\nprecision ${PRECISION} float;\n\nvarying float vertSelect;\nvarying vec3 vertNormal;\nuniform float fogNear;\nuniform float fogFar;\nuniform vec3 fogColor;\nuniform bool fog;\nuniform vec3 selectionColor;\n\nvoid main(void) {\n  gl_FragColor = mix(vec4(0.0, 0.0, 0.0, 0.0), vec4(selectionColor, 1.0), \n                     vertSelect);\n  gl_FragColor.a = step(0.5, vertSelect);\n  if (gl_FragColor.a == 0.0) { discard; }\n  float depth = gl_FragCoord.z / gl_FragCoord.w;\n  if (fog) {\n    float fog_factor = smoothstep(fogNear, fogFar, depth);\n    gl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w),\n                        fog_factor);\n  }\n}",SELECT_LINES_VS:"\nattribute vec3 attrPos;\nattribute float attrSelect;\n\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nuniform float pointSize;\nvarying float vertSelect;\nvoid main(void) {\n  gl_Position = projectionMat * modelviewMat * vec4(attrPos, 1.0);\n  gl_Position.z += gl_Position.w * 0.000001; \n  float distToCamera = vec4(modelviewMat * vec4(attrPos, 1.0)).z;\n  gl_PointSize = pointSize * 200.0 / abs(distToCamera); \n  vertSelect = attrSelect;\n}",SELECT_VS:"\nprecision ${PRECISION} float;\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nuniform float pointSize;\nattribute vec3 attrPos;\nattribute float attrObjId;\n\nvarying float objId;\n\nvoid main(void) {\n  gl_Position = projectionMat * modelviewMat * vec4(attrPos, 1.0);\n  float distToCamera = vec4(modelviewMat * vec4(attrPos, 1.0)).z;\n  gl_PointSize = pointSize * 200.0 / abs(distToCamera); \n  objId = attrObjId;\n}",SELECT_FS:"\nprecision ${PRECISION} float;\n\nvarying float objId;\nuniform int symId;\n\nint intMod(int x, int y) { \n  int z = x/y;\n  return x-y*z;\n}\nvoid main(void) {\n  // ints are only required to be 7bit...\n  int integralObjId = int(objId+0.5);\n  int red = intMod(integralObjId, 256);\n  integralObjId/=256;\n  int green = intMod(integralObjId, 256);\n  integralObjId/=256;\n  int blue = intMod(integralObjId, 256);\n  int alpha = symId;\n  gl_FragColor = vec4(float(red), float(green), \n                      float(blue), float(alpha))/255.0;\n}",LINES_VS:"\nattribute vec3 attrPos;\nattribute vec4 attrColor;\n\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nvarying vec4 vertColor;\nuniform float pointSize;\nvoid main(void) {\n  gl_Position = projectionMat * modelviewMat * vec4(attrPos, 1.0);\n  float distToCamera = vec4(modelviewMat * vec4(attrPos, 1.0)).z;\n  gl_PointSize = pointSize * 200.0 / abs(distToCamera); \n  vertColor = attrColor;\n}",HEMILIGHT_FS:"\nvarying vec4 vertColor;\nvarying vec3 vertNormal;\nvarying float vertSelect;\n\nvoid main(void) {\n  float dp = dot(vertNormal, vec3(0.0, 0.0, 1.0));\n  float hemi = min(1.0, max(0.0, dp)*0.6+0.5);\n  gl_FragColor = vec4(vertColor.rgb*hemi, vertColor.a);\n  gl_FragColor.rgb = handleFog(handleSelect(gl_FragColor.rgb, vertSelect));\n  gl_FragColor = handleAlpha(gl_FragColor);\n}",PHONG_FS:"\nvarying vec4 vertColor;\nvarying vec3 vertNormal;\nvarying vec3 vertPos;\nuniform float zoom;\nvarying float vertSelect;\n\nvoid main(void) {\n  vec3 eyePos = vec3(0.0, 0.0, zoom);\n  float dp = dot(vertNormal, normalize(eyePos - vertPos));\n  float hemi = min(1.0, max(0.3, dp)+0.2);\n  //hemi *= vertColor.a;\n  vec3 rgbColor = vertColor.rgb * hemi; \n  rgbColor += min(vertColor.rgb, 0.8) * pow(max(0.0, dp), 18.0);\n  rgbColor = handleSelect(rgbColor, vertSelect);\n  gl_FragColor = vec4(clamp(rgbColor, 0.0, 1.0), vertColor.a);\n  gl_FragColor.rgb = handleFog(gl_FragColor.rgb);\n  gl_FragColor = handleAlpha(gl_FragColor);\n}",HEMILIGHT_VS:"\nattribute vec3 attrPos;\nattribute vec4 attrColor;\nattribute vec3 attrNormal;\nattribute float attrSelect;\n\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nvarying vec4 vertColor;\nvarying vec3 vertNormal;\nvarying vec3 vertPos;\nvarying float vertSelect;\nvoid main(void) {\n  vertPos = (modelviewMat * vec4(attrPos, 1.0)).xyz;\n  gl_Position = projectionMat * modelviewMat * vec4(attrPos, 1.0);\n  vec4 n = (modelviewMat * vec4(attrNormal, 0.0));\n  vertNormal = n.xyz;\n  vertColor = attrColor;\n  vertSelect = attrSelect;\n}",OUTLINE_FS:"\nvarying float vertAlpha;\nvarying float vertSelect;\n\nuniform vec3 outlineColor;\n\nvoid main() {\n  gl_FragColor = vec4(mix(outlineColor, selectionColor, \n                          step(0.5, vertSelect)), \n                      vertAlpha);\n  gl_FragColor.rgb = handleFog(gl_FragColor.rgb);\n  gl_FragColor = handleAlpha(gl_FragColor);\n}",OUTLINE_VS:"\nprecision ${PRECISION} float;\n\nattribute vec3 attrPos;\nattribute vec3 attrNormal;\nattribute vec4 attrColor;\nattribute float attrSelect;\n\nuniform vec3 outlineColor;\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nvarying float vertAlpha;\nvarying float vertSelect;\nuniform vec2 relativePixelSize;\nuniform float outlineWidth;\n\nvoid main(void) {\n  gl_Position = projectionMat * modelviewMat * vec4(attrPos, 1.0);\n  vec4 normal = modelviewMat * vec4(attrNormal, 0.0);\n  vertAlpha = attrColor.a;\n  vertSelect = attrSelect;\n  vec2 expansion = relativePixelSize * \n       (outlineWidth + 2.0 * step(0.5, attrSelect));\n  vec2 offset = normal.xy * expansion;\n  gl_Position.xy += gl_Position.w * offset;\n}",TEXT_VS:"\nprecision ${PRECISION} float;\n\nattribute vec3 attrCenter;\nattribute vec2 attrCorner;\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nuniform mat4 rotationMat;\nvarying vec2 vertTex;\nuniform float width;\nuniform float height;\nvoid main() { \n  vec4 pos = modelviewMat* vec4(attrCenter, 1.0);\n  pos.z += 4.0;\n  gl_Position = projectionMat * pos;\n  gl_Position.xy += vec2(width,height)*attrCorner*gl_Position.w; \n  vertTex = (attrCorner+abs(attrCorner))/(2.0*abs(attrCorner)); \n}",TEXT_FS:"\nprecision ${PRECISION} float;\n\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nuniform sampler2D sampler;\nuniform float xScale;\nuniform float yScale;\nvarying vec2 vertTex;\nvoid main() { \n  vec2 texCoord = vec2(vertTex.x*xScale, vertTex.y*yScale);\n  gl_FragColor = texture2D(sampler, texCoord);\n  if (gl_FragColor.a == 0.0) { discard; }\n}"},l=function(){function t(t,e,r){this._element=t,this._element.addEventListener("touchmove",n.bind(this,this._touchMove)),this._element.addEventListener("touchstart",n.bind(this,this._touchStart)),this._element.addEventListener("touchend",n.bind(this,this._touchEnd)),this._element.addEventListener("touchcancel",n.bind(this,this._touchEnd)),this._touchState={scale:1,rotation:0,center:null},this._lastSingleTap=null,this._viewer=e,this._cam=r}function e(t,e){var r=e.x-t.x,n=e.y-t.y;return Math.sqrt(r*r+n*n)}function r(t,e){var r=e.x-t.x,n=e.y-t.y;return Math.atan2(n,r)}return t.prototype={_extractEventAttributes:function(t,n){var i,a,o,s={};s.center=function(t){for(var e=0,r=0,n=0;n<t.length;++n)e+=t[n].clientX,r+=t[n].clientY;return{x:e/=t.length,y:r/=t.length}}(n.targetTouches),s.pointers=[];for(var u=0;u<n.targetTouches.length;++u){var l=n.targetTouches[u];s.pointers.push({x:l.clientX,y:l.clientY})}return s.numTouches=n.targetTouches.length,s.rotation=0,s.scale=1,s.deltaScale=0,s.deltaRotation=0,t.center&&(s.deltaCenter={x:s.center.x-t.center.x,y:s.center.y-t.center.y}),2!==t.numTouches||2!==s.numTouches||(t.initialPointers?s.initialPointers=t.initialPointers:s.initialPointers=t.pointers,s.scale=(i=s.initialPointers,a=s.pointers,o=e(i[0],i[1]),e(a[0],a[1])/(0===o?1:o)),s.deltaScale=s.scale-t.scale,s.rotation=function(t,e){return r(e[1],e[0])-r(t[1],t[0])}(s.initialPointers,s.pointers),s.deltaRotation=s.rotation-t.rotation),s},_touchMove:function(t){t.preventDefault();var e=this._extractEventAttributes(this._touchState,t),r=4*-e.deltaScale;if(0!==r&&this._cam.zoom(r),2===e.numTouches&&2===this._touchState.numTouches){var n=.002*Math.tan(.5*this._cam.fieldOfViewY())*this._cam.zoom();this._cam.panXY(e.deltaCenter.x*n,e.deltaCenter.y*n)}var i=-e.deltaRotation;this._cam.rotateZ(i),1===e.numTouches&&1===this._touchState.numTouches&&(this._cam.rotateX(.005*e.deltaCenter.y),this._cam.rotateY(.005*e.deltaCenter.x)),this._viewer.requestRedraw(),this._touchState=e},_touchStart:function(t){if(t.preventDefault(),1===t.targetTouches.length){var e=(new Date).getTime();null!==this._lastSingleTap&&e-this._lastSingleTap<500&&this._viewer._mouseDoubleClick({clientX:t.targetTouches[0].clientX,clientY:t.targetTouches[0].clientY}),this._lastSingleTap=e}else this._lastSingleTap=null;this._touchState=this._extractEventAttributes(this._touchState,t)},_touchEnd:function(t){t.preventDefault()}},t}(),h=function(){function t(t,e,r,n){this._viewer=e,this._canvas=t,this._cam=r,this._canvas=t,this._animationTime=n,this._lastMouseUpTime=null,this._init()}return t.prototype={_centerOnClicked:function(t){null!==t&&this._viewer.setCenter(t.pos(),this._animationTime)},_mouseUp:function(t){var e=this._canvas,r=(new Date).getTime();if((null===this._lastMouseUpTime||r-this._lastMouseUpTime>300)&r-this._lastMouseDownTime<300){var n=this._canvas.domElement().getBoundingClientRect(),i=this._viewer.pick({x:t.clientX-n.left,y:t.clientY-n.top});this._viewer._dispatchEvent(t,"click",i)}this._lastMouseUpTime=r,e.removeEventListener("mousemove",this._mouseRotateListener),e.removeEventListener("mousemove",this._mousePanListener),e.removeEventListener("mouseup",this._mouseUpListener),document.removeEventListener("mouseup",this._mouseUpListener),document.removeEventListener("mousemove",this._mouseRotateListener),document.removeEventListener("mousemove",this._mousePanListener)},setCam:function(t){this._cam=t},_init:function(){return this._mousePanListener=n.bind(this,this._mousePan),this._mouseRotateListener=n.bind(this,this._mouseRotate),this._mouseUpListener=n.bind(this,this._mouseUp),this._canvas.onWheel(n.bind(this,this._mouseWheelFF),n.bind(this,this._mouseWheel)),this._canvas.on("dblclick",n.bind(this,this._mouseDoubleClick)),this._canvas.on("mousedown",n.bind(this,this._mouseDown)),!0},_mouseWheel:function(t){this._cam.zoom(t.wheelDelta<0?-1:1),t.preventDefault(),this._viewer.requestRedraw()},_mouseWheelFF:function(t){this._cam.zoom(t.deltaY<0?1:-1),t.preventDefault(),this._viewer.requestRedraw()},_mouseDoubleClick:function(t){var e=this._canvas.domElement().getBoundingClientRect(),r=this._viewer.pick({x:t.clientX-e.left,y:t.clientY-e.top});this._viewer._dispatchEvent(t,"doubleClick",r),this._viewer.requestRedraw()},_mouseDown:function(t){0===t.button&&(this._lastMouseDownTime=(new Date).getTime(),t.preventDefault(),!0===t.shiftKey?(this._canvas.on("mousemove",this._mousePanListener),document.addEventListener("mousemove",this._mousePanListener,!1)):(this._canvas.on("mousemove",this._mouseRotateListener),document.addEventListener("mousemove",this._mouseRotateListener,!1)),this._canvas.on("mouseup",this._mouseUpListener),document.addEventListener("mouseup",this._mouseUpListener,!1),this._lastMousePos={x:t.pageX,y:t.pageY})},_mouseRotate:function(t){var e={x:t.pageX,y:t.pageY},r=e.x-this._lastMousePos.x,n=e.y-this._lastMousePos.y;this._cam.rotateX(.005*n),this._cam.rotateY(.005*r),this._lastMousePos=e,this._viewer.requestRedraw()},_mousePan:function(t){var e={x:t.pageX,y:t.pageY},r=e.x-this._lastMousePos.x,n=e.y-this._lastMousePos.y,i=.002*Math.tan(.5*this._cam.fieldOfViewY())*this._cam.zoom();this._cam.panXY(i*r,i*n),this._lastMousePos=e,this._viewer.requestRedraw()}},t}(),c=function(){var e,r,n=t.vec3,i=t.vec4,a=t.mat3,o=t.quat,s=(e=n.create(),function(t,r,i){return n.cross(e,t,r),Math.atan2(n.dot(e,i),n.dot(t,r))}),u=function(){var t=n.create();return function(e,r){return n.copy(t,r),Math.abs(r[0])<Math.abs(r[1])?Math.abs(r[0])<Math.abs(r[2])?t[0]+=1:t[2]+=1:Math.abs(r[1])<Math.abs(r[2])?t[1]+=1:t[2]+=1,n.cross(e,r,t)}}(),l=(r=n.create(),function(t,e,i,a,o,s,u){var l=s*s,h=l*(3-2*s),c=1-h,d=l*(s-2)+s,f=l*(s-1);n.copy(r,e),n.scale(r,r,c),n.scaleAndAdd(r,r,i,d),n.scaleAndAdd(r,r,a,h),n.scaleAndAdd(r,r,o,f),t[u]=r[0],t[u+1]=r[1],t[u+2]=r[2]});function h(t,e,r){return r?t*e:e*(t-1)+1}function c(t,e){this._center=t||n.create(),this._radius=e||1}var d,f,_,m,v,p,g,b=(d=a.create(),f=a.create(),_=a.create(),m=a.create(),v=o.create(),p=n.create(),g=n.create(),function(t){for(var e=o.fromValues(0,0,0,1),r=0;r<24;++r){a.fromQuat(d,e);var s=a.transpose(_,d);a.mul(f,d,a.mul(m,t,s)),n.set(p,f[5],f[2],f[1]),n.set(g,Math.abs(p[0]),Math.abs(p[1]),Math.abs(p[2]));var u=g[0]>g[1]&&g[0]>g[2]?0:g[1]>g[2]?1:2,l=(u+1)%3,h=(u+2)%3;if(0===p[u])break;var c=(f[3*h+h]-f[3*l+l])/(2*p[u]),b=c>0?1:-1,A=b/((c*=b)+(c<1e6?Math.sqrt(c*c+1):c)),y=1/Math.sqrt(A*A+1);if(1===y)break;if(i.set(v,0,0,0,0),v[u]=b*Math.sqrt((1-y)/2),v[u]*=-1,v[3]=Math.sqrt(1-v[u]*v[u]),1===v[3])break;e=o.mul(e,e,v),o.normalize(e,e)}return e});c.prototype.center=function(){return this._center},c.prototype.radius=function(){return this._radius};var A=function(t,e,r,i,a){a?n.cross(i,e,r):u(i,e),n.cross(r,i,e),n.normalize(i,i),n.normalize(r,r),t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=i[0],t[4]=i[1],t[5]=i[2],t[6]=e[0],t[7]=e[1],t[8]=e[2]};return{signedAngle:s,axisRotation:function(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[0],o=e[1],s=e[2],u=a*a,l=a*o,h=a*s,c=o*o,d=o*s,f=s*s;return t[0]=u+i-u*i,t[1]=l-i*l-n*s,t[2]=h-i*h+n*o,t[3]=l-i*l+n*s,t[4]=c+i-i*c,t[5]=d-i*d-n*a,t[6]=h-i*h-n*o,t[7]=d-i*d+n*a,t[8]=f+i-i*f,t},ortho:u,diagonalizer:b,catmullRomSpline:function(t,e,r,i,a,o){i=i||.5;var s=null,u=3*h(e,r,a=a||!1);s=o?o.request(u):new Float32Array(u);var c,d,f,_=0,m=1/r,v=n.create(),p=n.create(),g=n.create(),b=n.create(),A=n.create(),y=n.create();for(n.set(b,t[0],t[1],t[2]),n.set(A,t[3],t[4],t[5]),a?(n.set(g,t[t.length-3],t[t.length-2],t[t.length-1]),n.sub(v,A,g),n.scale(v,v,i)):(n.set(g,t[0],t[1],t[2]),n.set(v,0,0,0)),c=1,f=e-1;c<f;++c){for(n.set(y,t[3*(c+1)],t[3*(c+1)+1],t[3*(c+1)+2]),n.sub(p,y,b),n.scale(p,p,i),d=0;d<r;++d)l(s,b,v,A,p,m*d,_),_+=3;n.copy(g,b),n.copy(b,A),n.copy(A,y),n.copy(v,p)}for(a?(n.set(y,t[0],t[1],t[3]),n.sub(p,y,b),n.scale(p,p,i)):n.set(p,0,0,0),d=0;d<r;++d)l(s,b,v,A,p,m*d,_),_+=3;if(!a)return s[_]=t[3*(e-1)+0],s[_+1]=t[3*(e-1)+1],s[_+2]=t[3*(e-1)+2],s;for(n.copy(g,b),n.copy(b,A),n.copy(A,y),n.copy(v,p),n.set(y,t[3],t[4],t[5]),n.sub(p,y,b),n.scale(p,p,i),d=0;d<r;++d)l(s,b,v,A,p,m*d,_),_+=3;return s},cubicHermiteInterpolate:l,interpolateScalars:function(t,e){for(var r=new Float32Array(e*(t.length-1)+1),n=0,i=0,a=0,o=1/e,s=0;s<t.length-1;++s){i=t[s],a=t[s+1];for(var u=0;u<e;++u){var l=o*u;r[n+0]=i*(1-l)+a*l,n+=1}}return r[n+0]=a,r},catmullRomSplineNumPoints:h,Sphere:c,buildRotation:A}}(),d=function(){var e,r,n=t.vec3;function i(t,e){this._arcs=e,this._stacks=t,this._indices=new Uint16Array(3*e*t*2),this._verts=new Float32Array(3*e*t);var r,n,i=Math.PI/(t-1),a=2*Math.PI/e;for(r=0;r<this._stacks;++r){var o=Math.sin(r*i),s=Math.cos(r*i);for(n=0;n<this._arcs;++n){var u=o*Math.cos(n*a),l=o*Math.sin(n*a);this._verts[3*(n+r*this._arcs)]=u,this._verts[3*(n+r*this._arcs)+1]=l,this._verts[3*(n+r*this._arcs)+2]=s}}var h=0;for(r=0;r<this._stacks-1;++r)for(n=0;n<this._arcs;++n)this._indices[h]=r*this._arcs+n,this._indices[h+1]=r*this._arcs+(n+1)%this._arcs,this._indices[h+2]=(r+1)*this._arcs+n,h+=3,this._indices[h]=r*this._arcs+(n+1)%this._arcs,this._indices[h+1]=(r+1)*this._arcs+(n+1)%this._arcs,this._indices[h+2]=(r+1)*this._arcs+n,h+=3}function a(t,e,r){var i=c.catmullRomSpline(t,t.length/3,e,r,!0);this._indices=new Uint16Array(2*i.length),this._verts=i,this._normals=new Float32Array(i.length),this._arcs=i.length/3;for(var a=n.create(),o=0;o<this._arcs;++o){var s=0===o?this._arcs-1:o-1,u=o===this._arcs-1?0:o+1;a[0]=this._verts[3*u+1]-this._verts[3*s+1],a[1]=this._verts[3*s]-this._verts[3*u],n.normalize(a,a),this._normals[3*o]=a[0],this._normals[3*o+1]=a[1],this._normals[3*o+2]=a[2]}for(o=0;o<this._arcs;++o)this._indices[6*o]=o,this._indices[6*o+1]=o+this._arcs,this._indices[6*o+2]=(o+1)%this._arcs+this._arcs,this._indices[6*o+3]=o,this._indices[6*o+4]=(o+1)%this._arcs+this._arcs,this._indices[6*o+5]=(o+1)%this._arcs}function o(t){this._arcs=t,this._indices=new Uint16Array(3*t*2),this._verts=new Float32Array(3*t*2),this._normals=new Float32Array(3*t*2);for(var e=2*Math.PI/this._arcs,r=0;r<this._arcs;++r){var n=Math.cos(e*r),i=Math.sin(e*r);this._verts[3*r]=n,this._verts[3*r+1]=i,this._verts[3*r+2]=-.5,this._verts[3*t+3*r]=n,this._verts[3*t+3*r+1]=i,this._verts[3*t+3*r+2]=.5,this._normals[3*r]=n,this._normals[3*r+1]=i,this._normals[3*t+3*r]=n,this._normals[3*t+3*r+1]=i}for(r=0;r<this._arcs;++r)this._indices[6*r]=r%this._arcs,this._indices[6*r+1]=t+(r+1)%this._arcs,this._indices[6*r+2]=(r+1)%this._arcs,this._indices[6*r+3]=r%this._arcs,this._indices[6*r+4]=t+r%this._arcs,this._indices[6*r+5]=t+(r+1)%this._arcs}return i.prototype={addTransformed:(e=n.create(),r=n.create(),function(t,i,a,o,s){for(var u=t.numVerts(),l=0;l<this._stacks*this._arcs;++l)n.set(r,this._verts[3*l],this._verts[3*l+1],this._verts[3*l+2]),n.copy(e,r),n.scale(e,e,a),n.add(e,e,i),t.addVertex(e,r,o,s);for(l=0;l<this._indices.length/3;++l)t.addTriangle(u+this._indices[3*l],u+this._indices[3*l+1],u+this._indices[3*l+2])}),numIndices:function(){return this._indices.length},numVerts:function(){return this._verts.length/3}},a.prototype={addTransformed:function(){var t=n.create(),e=n.create();return function(r,i,a,o,s,u,l,h){for(var c=this._arcs,d=this._normals,f=this._verts,_=r.numVerts()-c,m=0;m<c;++m)n.set(t,a*f[3*m],a*f[3*m+1],0),n.transformMat3(t,t,o),n.add(t,t,i),n.set(e,d[3*m],d[3*m+1],0),n.transformMat3(e,e,o),r.addVertex(t,e,s,h);if(!u)if(0!==l)for(m=0;m<c;++m)r.addTriangle(_+(m+l)%c,_+m+c,_+(m+1)%c+c),r.addTriangle(_+(m+l)%c,_+(m+1)%c+c,_+(m+1+l)%c);else for(m=0;m<this._indices.length/3;++m)r.addTriangle(_+this._indices[3*m],_+this._indices[3*m+1],_+this._indices[3*m+2])}}()},o.prototype={numVerts:function(){return this._verts.length/3},numIndices:function(){return this._indices.length},addTransformed:function(){var t=n.create(),e=n.create();return function(r,i,a,o,s,u,l,h,c){for(var d=r.numVerts(),f=this._verts,_=this._normals,m=this._arcs,v=0;v<2*m;++v){n.set(t,o*f[3*v],o*f[3*v+1],a*f[3*v+2]),n.transformMat3(t,t,s),n.add(t,t,i),n.set(e,_[3*v],_[3*v+1],_[3*v+2]),n.transformMat3(e,e,s);var p=v<m?h:c;r.addVertex(t,e,v<m?u:l,p)}var g=this._indices;for(v=0;v<g.length/3;++v)r.addTriangle(d+g[3*v],d+g[3*v+1],d+g[3*v+2])}}()},{TubeProfile:a,ProtoCylinder:o,ProtoSphere:i}}(),O=function(){function t(t){this._children=[],this._visible=!0,this._name=name||"",this._gl=t,this._order=1}return t.prototype={order:function(t){return void 0!==t&&(this._order=t),this._order},add:function(t){this._children.push(t)},draw:function(t,e,r,n){for(var i=0,a=this._children.length;i!==a;++i)this._children[i].draw(t,e,r,n)},show:function(){this._visible=!0},hide:function(){this._visible=!1},name:function(t){return void 0!==t&&(this._name=t),this._name},destroy:function(){for(var t=0;t<this._children.length;++t)this._children[t].destroy()},visible:function(){return this._visible}},t}(),k=function(){var e,r=t.vec3,i=(e=r.create(),function(t,n,i){for(var a=0;a<n.length;++a)for(var o=n[a],s=t.chainsByName(o.chains()),u=0;u<o.matrices().length;++u)for(var l=o.matrix(u),h=0;h<s.length;++h)for(var c=s[h],d=0;d<c.residues().length;++d){var f=c.residues()[d].centralAtom();null!==f&&(r.transformMat4(e,f.pos(),l),i(f,e))}});function a(t){O.call(this,t),this._idRanges=[],this._vertAssocs=[],this._showRelated=null,this._selection=null}return n.derive(a,O,{setShowRelated:function(t){if(!t||"asym"===t||null!==this.structure().assembly(t))return this._showRelated=t,t;console.error("no assembly with name",t,". Falling back to asymmetric unit")},symWithIndex:function(t){if("asym"===this.showRelated())return null;var e=this.structure().assembly(this.showRelated());if(!e)return null;for(var r=e.generators(),n=0;n<r.length;++n){if(r[n].matrices().length>t)return r[n].matrix(t);t-=r[n].matrices().length}return null},showRelated:function(){return this._showRelated},select:function(t){return this.structure().select(t)},structure:function(){return this._vertAssocs[0]._structure},getColorForAtom:function(t,e){return this._vertAssocs[0].getColorForAtom(t,e)},addIdRange:function(t){this._idRanges.push(t)},destroy:function(){O.prototype.destroy.call(this);for(var t=0;t<this._idRanges.length;++t)this._idRanges[t].recycle()},eachCentralAtom:function(t){var e=this.structure(),r=e.assembly(this.showRelated());return null===r?function(t,e){t.eachResidue((function(t){var r=t.centralAtom();null!==r&&e(r,r.pos())}))}(e,t):i(e,r.generators(),t)},addVertAssoc:function(t){this._vertAssocs.push(t)},_vertArraysInvolving:function(t){for(var e=this.vertArrays(),r=[],n={},i=0;i<t.length;++i)n[t[i]]=!0;for(var a=0;a<e.length;++a)!0===n[e[a].chain()]&&r.push(e[a]);return r},_drawSymmetryRelated:function(t,e,r){for(var n=r.generators(),i=0;i<n.length;++i){var a=n[i],o=this._vertArraysInvolving(a.chains());this._drawVertArrays(t,e,o,a.matrices())}},_updateProjectionIntervalsAsym:function(t,e,r,n,i,a){for(var o=this.vertArrays(),s=0;s<o.length;++s)o[s].updateProjectionIntervals(t,e,r,n,i,a)},updateProjectionIntervals:function(t,e,r,n,i,a){if(this._visible){var o=this.showRelated();if("asym"===o)return this._updateProjectionIntervalsAsym(t,e,r,n,i,a);for(var s=this.structure().assembly(o).generators(),u=0;u<s.length;++u)for(var l=s[u],h=this._vertArraysInvolving(l.chains()),c=0;c<l.matrices().length;++c)for(var d=0;d<h.length;++d){var f=l.matrix(c);h[d].updateProjectionIntervals(t,e,r,n,i,a,f)}}},_updateSquaredSphereRadiusAsym:function(t,e){for(var r=this.vertArrays(),n=0;n<r.length;++n)e=r[n].updateSquaredSphereRadius(t,e);return e},updateSquaredSphereRadius:function(t,e){if(!this._visible)return e;var r=this.showRelated();if("asym"===r)return this._updateSquaredSphereRadiusAsym(t,e);for(var n=this.structure().assembly(r).generators(),i=0;i<n.length;++i)for(var a=n[i],o=this._vertArraysInvolving(a.chains()),s=0;s<a.matrices().length;++s)for(var u=0;u<o.length;++u)e=o[u].updateSquaredSphereRadius(t,e);return e},draw:function(t,e,r,n){if(this._visible){var i=this.shaderForStyleAndPass(e,r,n);if(i){var a=this.showRelated();if("asym"===a)return this._drawVertArrays(t,i,this.vertArrays(),null);var o=this.structure().assembly(a);return this._drawSymmetryRelated(t,i,o)}}},colorBy:function(t,e){console.time("BaseGeom.colorBy"),this._ready=!1,e=e||this.structure();for(var r=0;r<this._vertAssocs.length;++r)this._vertAssocs[r].recolor(t,e);console.timeEnd("BaseGeom.colorBy")},setOpacity:function(t,e){console.time("BaseGeom.setOpacity"),this._ready=!1,e=e||this.structure();for(var r=0;r<this._vertAssocs.length;++r)this._vertAssocs[r].setOpacity(t,e);console.timeEnd("BaseGeom.setOpacity")},setSelection:function(t){console.time("BaseGeom.setSelection"),this._selection=t,this._ready=!1;for(var e=0;e<this._vertAssocs.length;++e)this._vertAssocs[e].setSelection(t);console.timeEnd("BaseGeom.setSelection")},selection:function(){return null===this._selection&&(this._selection=this.structure().createEmptyView()),this._selection}}),a}(),N=function(){var e,r=t.vec3;function n(t,e,r){this._gl=t,this._vertBuffer=t.createBuffer(),this._float32Allocator=r||null,this._ready=!1,this._boundingSphere=null;var n=this._FLOATS_PER_VERT*e;this._vertData=r.request(n)}return n.prototype={setColor:function(t,e,r,n,i){var a=t*this._FLOATS_PER_VERT+this._COLOR_OFFSET;this._vertData[a+0]=e,this._vertData[a+1]=r,this._vertData[a+2]=n,this._vertData[a+3]=i,this._ready=!1},getColor:function(t,e){var r=t*this._FLOATS_PER_VERT+this._COLOR_OFFSET;return e[0]=this._vertData[r+0],e[1]=this._vertData[r+1],e[2]=this._vertData[r+2],e[3]=this._vertData[r+3],e},setOpacity:function(t,e){var r=t*this._FLOATS_PER_VERT+this._COLOR_OFFSET;this._vertData[r+3]=e,this._ready=!1},setSelected:function(t,e){var r=t*this._FLOATS_PER_VERT+this._SELECT_OFFSET;this._vertData[r]=e,this._ready=!1},boundingSphere:function(){return this._boundingSphere||(this._boundingSphere=this._calculateBoundingSphere()),this._boundingSphere},_calculateBoundingSphere:function(){var t=this.numVerts();if(0===t)return null;var e,n,i=r.create();for(n=0;n<t;++n)e=n*this._FLOATS_PER_VERT,i[0]+=this._vertData[e+0],i[1]+=this._vertData[e+1],i[2]+=this._vertData[e+2];r.scale(i,i,1/t);var a=0;for(n=0;n<t;++n){e=n*this._FLOATS_PER_VERT;var o=i[0]-this._vertData[e+0],s=i[1]-this._vertData[e+1],u=i[2]-this._vertData[e+2];a=Math.max(a,o*o+s*s+u*u)}return new c.Sphere(i,Math.sqrt(a))},destroy:function(){this._gl.deleteBuffer(this._vertBuffer),this._float32Allocator.release(this._vertData)},bindBuffers:function(){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._vertBuffer),this._ready||(this._gl.bufferData(this._gl.ARRAY_BUFFER,this._vertData,this._gl.STATIC_DRAW),this._ready=!0)},updateSquaredSphereRadius:(e=r.create(),function(t,n,i){var a=this.boundingSphere();if(!a)return n;if(i)return r.transformMat4(e,a.center(),i),Math.max(r.sqrDist(e,t),n);var o=a.radius()*a.radius();return Math.max(r.sqrDist(a.center(),t)+o,n)}),updateProjectionIntervals:function(){var t=r.create();return function(e,n,i,a,o,s,u){var l=this.boundingSphere();if(l){u?r.transformMat4(t,l.center(),u):r.copy(t,l.center());var h=r.dot(e,t),c=r.dot(n,t),d=r.dot(i,t);a.update(h-l.radius()),a.update(h+l.radius()),o.update(c-l.radius()),o.update(c+l.radius()),s.update(d-l.radius()),s.update(d+l.radius())}}}()},n}(),f=function(){function t(t,e,r){N.call(this,t,e,r),this._numVerts=0,this._primitiveType=this._gl.LINES}return n.derive(t,N,{_FLOATS_PER_VERT:9,_POS_OFFSET:0,_COLOR_OFFSET:3,_ID_OFFSET:7,_SELECT_OFFSET:8,numVerts:function(){return this._numVerts},setDrawAsPoints:function(t){this._primitiveType=t?this._gl.POINTS:this._gl.LINES},addPoint:function(t,e,r){var n=this._FLOATS_PER_VERT*this._numVerts;this._vertData[n++]=t[0],this._vertData[n++]=t[1],this._vertData[n++]=t[2],this._vertData[n++]=e[0],this._vertData[n++]=e[1],this._vertData[n++]=e[2],this._vertData[n++]=e[3],this._vertData[n++]=r,this._vertData[n++]=0,this._numVerts+=1,this._ready=!1,this._boundingSphere=null},addLine:function(t,e,r,n,i,a){this.addPoint(t,e,i),this.addPoint(r,n,a)},bindAttribs:function(t){this._gl.vertexAttribPointer(t.posAttrib,3,this._gl.FLOAT,!1,4*this._FLOATS_PER_VERT,4*this._POS_OFFSET),-1!==t.colorAttrib&&(this._gl.vertexAttribPointer(t.colorAttrib,4,this._gl.FLOAT,!1,4*this._FLOATS_PER_VERT,4*this._COLOR_OFFSET),this._gl.enableVertexAttribArray(t.colorAttrib)),this._gl.enableVertexAttribArray(t.posAttrib),-1!==t.objIdAttrib&&(this._gl.vertexAttribPointer(t.objIdAttrib,1,this._gl.FLOAT,!1,4*this._FLOATS_PER_VERT,4*this._ID_OFFSET),this._gl.enableVertexAttribArray(t.objIdAttrib)),-1!==t.selectAttrib&&(this._gl.vertexAttribPointer(t.selectAttrib,1,this._gl.FLOAT,!1,4*this._FLOATS_PER_VERT,4*this._SELECT_OFFSET),this._gl.enableVertexAttribArray(t.selectAttrib))},releaseAttribs:function(t){this._gl.disableVertexAttribArray(t.posAttrib),-1!==t.colorAttrib&&this._gl.disableVertexAttribArray(t.colorAttrib),-1!==t.objIdAttrib&&this._gl.disableVertexAttribArray(t.objIdAttrib),-1!==t.selectAttrib&&this._gl.disableVertexAttribArray(t.selectAttrib)},bind:function(t){this.bindBuffers(),this.bindAttribs(t)},draw:function(){this._gl.drawArrays(this._primitiveType,0,this._numVerts)}}),t}(),_=B=function(){function t(t,e,r,n,i){N.call(this,t,e,n),this._indexBuffer=t.createBuffer(),this._uint16Allocator=i,this._numVerts=0,this._maxVerts=e,this._numTriangles=0,this._indexData=i.request(r)}return n.derive(t,N,{destroy:function(){N.prototype.destroy.call(this),this._gl.deleteBuffer(this._indexBuffer),this._uint16Allocator.release(this._indexData)},setIndexData:function(t){this._ready=!1,this._numTriangles=t.length/3;for(var e=0;e<t.length;++e)this._indexData[e]=t[e]},setVertData:function(t){this._ready=!1,this._numVerts=t.length/this._FLOATS_PER_VERT;for(var e=0;e<t.length;++e)this._vertData[e]=t[e]},numVerts:function(){return this._numVerts},maxVerts:function(){return this._maxVerts},numIndices:function(){return 3*this._numTriangles},addVertex:function(t,e,r,n){if(this._numVerts!==this._maxVerts){var i=this._numVerts*this._FLOATS_PER_VERT;this._vertData[i++]=t[0],this._vertData[i++]=t[1],this._vertData[i++]=t[2],this._vertData[i++]=e[0],this._vertData[i++]=e[1],this._vertData[i++]=e[2],this._vertData[i++]=r[0],this._vertData[i++]=r[1],this._vertData[i++]=r[2],this._vertData[i++]=r[3],this._vertData[i++]=n,this._vertData[i++]=0,this._numVerts+=1,this._ready=!1}else console.error("maximum number of vertices reached")},_FLOATS_PER_VERT:12,_BYTES_PER_VERT:48,_OBJID_OFFSET:10,_OBJID_BYTE_OFFSET:40,_SELECT_OFFSET:11,_SELECT_BYTE_OFFSET:44,_COLOR_OFFSET:6,_COLOR_BYTE_OFFSET:24,_NORMAL_OFFSET:3,_NORMAL_BYTE_OFFSET:12,_POS_OFFSET:0,_POS_BYTE_OFFSET:0,addTriangle:function(t,e,r){var n=3*this._numTriangles;n+2>=this._indexData.length||(this._indexData[n++]=t,this._indexData[n++]=e,this._indexData[n++]=r,this._numTriangles+=1,this._ready=!1)},bindBuffers:function(){var t=this._ready,e=this._gl;N.prototype.bindBuffers.call(this),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer),t||e.bufferData(e.ELEMENT_ARRAY_BUFFER,this._indexData,e.STATIC_DRAW)},bindAttribs:function(t){var e=this._gl,r=this._BYTES_PER_VERT;e.enableVertexAttribArray(t.posAttrib),e.vertexAttribPointer(t.posAttrib,3,e.FLOAT,!1,r,this._POS_BYTE_OFFSET),-1!==t.normalAttrib&&(e.enableVertexAttribArray(t.normalAttrib),e.vertexAttribPointer(t.normalAttrib,3,e.FLOAT,!1,r,this._NORMAL_BYTE_OFFSET)),-1!==t.colorAttrib&&(e.vertexAttribPointer(t.colorAttrib,4,e.FLOAT,!1,r,this._COLOR_BYTE_OFFSET),e.enableVertexAttribArray(t.colorAttrib)),-1!==t.objIdAttrib&&(e.vertexAttribPointer(t.objIdAttrib,1,e.FLOAT,!1,r,this._OBJID_BYTE_OFFSET),e.enableVertexAttribArray(t.objIdAttrib)),-1!==t.selectAttrib&&(e.vertexAttribPointer(t.selectAttrib,1,e.FLOAT,!1,r,this._SELECT_BYTE_OFFSET),e.enableVertexAttribArray(t.selectAttrib))},releaseAttribs:function(t){var e=this._gl;e.disableVertexAttribArray(t.posAttrib),-1!==t.colorAttrib&&e.disableVertexAttribArray(t.colorAttrib),-1!==t.normalAttrib&&e.disableVertexAttribArray(t.normalAttrib),-1!==t.objIdAttrib&&e.disableVertexAttribArray(t.objIdAttrib),-1!==t.selectAttrib&&e.disableVertexAttribArray(t.selectAttrib)},bind:function(t){this.bindBuffers(),this.bindAttribs(t)},draw:function(){var t=this._gl;t.drawElements(t.TRIANGLES,3*this._numTriangles,t.UNSIGNED_SHORT,0)}}),t}(),m=function(t){function e(e,r,n,i){t.call(this,r,n,i),this._chain=e}function r(t,e,r,n,i,a){B.call(this,e,r,n,i,a),this._chain=t}return n.derive(e,t,{chain:function(){return this._chain},drawSymmetryRelated:function(t,e,r){this.bind(e);for(var n=0;n<r.length;++n)t.bind(e,r[n]),this._gl.uniform1i(e.symId,n),this.draw();this.releaseAttribs(e)}}),n.derive(r,B,{chain:function(){return this._chain}}),r.prototype.drawSymmetryRelated=e.prototype.drawSymmetryRelated,{LineChainData:e,MeshChainData:r}}(f),v=function(t,e){var r=t.MeshChainData;function i(t,e,r){k.call(this,t),this._indexedVAs=[],this._float32Allocator=e,this._uint16Allocator=r,this._remainingVerts=null,this._remainingIndices=null}return n.derive(i,k,{_boundedVertArraySize:function(t){return Math.min(65536,t)},addChainVertArray:function(t,e,n){this._remainingVerts=e,this._remainingIndices=n;var i=new r(t.name(),this._gl,this._boundedVertArraySize(e),n,this._float32Allocator,this._uint16Allocator);return this._indexedVAs.push(i),i},addVertArray:function(t,r){this._remainingVerts=t,this._remainingIndices=r;var n=new e(this._gl,this._boundedVertArraySize(t),r,this._float32Allocator,this._uint16Allocator);return this._indexedVAs.push(n),n},vertArrayWithSpaceFor:function(t){var n=this._indexedVAs[this._indexedVAs.length-1];if(n.maxVerts()-n.numVerts()>=t)return n;this._remainingVerts-=n.numVerts(),this._remainingIndices-=n.numIndices(),t=this._boundedVertArraySize(this._remainingVerts);var i=null;return i=n instanceof r?new r(n.chain(),this._gl,t,this._remainingIndices,this._float32Allocator,this._uint16Allocator):new e(this._gl,t,this._remainingIndices,this._float32Allocator,this._uint16Allocator),this._indexedVAs.push(i),i},vertArray:function(t){return this._indexedVAs[t]},destroy:function(){k.prototype.destroy.call(this);for(var t=0;t<this._indexedVAs.length;++t)this._indexedVAs[t].destroy();this._indexedVAs=[]},numVerts:function(){return this._indexedVAs[0].numVerts()},shaderForStyleAndPass:function(t,e,r){if("normal"===r)return"hemilight"===e?t.hemilight:t.phong;if("select"===r)return t.select;if("outline"===r)return t.outline;var n=t[r];return void 0!==n?n:null},_drawVertArrays:function(t,e,r,n){var i;if(n)for(i=0;i<r.length;++i)r[i].drawSymmetryRelated(t,e,n);else for(t.bind(e),this._gl.uniform1i(e.symId,255),i=0;i<r.length;++i)r[i].bind(e),r[i].draw(),r[i].releaseAttribs(e)},vertArrays:function(){return this._indexedVAs},addVertex:function(t,e,r,n){this._indexedVAs[0].addVertex(t,e,r,n)},addTriangle:function(t,e,r){this._indexedVAs[0].addTriangle(t,e,r)}}),i}(m,_),p=function(t){var e=t.LineChainData;function r(t,e){k.call(this,t),this._vertArrays=[],this._float32Allocator=e,this._lineWidth=.5,this._pointSize=1}return n.derive(r,k,{addChainVertArray:function(t,r){var n=new e(t.name(),this._gl,r,this._float32Allocator);return this._vertArrays.push(n),n},setLineWidth:function(t){this._lineWidth=t},setPointSize:function(t){this._pointSize=t},vertArrays:function(){return this._vertArrays},shaderForStyleAndPass:function(t,e,r){return"outline"===r?t.selectLines:"select"===r?t.select:t.lines},destroy:function(){k.prototype.destroy.call(this);for(var t=0;t<this._vertArrays.length;++t)this._vertArrays[t].destroy();this._vertArrays=[]},_drawVertArrays:function(t,e,r,n){var i,a=t.upsamplingFactor();if(-1!==e.selectAttrib&&(a=4*t.upsamplingFactor()),n)for(t.bind(e),this._gl.lineWidth(a*this._lineWidth),e.pointSize&&this._gl.uniform1f(e.pointSize,a*this._pointSize),i=0;i<r.length;++i)r[i].drawSymmetryRelated(t,e,n);else for(t.bind(e),this._gl.lineWidth(a*this._lineWidth),this._gl.uniform1i(e.symId,255),e.pointSize&&this._gl.uniform1f(e.pointSize,a*this._pointSize),i=0;i<r.length;++i)r[i].bind(e),r[i].draw(),r[i].releaseAttribs(e)},vertArray:function(){return this._va}}),r}(m),g=function(){function t(t,e){this._structure=t,this._assocs=[],this._callBeginEnd=e}function r(t,e,r){this._structure=t,this._assocs=[],this._callBeginEnd=r,this._interpolation=e||1,this._perResidueColors={}}return t.prototype={addAssoc:function(t,e,r,n){this._assocs.push({atom:t,vertexArray:e,vertStart:r,vertEnd:n})},recolor:function(t,e){var r=new Float32Array(4*e.atomCount());this._callBeginEnd&&t.begin(this._structure);var n={};e.eachAtom((function(e,i){n[e.index()]=i,t.colorFor(e,r,4*i)})),this._callBeginEnd&&t.end(this._structure);for(var i=0;i<this._assocs.length;++i){var a=this._assocs[i],o=n[a.atom.index()];if(void 0!==o)for(var s=r[4*o+0],u=r[4*o+1],l=r[4*o+2],h=r[4*o+3],c=a.vertexArray,d=a.vertStart;d<a.vertEnd;++d)c.setColor(d,s,u,l,h)}},getColorForAtom:function(t,e){for(var r=0;r<this._assocs.length;++r){var n=this._assocs[r];if(n.atom.full()===t.full())return n.vertexArray.getColor(n.vertStart,e)}return null},setSelection:function(t){var e={};t.eachAtom((function(t){e[t.index()]=!0}));for(var r=0;r<this._assocs.length;++r)for(var n=this._assocs[r],i=!0!==e[n.atom.index()]?0:1,a=n.vertexArray,o=n.vertStart;o<n.vertEnd;++o)a.setSelected(o,i)},setOpacity:function(t,e){var r={};e.eachAtom((function(t){r[t.index()]=!0}));for(var n=0;n<this._assocs.length;++n){var i=this._assocs[n];if(!0===r[i.atom.index()])for(var a=i.vertexArray,o=i.vertStart;o<i.vertEnd;++o)a.setOpacity(o,t)}}},r.prototype={setPerResidueColors:function(t,e){this._perResidueColors[t]=e},addAssoc:function(t,e,r,n,i){this._assocs.push({traceIndex:t,slice:r,vertStart:n,vertEnd:i,vertexArray:e})},recolor:function(t,r){this._callBeginEnd&&t.begin(this._structure);var n,i,a=[],o=this._structure.backboneTraces();for(console.assert(this._perResidueColors,"per-residue colors must be set for recoloring to work"),n=0;n<o.length;++n){var s=this._perResidueColors[n];console.assert(s,"no per-residue colors. Seriously, man?");var u=0,l=o[n];for(i=0;i<l.length();++i)r.containsResidue(l.residueAt(i))?(t.colorFor(l.centralAtomAt(i),s,u),u+=4):u+=4;this._interpolation>1?a.push(e.interpolateColor(s,this._interpolation)):a.push(s)}for(n=0;n<this._assocs.length;++n){var h=this._assocs[n],c=h.slice,d=a[h.traceIndex],f=d[4*c],_=d[4*c+1],m=d[4*c+2],v=d[4*c+3],p=h.vertexArray;for(i=h.vertStart;i<h.vertEnd;++i)p.setColor(i,f,_,m,v)}this._callBeginEnd&&t.end(this._structure)},getColorForAtom:function(t,e){var r,n,i=this._structure.backboneTraces(),a=t.full().residue();for(r=0;r<i.length;++r){var o=this._perResidueColors[r],s=0,u=i[r];for(n=0;n<u.length();++n){if(a===u.residueAt(n).full())return e[0]=o[s+0],e[1]=o[s+1],e[2]=o[s+2],e[3]=o[s+3],e;s+=4}}return null},setSelection:function(t){var e,r,n=[],i=this._structure.backboneTraces();for(e=0;e<i.length;++e){var a=new Float32Array(this._perResidueColors[e].length),o=0,s=i[e];for(r=0;r<s.length();++r){var u=t.containsResidue(s.residueAt(r))?1:0;a[o]=u,o+=1}this._interpolation>1?n.push(c.interpolateScalars(a,this._interpolation)):n.push(a)}for(e=0;e<this._assocs.length;++e){var l=this._assocs[e],h=l.slice,d=n[l.traceIndex][h],f=l.vertexArray;for(r=l.vertStart;r<l.vertEnd;++r)f.setSelected(r,d)}},setOpacity:function(t,r){var n,i,a=[],o=this._structure.backboneTraces();for(n=0;n<o.length;++n){var s=this._perResidueColors[n],u=0,l=o[n];for(i=0;i<l.length();++i)r.containsResidue(l.residueAt(i))?(s[u+3]=t,u+=4):u+=4;this._interpolation>1?a.push(e.interpolateColor(s,this._interpolation)):a.push(s)}for(n=0;n<this._assocs.length;++n){var h=this._assocs[n],c=h.slice,d=a[h.traceIndex][4*c+3],f=h.vertexArray;for(i=h.vertStart;i<h.vertEnd;++i)f.setOpacity(i,d)}}},{TraceVertexAssoc:r,AtomVertexAssoc:t}}(),b=function(r,n,i,a){var o,s,u,l=t.vec3,h=t.vec4,d=t.mat3,f=r.TubeProfile,_=r.ProtoSphere,m=r.ProtoCylinder,v=a.TraceVertexAssoc,p=a.AtomVertexAssoc,g=e.interpolateColor,b={},A=.7071,y=[-A,-A,0,A,-A,0,A,A,0,-A,A,0],S=[-6*A,-.9*A,0,-5.8*A,-1*A,0,5.8*A,-1*A,0,6*A,-.9*A,0,6*A,.9*A,0,5.8*A,1*A,0,-5.8*A,1*A,0,-6*A,.9*A,0],R=[-7.071,-.9*A,0,-9.8*A,-1*A,0,9.8*A,-1*A,0,7.071,-.9*A,0,7.071,.9*A,0,9.8*A,1*A,0,-9.8*A,1*A,0,-7.071,.9*A,0],C=(o=l.create(),s=l.create(),u=l.create(),function(t,e,r,n){e=Math.max(e,1),r=Math.min(n-1,r);var i=3*(e-1);l.set(o,t[i],t[i+1],t[i+2]),l.set(u,t[3*e],t[3*e+1],t[3*e+2]);for(var a=e;a<r;++a)i=3*(a+1),l.set(s,t[i],t[i+1],t[i+2]),t[3*a+0]=.25*s[0]+.5*u[0]+.25*o[0],t[3*a+1]=.25*s[1]+.5*u[1]+.25*o[1],t[3*a+2]=.25*s[2]+.5*u[2]+.25*o[2],l.copy(o,u),l.copy(u,s)}),w=function(){var t=h.fromValues(0,0,0,1);return function(e,r,n,i){var a=i.atomCount(),o=n.idPool.getContinuousRange(a);e.addIdRange(o);var s=n.protoSphere.numVerts(),u=n.protoSphere.numIndices(),l=1.5*n.radiusMultiplier;e.addChainVertArray(i,s*a,u*a),i.eachAtom((function(i){var a=e.vertArrayWithSpaceFor(s);n.color.colorFor(i,t,0);var u=a.numVerts(),h=o.nextId({geom:e,atom:i});n.protoSphere.addTransformed(a,i.pos(),l,t,h);var c=a.numVerts();r.addAssoc(i,a,u,c)}))}}();b.spheres=function(t,e,r){console.time("spheres");var i=new _(r.sphereDetail,r.sphereDetail);r.protoSphere=i;var a=new n(e,r.float32Allocator,r.uint16Allocator),o=new p(t,!0);return a.addVertAssoc(o),a.setShowRelated(r.showRelated),r.color.begin(t),t.eachChain((function(t){w(a,o,r,t)})),r.color.end(t),console.timeEnd("spheres"),a};var E=function(){var t=l.create(),e=l.create(),r=h.fromValues(0,0,0,1),n=l.create(),i=l.create(),a=d.create();return function(o,s,u,h){var d=h.atomCount(),f=0;h.eachAtom((function(t){f+=t.bonds().length}));var _=d*u.protoSphere.numVerts()+f*u.protoCyl.numVerts(),m=d*u.protoSphere.numIndices()+f*u.protoCyl.numIndices();o.addChainVertArray(h,_,m);var v=u.idPool.getContinuousRange(d);o.addIdRange(v),h.eachAtom((function(h){var d=u.protoSphere.numVerts()+h.bondCount()*u.protoCyl.numVerts(),f=o.vertArrayWithSpaceFor(d),_=f.numVerts(),m=v.nextId({geom:o,atom:h});u.color.colorFor(h,r,0),u.protoSphere.addTransformed(f,h.pos(),u.radius,r,m),h.eachBond((function(o){o.mid_point(t),l.sub(e,h.pos(),t);var s=l.length(e);l.scale(e,e,1/s),c.buildRotation(a,e,n,i,!1),l.add(t,t,h.pos()),l.scale(t,t,.5),u.protoCyl.addTransformed(f,t,s,u.radius,a,r,r,m,m)}));var p=f.numVerts();s.addAssoc(h,f,_,p)}))}}();b.ballsAndSticks=function(t,e,r){console.time("ballsAndSticks");var i=new p(t,!0),a=new _(r.sphereDetail,r.sphereDetail),o=new m(r.arcDetail);r.protoSphere=a,r.protoCyl=o;var s=new n(e,r.float32Allocator,r.uint16Allocator);return s.addVertAssoc(i),s.setShowRelated(r.showRelated),r.color.begin(t),t.eachChain((function(t){E(s,i,r,t)})),r.color.end(t),console.timeEnd("ballsAndSticks"),s};var T,x=(T=h.fromValues(0,0,0,1),function(t,e,r,n){var i=r.atomCount(),a=n.idPool.getContinuousRange(i);t.addIdRange(a);var o=t.addChainVertArray(r,i);o.setDrawAsPoints(!0),r.eachAtom((function(r){var i=o.numVerts();n.color.colorFor(r,T,0);var s=a.nextId({geom:t,atom:r});o.addPoint(r.pos(),T,s);var u=o.numVerts();e.addAssoc(r,o,i,u)}))});b.points=function(t,e,r){console.time("points");var n=new p(t,!0);r.color.begin(t);var a=new i(e,r.float32Allocator);return a.setPointSize(r.pointSize),a.addVertAssoc(n),a.setShowRelated(r.showRelated),t.eachChain((function(t){x(a,n,t,r)})),r.color.end(t),console.timeEnd("points"),a};var M=function(){var t=l.create(),e=h.fromValues(0,0,0,1);return function(r,n,i,a){var o=0,s=i.atomCount(),u=a.idPool.getContinuousRange(s);r.addIdRange(u),i.eachAtom((function(t){var e=t.bonds().length;o+=e||3}));var l=r.addChainVertArray(i,2*o);i.eachAtom((function(i){var o=l.numVerts(),s=u.nextId({geom:r,atom:i});if(i.bonds().length)i.eachBond((function(r){r.mid_point(t),a.color.colorFor(i,e,0),l.addLine(i.pos(),e,t,e,s,s)}));else{var h=i.pos();a.color.colorFor(i,e,0),l.addLine([h[0]-.2,h[1],h[2]],e,[h[0]+.2,h[1],h[2]],e,s,s),l.addLine([h[0],h[1]-.2,h[2]],e,[h[0],h[1]+.2,h[2]],e,s,s),l.addLine([h[0],h[1],h[2]-.2],e,[h[0],h[1],h[2]+.2],e,s,s)}var c=l.numVerts();n.addAssoc(i,l,o,c)}))}}();b.lines=function(t,e,r){console.time("lines");var n=new p(t,!0);r.color.begin(t);var a=new i(e,r.float32Allocator);return a.setLineWidth(r.lineWidth),a.addVertAssoc(n),a.setShowRelated(r.showRelated),t.eachChain((function(t){M(a,n,t,r)})),r.color.end(t),console.timeEnd("lines"),a};var F,D,V,I,P=(F=h.fromValues(0,0,0,1),D=h.fromValues(0,0,0,1),V=l.create(),I=l.create(),function(t,e,r,n,i,a){e.addAssoc(n,r,0,r.numVerts(),r.numVerts()+1);var o=a.float32Allocator.request(4*i.length()),s=a.idPool.getContinuousRange(i.length());t.addIdRange(s);for(var u,l=s.nextId({geom:t,atom:i.centralAtomAt(0)}),h=1;h<i.length();++h){a.color.colorFor(i.centralAtomAt(h-1),F,0),o[4*(h-1)+0]=F[0],o[4*(h-1)+1]=F[1],o[4*(h-1)+2]=F[2],o[4*(h-1)+3]=F[3],a.color.colorFor(i.centralAtomAt(h),D,0),i.posAt(V,h-1),i.posAt(I,h),u=s.nextId({geom:t,atom:i.centralAtomAt(h)}),r.addLine(V,F,I,D,l,u),l=u,u=null;var c=r.numVerts();e.addAssoc(n,r,h,c-1,c+(h===i.length()-1?0:1))}return o[4*i.length()-4]=D[0],o[4*i.length()-3]=D[1],o[4*i.length()-2]=D[2],o[4*i.length()-1]=D[3],e.setPerResidueColors(n,o),n+1});b.lineTrace=function(t,e,r){console.time("lineTrace");var n=new v(t,1,!0);r.color.begin(t);var a=new i(e,r.float32Allocator);a.setLineWidth(r.lineWidth);var o=0;return t.eachChain((function(t){o=function(t,e,r,n,i){for(var a=i.backboneTraces(),o=function(t){for(var e=0,r=0;r<t.length;++r)e+=2*(t[r].length()-1);return e}(a),s=t.addChainVertArray(i,o),u=0;u<a.length;++u)n=P(t,e,s,n,a[u],r);return n}(a,n,r,o,t)})),a.addVertAssoc(n),a.setShowRelated(r.showRelated),r.color.end(t),console.timeEnd("lineTrace"),a};var L=function(){var t=l.create(),e=l.create(),r=h.fromValues(0,0,0,1),n=h.fromValues(0,0,0,1);return function(i,a,o,s,u,l){var h,d=l.fullTraceIndex(0),f=s.float32Allocator.request(3*l.length()),_=s.float32Allocator.request(4*l.length()),m=[],v=s.idPool.getContinuousRange(l.length());for(i.addIdRange(v),h=0;h<l.length();++h){var p=l.centralAtomAt(h);l.smoothPosAt(t,h,s.strength),s.color.colorFor(p,_,4*h),f[3*h]=t[0],f[3*h+1]=t[1],f[3*h+2]=t[2],m.push(v.nextId({geom:i,atom:p}))}var b=m[0],A=0,y=c.catmullRomSpline(f,l.length(),s.splineDetail,s.strength,!1,s.float32Allocator),S=g(_,s.splineDetail),R=o.numVerts();a.addAssoc(u,o,d,R,R+1);var C=Math.floor(s.splineDetail/2),w=c.catmullRomSplineNumPoints(l.length(),s.splineDetail,!1);for(h=1;h<w;++h){t[0]=y[3*(h-1)],t[1]=y[3*(h-1)+1],t[2]=y[3*(h-1)+2],e[0]=y[3*(h-0)],e[1]=y[3*(h-0)+1],e[2]=y[3*(h-0)+2],r[0]=S[4*(h-1)+0],r[1]=S[4*(h-1)+1],r[2]=S[4*(h-1)+2],r[3]=S[4*(h-1)+3],n[0]=S[4*(h-0)+0],n[1]=S[4*(h-0)+1],n[2]=S[4*(h-0)+2],n[3]=S[4*(h-0)+3];var E=Math.floor((h+C)/s.splineDetail);A=m[Math.min(m.length-1,E)],o.addLine(t,r,e,n,b,A),b=A;var T=o.numVerts();a.addAssoc(u,o,d+h,T-1,T+(h===l.length-1?0:1))}return a.setPerResidueColors(u,_),s.float32Allocator.release(f),s.float32Allocator.release(y),u+1}}();b.sline=function(t,e,r){console.time("sline"),r.color.begin(t);var n=new v(t,r.splineDetail,1,!0),a=new i(e,r.float32Allocator);a.addVertAssoc(n),a.setLineWidth(r.lineWidth),a.setShowRelated(r.showRelated);var o=0;return t.eachChain((function(t){o=function(t,e,r,n,i){for(var a=n.backboneTraces(),o=function(t,e){for(var r=0,n=0;n<t.length;++n)r+=2*(e*(t[n].length()-1)+1);return r}(a,r.splineDetail),s=t.addChainVertArray(n,o),u=0;u<a.length;++u)i=L(t,e,s,r,i,a[u]);return i}(a,n,r,t,o)})),r.color.end(t),console.timeEnd("sline"),a};var O=function(t,e,r){for(var n=0,i=0;i<t.length;++i)n+=t[i].length()*e,n+=(t[i].length()-1)*r;return n};b.trace=function(t,e,r){console.time("trace"),r.protoCyl=new m(r.arcDetail),r.protoSphere=new _(r.sphereDetail,r.sphereDetail);var i=new n(e,r.float32Allocator,r.uint16Allocator),a=new v(t,1,!0);i.addVertAssoc(a),i.setShowRelated(r.showRelated),r.color.begin(t);var o=0;return t.eachChain((function(t){o=function(t,e,r,n,i){var a=i.backboneTraces(),o=O(a,r.protoSphere.numVerts(),r.protoCyl.numVerts()),s=function(t,e,r){for(var n=0,i=0;i<t.length;++i)n+=t[i].length()*e,n+=(t[i].length()-1)*r;return n}(a,r.protoSphere.numIndices(),r.protoCyl.numIndices());t.addChainVertArray(i,o,s);for(var u=0;u<a.length;++u)Y(t,e,a[u],n,r),n++;return n}(i,a,r,o,t)})),r.color.end(t),console.timeEnd("trace"),i};var N=function(t,e,r){for(var n=0,i=0;i<t.length;++i){var a=((t[i].length()-1)*r+1)*e;n+=a+(Math.ceil((a+2)/65536)-1)*e,n+=2}return n},B=function(){var t=d.create(),e=l.create(),r=l.create(),n=l.create(),i=l.create(),a=h.create();return function(o,s,u,h){for(var d=1.8*h.radius,f=h.protoCyl.numVerts()+2*h.protoSphere.numVerts(),_=0;_<u.length;++_){var m=u[_],v=h.idPool.getContinuousRange(m.length());o.addIdRange(v);for(var p=0;p<m.length();++p){var g=o.vertArrayWithSpaceFor(f),b=g.numVerts(),A=m.residueAt(p),y=A.name(),S=A.atom("C3'"),R=null;if(null!==(R="A"===y||"G"===y||"DA"===y||"DG"===y?A.atom("N1"):A.atom("N3"))&&null!==S){var C=v.nextId({geom:o,atom:R});l.add(i,S.pos(),R.pos()),l.scale(i,i,.5),h.color.colorFor(R,a,0),l.sub(n,R.pos(),S.pos());var w=l.length(n);l.scale(n,n,1/w),c.buildRotation(t,n,r,e,!1),h.protoCyl.addTransformed(g,i,w,d,t,a,a,C,C),h.protoSphere.addTransformed(g,R.pos(),d,a,C),h.protoSphere.addTransformed(g,S.pos(),d,a,C);var E=g.numVerts();console.assert(E<=65536,"too many vertices"),s.addAssoc(R,g,b,E)}}}}}();b.cartoon=function(t,e,r){console.time("cartoon"),r.arrowSkip=Math.floor(3*r.splineDetail/4),r.coilProfile=new f(y,r.arcDetail,1),r.arrowProfile=new f(R,r.arcDetail/2,.1),r.helixProfile=new f(S,r.arcDetail/2,.1),r.strandProfile=new f(S,r.arcDetail/2,.1),r.protoCyl=new m(4*r.arcDetail),r.protoSphere=new _(4*r.arcDetail,4*r.arcDetail);var i=new n(e,r.float32Allocator,r.uint16Allocator),a=new v(t,r.splineDetail,!0);i.addVertAssoc(a),i.setShowRelated(r.showRelated),r.color.begin(t);var o=0,s=t.select({anames:["N1","N3"]}),u=new p(s,!0);return i.addVertAssoc(u),t.eachChain((function(t){o=function(t,e,r,n,i,a){for(var o=a.backboneTraces(),s=N(o,4*n.arcDetail,n.splineDetail),u=function(t,e,r){for(var n=0,i=0;i<t.length;++i)n+=(t[i].length()*r-1)*e*6,n+=6*e;return n}(o,4*n.arcDetail,n.splineDetail),l=[],h=n.protoCyl.numVerts()+2*n.protoSphere.numVerts(),c=n.protoCyl.numIndices()+2*n.protoSphere.numIndices(),d=0;d<o.length;++d){var f=o[d];f.residueAt(0).isNucleotide()&&(l.push(f),s+=f.length()*h,u+=f.length()*c)}t.addChainVertArray(a,s,u);for(var _=0;_<o.length;++_)i=G(t,e,o[_],i,n);return B(t,r,l,n),i}(i,a,u,r,o,t)})),r.color.end(t),console.timeEnd("cartoon"),i},b.surface=function(){var t=l.create(),e=l.create(),r=h.fromValues(.8,.8,.8,1);return function(i,a,o){var s=0;i.getUint32(0),s+=4;var u=i.getUint32(s),h=24*u+(s+=4),c=i.getUint32(h),d=new n(a,o.float32Allocator,o.uint16Allocator);d.setShowRelated("asym");var f,_=d.addVertArray(u,3*c);for(f=0;f<u;++f)l.set(t,i.getFloat32(s+0),i.getFloat32(s+4),i.getFloat32(s+8)),s+=12,l.set(e,i.getFloat32(s+0),i.getFloat32(s+4),i.getFloat32(s+8)),s+=12,_.addVertex(t,e,r,0);for(s=h+4,f=0;f<c;++f){var m=i.getUint32(s+0),v=i.getUint32(s+4),p=i.getUint32(s+8);s+=12,_.addTriangle(m-1,p-1,v-1)}return d}}();var k,z,q,U,j,W=(k=d.create(),z=l.create(),function(t,e,r,n,i,a,o,s,u,h,d){var f=u.coilProfile;"C"===n||u.forceTube?s?c.ortho(r,i):l.cross(r,z,i):"H"===n?f=u.helixProfile:"E"===n?f=u.strandProfile:"A"===n&&(f=u.arrowProfile),c.buildRotation(k,i,r,z,!0),f.addTransformed(t,e,o,k,a,s,h,d)}),H=(q=l.create(),U=l.create(),j=l.create(),function(t,e,r,n,i,a,o,s){var u=null,h=null,c=e.length();l.set(j,0,0,0);for(var d=0;d<c;++d){a.push(o.nextId({geom:t,atom:e.centralAtomAt(d)})),e.smoothPosAt(q,d,s.strength),n[3*d]=q[0],n[3*d+1]=q[1],n[3*d+2]=q[2],e.smoothNormalAt(U,d,s.strength);var f=e.centralAtomAt(d);s.color.colorFor(f,r,4*d),l.dot(U,j)<0&&l.scale(U,U,-1),"E"!==e.residueAt(d).ss()||s.forceTube||(null===u&&(u=d),h=d),"C"===e.residueAt(d).ss()&&null!==u&&(C(n,u,h,c),C(i,u,h,c),u=null,h=null),i[3*d]=n[3*d]+U[0]+j[0],i[3*d+1]=n[3*d+1]+U[1]+j[1],i[3*d+2]=n[3*d+2]+U[2]+j[2],l.copy(j,U)}}),G=function(){var t=l.create(),e=l.create(),r=h.fromValues(0,0,0,1),n=l.create(),i=l.create();return function(a,o,s,u,d){var f=N([s],4*d.arcDetail,d.splineDetail),_=d.float32Allocator.request(3*s.length()),m=d.float32Allocator.request(4*s.length()),v=d.float32Allocator.request(3*s.length()),p=[],b=d.idPool.getContinuousRange(s.length());a.addIdRange(b),H(a,s,m,_,v,p,b,d);var A=a.vertArrayWithSpaceFor(f),y=c.catmullRomSpline(_,s.length(),d.splineDetail,d.strength,!1,d.float32Allocator),S=c.catmullRomSpline(v,s.length(),d.splineDetail,d.strength,!1,d.float32Allocator);o.setPerResidueColors(u,m);var R=d.radius*(s.residueAt(0).isAminoacid()?1:1.8),C=g(m,d.splineDetail);l.set(t,y[3]-y[0],y[4]-y[1],y[5]-y[2]),l.set(e,y[0],y[1],y[2]),l.set(n,S[0]-y[0],S[1]-y[0],S[2]-y[2]),l.normalize(t,t),l.normalize(n,n),h.set(r,C[0],C[1],C[2],C[3]);var w=A.numVerts();A.addVertex(e,[-t[0],-t[1],-t[2]],r,p[0]),W(A,e,n,s.residueAt(0).ss(),t,r,R,!0,d,0,p[0]),function(t,e,r){for(var n=0;n<r-1;++n)t.addTriangle(e,e+1+n,e+2+n);t.addTriangle(e,e+r,e+1)}(A,w,4*d.arcDetail);var E=A.numVerts(),T=0;o.addAssoc(u,A,T,w,E),T+=1;for(var x=Math.floor(d.splineDetail/2),M=c.catmullRomSplineNumPoints(s.length(),d.splineDetail,!1),F=4*d.arcDetail,D=1,V=M;D<V;++D){var I=3*D,P=4*D,L=3*(D+1),O=3*(D-1);l.set(e,y[I],y[I+1],y[I+2]),D===V-1?l.set(t,y[I]-y[O],y[I+1]-y[O+1],y[I+2]-y[O+2]):l.set(t,y[L]-y[O],y[L+1]-y[O+1],y[L+2]-y[O+2]),l.normalize(t,t),h.set(r,C[P],C[P+1],C[P+2],C[P+3]);var B=0,k=Math.floor(D/d.splineDetail),z=Math.floor((D-1)/d.splineDetail),q=Math.floor((D+d.arrowSkip)/d.splineDetail),U=!1,j=s.residueAt(k).ss();if(!d.forceTube){if(k!==z&&"C"===s.residueAt(z).ss()&&("H"===j||"E"===j)){l.set(i,S[O]-y[O],S[O+1]-y[O+1],S[O+2]-y[O+2]),l.normalize(i,i);var G=2*Math.PI/(4*d.arcDetail),Y=c.signedAngle(n,i,t);B=((B=Math.round(Y/G))+4*d.arcDetail)%(4*d.arcDetail)}q!==k&&q<s.length()&&"C"===s.residueAt(q).ss()&&"E"===j&&(U=!0)}l.set(n,S[3*D]-y[I],S[I+1]-y[I+1],S[I+2]-y[I+2]),l.normalize(n,n),w=A.numVerts();var X=Math.floor((D+x)/d.splineDetail),Z=p[Math.min(p.length-1,X)];W(A,e,n,j,t,r,R,!1,d,B,Z);var K=D===V-1?1:F;A.numVerts()+K>A.maxVerts()&&(E=A.numVerts(),o.addAssoc(u,A,T,w,E),A=a.vertArrayWithSpaceFor(K),w=0,W(A,e,n,j,t,r,R,!0,d,0,Z)),U&&(o.addAssoc(u,A,T,w,E),W(A,e,n,"A",t,r,R,!1,d,0,Z),D+=d.arrowSkip),E=A.numVerts(),D===V-1&&(E+=1),o.addAssoc(u,A,T,w,E),T+=1,U&&(T+=d.arrowSkip)}return A.addVertex(e,t,r,p[p.length-1]),function(t,e,r){for(var n=e+r,i=0;i<r-1;++i)t.addTriangle(n,e+i+1,e+i);t.addTriangle(n,e,e+r-1)}(A,w,4*d.arcDetail),d.float32Allocator.release(v),d.float32Allocator.release(_),u+1}}(),Y=function(){var t=d.create(),e=l.create(),r=l.create(),n=l.create(),i=l.create(),a=l.create(),o=l.create(),s=h.fromValues(0,0,0,1),u=h.fromValues(0,0,0,1);return function(h,d,f,_,m){if(0!==f.length()){var v=m.idPool.getContinuousRange(f.length());h.addIdRange(v),m.color.colorFor(f.centralAtomAt(0),s,0);var p=O([f],m.protoSphere.numVerts(),m.protoCyl.numVerts()),g=p,b=h.vertArrayWithSpaceFor(p),A=b.maxVerts(),y=b.numVerts();f.posAt(a,0);var S=v.nextId({geom:h,atom:f.centralAtomAt(0)}),R=0;m.protoSphere.addTransformed(b,a,m.radius,s,S);var C=null;d.addAssoc(_,b,0,y,C);var w=m.float32Allocator.request(4*f.length());w[0]=s[0],w[1]=s[1],w[2]=s[2],w[3]=s[3];for(var E=m.protoCyl.numVerts()+m.protoSphere.numVerts(),T=1;T<f.length();++T){R=v.nextId({geom:h,atom:f.centralAtomAt(T)}),f.posAt(a,T-1),f.posAt(o,T),m.color.colorFor(f.centralAtomAt(T),u,0),w[4*T+0]=u[0],w[4*T+1]=u[1],w[4*T+2]=u[2],w[4*T+3]=u[3],l.sub(e,o,a);var x=l.length(e);l.scale(e,e,1/x),c.buildRotation(t,e,r,n,!1),l.copy(i,a),l.add(i,i,o),l.scale(i,i,.5),E>A-b.numVerts()&&(b=h.vertArrayWithSpaceFor(g)),g-=E;var M=b.numVerts();m.protoCyl.addTransformed(b,i,x,m.radius,t,s,u,S,R),C=b.numVerts(),C-=(C-M)/2,m.protoSphere.addTransformed(b,o,m.radius,u,R),S=R,d.addAssoc(_,b,T,y,C),y=C,l.copy(s,u)}d.setPerResidueColors(_,w),d.addAssoc(_,b,f.length()-1,y,b.numVerts())}}}();return b}(d,v,p,g),A=function(){function t(t,e,r,n,i,a){O.call(this,t);var o=a||{};this._options={},this._options.fillStyle=o.fillStyle||"#000",this._options.backgroundAlpha=o.backgroundAlpha||0,this._options.fontSize=o.fontSize||24,this._options.font=o.font||"Verdana",this._options.fontStyle=o.fontStyle||"normal",this._options.fontColor=o.fontColor||"#000",this._order=100,this._pos=n,this._interleavedBuffer=this._gl.createBuffer(),this._interleavedData=new Float32Array(30),this._prepareText(e,r,i),this._interleavedData[0]=n[0],this._interleavedData[1]=n[1],this._interleavedData[2]=n[2],this._interleavedData[3]=-.5,this._interleavedData[4]=-.5,this._interleavedData[5]=n[0],this._interleavedData[6]=n[1],this._interleavedData[7]=n[2],this._interleavedData[8]=.5,this._interleavedData[9]=.5,this._interleavedData[10]=n[0],this._interleavedData[11]=n[1],this._interleavedData[12]=n[2],this._interleavedData[13]=.5,this._interleavedData[14]=-.5,this._interleavedData[15]=n[0],this._interleavedData[16]=n[1],this._interleavedData[17]=n[2],this._interleavedData[18]=-.5,this._interleavedData[19]=-.5,this._interleavedData[20]=n[0],this._interleavedData[21]=n[1],this._interleavedData[22]=n[2],this._interleavedData[23]=-.5,this._interleavedData[24]=.5,this._interleavedData[25]=n[0],this._interleavedData[26]=n[1],this._interleavedData[27]=n[2],this._interleavedData[28]=.5,this._interleavedData[29]=.5}function e(t){for(var e=1;e<t;)e*=2;return e}return n.derive(t,O,{updateProjectionIntervals:function(){},updateSquaredSphereRadius:function(t,e){return e},_setupTextParameters:function(t){t.fillStyle=this._options.fontColor,t.textAlign="left",t.textBaseline="bottom",t.font=this._options.fontStyle+" "+this._options.fontSize+"px "+this._options.font},_prepareText:function(t,r,n){this._setupTextParameters(r);var i=r.measureText(n).width;t.width=e(i),t.height=e(24),r.fillStyle=this._options.fillStyle,r.globalAlpha=this._options.backgroundAlpha,r.fillRect(0,0,t.width,t.height),this._setupTextParameters(r),r.globalAlpha=1,r.lineWidth=.5,r.lineStyle="none",r.fillText(n,0,t.height),r.strokeText(n,0,t.height),this._texture=this._gl.createTexture(),this._textureFromCanvas(this._texture,t),this._xScale=i/t.width,this._yScale=24/t.height,this._width=i,this._height=24},_textureFromCanvas:function(t,e){var r=this._gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0),r.bindTexture(r.TEXTURE_2D,t),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.generateMipmap(r.TEXTURE_2D),r.bindTexture(r.TEXTURE_2D,null)},bind:function(){var t=this._gl;t.bindBuffer(t.ARRAY_BUFFER,this._interleavedBuffer),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this._texture),this._ready||(t.bufferData(t.ARRAY_BUFFER,this._interleavedData,t.STATIC_DRAW),this._ready=!0)},draw:function(t,e,r,n){if(this._visible&&"normal"===n){var i=e.text;t.bind(i),this.bind();var a=this._gl,o=t.upsamplingFactor();a.uniform1f(a.getUniformLocation(i,"xScale"),this._xScale),a.uniform1f(a.getUniformLocation(i,"yScale"),this._yScale),a.uniform1f(a.getUniformLocation(i,"width"),2*o*this._width/t.viewportWidth()),a.uniform1f(a.getUniformLocation(i,"height"),2*o*this._height/t.viewportHeight()),a.uniform1i(a.getUniformLocation(i,"sampler"),0);var s=a.getAttribLocation(i,"attrCenter");a.enableVertexAttribArray(s),a.vertexAttribPointer(s,3,a.FLOAT,!1,20,0);var u=a.getAttribLocation(i,"attrCorner");a.vertexAttribPointer(u,2,a.FLOAT,!1,20,12),a.enableVertexAttribArray(u),a.enable(a.BLEND),a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA),a.drawArrays(a.TRIANGLES,0,6),a.disableVertexAttribArray(s),a.disableVertexAttribArray(u),a.disable(a.BLEND)}}}),t}(),y=function(r){var i,a,o,s,u,l=t.vec3,h=t.mat3,d=e.forceRGB;function f(){this._vertData=[],this._indexData=[],this._numVerts=0}function _(t,e,n,i,a){O.call(this,e),this._float32Allocator=n,this._uint16Allocator=i,this._data=new f,this._protoSphere=new r.ProtoSphere(8,8),this._protoCyl=new r.ProtoCylinder(8),this._va=null,this._idRanges=[],this._idPool=a,this._ready=!1,this._currentRange=null}return f.prototype={numVerts:function(){return this._numVerts},addVertex:function(t,e,r,n){this._numVerts+=1,this._vertData.push(t[0],t[1],t[2],e[0],e[1],e[2],r[0],r[1],r[2],r[3],n,0)},addTriangle:function(t,e,r){this._indexData.push(t,e,r)},numIndices:function(){return this._indexData.length},indexData:function(){return this._indexData},vertData:function(){return this._vertData}},n.derive(_,O,{updateProjectionIntervals:function(){},updateSquaredSphereRadius:function(t,e){return e},addTube:(i=l.create(),a=l.create(),o=l.create(),s=l.create(),u=h.create(),function(t,e,r,n){var h=d((n=n||{}).color||"white"),f=!0;void 0!==n.cap&&(f=n.cap),l.sub(s,e,t);var _=l.length(s);if(l.normalize(s,s),l.add(i,t,e),l.scale(i,i,.5),c.buildRotation(u,s,a,o,!1),f){var m=this._data.numVerts();this._data.addVertex(t,[-s[0],-s[1],-s[2]],h,0),function(t,e,r){for(var n=0;n<r-1;++n)t.addTriangle(e,e+1+n,e+2+n);t.addTriangle(e,e+r,e+1)}(this._data,m,8)}var v=void 0!==n.userData?n.userData:null;console.log(v);var p=this._nextObjectId({center:i,userData:v,geom:this});if(this._protoCyl.addTransformed(this._data,i,_,r,u,h,h,p,p),f){var g=this._data.numVerts();this._data.addVertex(e,s,h,0),function(t,e,r){for(var n=e+r,i=0;i<r-1;++i)t.addTriangle(n,e+i+1,e+i);t.addTriangle(n,e,e+r-1)}(this._data,g-8,8)}this._ready=!1}),_nextObjectId:function(t){return this._currentRange&&this._currentRange.hasLeft()||(this._currentRange=this._idPool.getContinuousRange(100),this._idRanges.push(this._currentRange)),this._currentRange.nextId(t)},destroy:function(){O.prototype.destroy.call(this);for(var t=0;t<this._idRanges.length;++t)this._idRanges[t].recycle()},addSphere:function(t,e,r){var n=d((r=r||{}).color||"white"),i=void 0!==r.userData?r.userData:null,a=this._nextObjectId({center:t,userData:i,geom:this});this._protoSphere.addTransformed(this._data,t,e,n,a),this._ready=!1},_prepareVertexArray:function(){this._ready=!0,null!==this._va&&this._va.destroy(),this._va=new B(this._gl,this._data.numVerts(),this._data.numIndices(),this._float32Allocator,this._uint16Allocator),this._va.setIndexData(this._data.indexData()),this._va.setVertData(this._data.vertData())},draw:function(t,e,r,n){if(this._visible){this._ready||this._prepareVertexArray();var i=this.shaderForStyleAndPass(e,r,n);if(i){t.bind(i),this._gl.uniform1i(i.symId,255);var a=this._va;a.bind(i),a.draw(),a.releaseAttribs(i)}}},shaderForStyleAndPass:function(t,e,r){if("normal"===r)return"hemilight"===e?t.hemilight:t.phong;if("select"===r)return t.select;if("outline"===r)return t.outline;var n=t[r];return void 0!==n?n:null}}),_}(d),S=function(){var e,r,i,a=t.vec3,o=t.quat,s=t.mat3;function u(t,e,r){this._from=t,this._to=e,this._duration=r,this._left=r,this._start=Date.now(),this._looping=!1,this._finished=!1}function l(t,e,r){u.call(this,a.clone(t),a.clone(e),r),this._current=a.clone(t)}function h(t,e,r){var n=s.create(),i=s.create();s.fromMat4(n,t),s.fromMat4(i,e);var a=o.create(),l=o.create();o.fromMat3(a,n),o.fromMat3(l,i),this._current=s.create(),u.call(this,a,l,r)}function d(t,e){u.call(this,null,null,e),this._axis=a.clone(t),this.setLooping(!0),this._previousAngle=0}function f(t,e){var r=2*Math.PI/e*1e3;u.call(this,null,null,r),this._axis=a.clone(t),this.setLooping(!0),this._speed=e,this._previousT=0}function _(){this._animations=[]}return u.prototype={setLooping:function(t){this._looping=t},step:function(t){var e,r=Date.now()-this._start;return 0===this._duration?e=1:this._looping?e=(r-Math.floor(r/this._duration)*this._duration)/this._duration:(e=(r=Math.min(this._duration,r))/this._duration,this._finished=1===e),this.apply(t,e),this._finished},apply:function(t,e){var r=(1-Math.cos(e*Math.PI))/2;this._current=this._from*(1-r)+this._to*r,t.setZoom(this._current)},finished:function(){return this._finished}},n.derive(l,u,{apply:function(t,e){var r=(1-Math.cos(e*Math.PI))/2;a.lerp(this._current,this._from,this._to,r),t.setCenter(this._current)}}),n.derive(h,u,{apply:(e=o.create(),function(t,r){o.slerp(e,this._from,this._to,r),s.fromQuat(this._current,e),t.setRotation(this._current)})}),n.derive(d,u,{apply:(r=s.create(),i=s.create(),function(t,e){s.fromMat4(i,t.rotation());var n=.2*Math.sin(2*e*Math.PI),a=n-this._previousAngle;this._previousAngle=n,c.axisRotation(r,this._axis,a),s.mul(i,r,i),t.setRotation(i)})}),n.derive(f,u,{apply:function(){var t=s.create(),e=s.create();return function(r,n){s.fromMat4(e,r.rotation());var i=2*Math.PI*(n-this._previousT);this._previousT=n,c.axisRotation(t,this._axis,i),s.mul(e,t,e),r.setRotation(e)}}(),setSpeed:function(t){this._speed=t},setAxis:function(t){this._axis=t}}),_.prototype={run:function(t){var e=Date.now();return this._animations=this._animations.filter((function(r){return!r.step(t,e)})),this._animations.length>0},add:function(t){this._animations.push(t)},remove:function(t){this._animations=this._animations.filter((function(e){return e!==t}))}},{AnimationControl:_,move:function(t,e,r){return new l(t,e,r)},rotate:function(t,e,r){return new h(t,e,r)},zoom:function(t,e,r){return new u(t,e,r)},rockAndRoll:function(){return new d([0,1,0],2e3)},spin:function(t,e){return new f(t,e)}}}(),R=function(){function t(t,e){this.near=t,this.far=e}function e(t){t=t||{},this._near=t.near||.1,this._far=t.far||400}function r(){this._far=100}return e.prototype.update=function(){return new t(this._near,this._far)},r.prototype.update=function(e,r){for(var n=r.center(),i=null,a=0;a<e.length;++a){var o=e[a];o.visible()&&(i=o.updateSquaredSphereRadius(n,i))}return null===i?null:new t(.1,1.05*((i=Math.sqrt(i))+r.zoom()))},{FixedSlab:e,AutoSlab:r,Slab:t}}(),C=function(r,i,a,o,s,u,l,h,c,d,f,_){var m=t.vec3,v=t.mat4,p=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)};function g(t,e){return"fixed"===(t=t||"auto")?new R.FixedSlab(e):"auto"===t?new R.AutoSlab(e):null}function b(t,e,r,n,i,a){this._pos=n,this._target=t,this._node=e,this._symIndex=r,this._legacyObject=i,this._legacyTransform=a}function A(t,e){this._options=this._initOptions(e,t),this._initialized=!1,this._objects=[],this._domElement=t,this._redrawRequested=!1,this._resize=!1,this._lastTimestamp=null,this._objectIdManager=new r,this._spin=null,this._rockAndRoll=null,this.listenerMap={},this._animControl=new _.AnimationControl,this._initKeyboardInput(),this._initCanvas(),this.quality(this._options.quality),null!==this._options.click&&this.on("click",this._options.click),null!==this._options.doubleClicked&&this.on("doubleClick",this._options.doubleClick),"complete"===document.readyState||"loaded"===document.readyState||"interactive"===document.readyState?this._initViewer():document.addEventListener("DOMContentLoaded",n.bind(this,this._initViewer))}function y(t,e,r){return e in t?t[e]:r}function S(t){return t.atomDoubleClick?(console.warn("use of atomDoubleClick is deprecated. ","use doubleClick instead"),t.atomDoubleClick):t.atomDoubleClicked?(console.warn("use of atomDoubleClicked is deprecated. ","use doubleClick instead"),t.atomDoubleClicked):t.doubleClick?t.doubleClick:"center"}function C(t){return t.atomClick?(console.warn("use of atomClick is deprecated. ","use click instead"),t.atomClick):t.atomClicked?(console.warn("use of atomClicked is deprecated. ","use click instead"),t.atomClicked):t.click?t.click:null}return b.prototype={symIndex:function(){return this._symIndex},target:function(){return this._target},pos:function(){return this._pos},node:function(){return this._node},transform:function(){return this._legacyTransform},object:function(){return this._legacyObject}},A.prototype={_initOptions:function(t,r){var n={width:(t=t||{}).width||500,height:t.height||500,animateTime:t.animateTime||0,antialias:t.antialias,quality:y(t,"quality","low"),style:y(t,"style","hemilight"),background:e.forceRGB(t.background||"white"),slabMode:g(t.slabMode),outline:y(t,"outline",!0),outlineColor:e.forceRGB(y(t,"outlineColor","black")),outlineWidth:y(t,"outlineWidth",1.5),selectionColor:e.forceRGB(y(t,"selectionColor","#3f3")),fov:y(t,"fov",45),doubleClick:S(t),click:C(t),fog:y(t,"fog",!0),transparency:y(t,"transparency","alpha")},i=r.getBoundingClientRect();return"auto"===n.width&&(n.width=i.width),"auto"===n.height&&(n.height=i.height),n},_ensureSize:function(){this._resize&&(this._resize=!1,this._cam.setViewportSize(this._canvas.viewportWidth(),this._canvas.viewportHeight()),this._pickBuffer.resize(this._options.width,this._options.height))},resize:function(t,e){t===this._options.width&&e===this._options.height||(this._canvas.resize(t,e),this._resize=!0,this._options.width=t,this._options.height=e,this.requestRedraw())},fitParent:function(){var t=this._domElement.getBoundingClientRect();this.resize(t.width,t.height)},gl:function(){return this._canvas.gl()},ok:function(){return this._initialized},options:function(t,r){if(void 0!==r)if(this._options[t]=r,"fog"===t)this._cam.fog(r),this.requestRedraw();else if("fov"===t)this._cam.setFieldOfViewY(r*Math.PI/180);else if("selectionColor"===t)this._cam.setSelectionColor(e.forceRGB(r));else if("outlineColor"===t)this._cam.setOutlineColorColor(e.forceRGB(r));else if("outlineWidth"===t)this._cam.setOutlineWidth(r+0);else if("transparency"===t){var n="screendoor"===r;this._cam.setScreenDoorTransparency(n)}return this._options[t]},quality:function(t){return this._options.quality=t,"high"===t?(this._options.arcDetail=4,this._options.sphereDetail=16,void(this._options.splineDetail=8)):"medium"===t?(this._options.arcDetail=2,this._options.sphereDetail=10,void(this._options.splineDetail=5)):"low"===t?(this._options.arcDetail=2,this._options.sphereDetail=8,void(this._options.splineDetail=3)):void console.error("invalid quality argument",t)},imageData:function(){return this._canvas.imageData()},_initPickBuffer:function(){var t={width:this._options.width,height:this._options.height};this._pickBuffer=new a(this._canvas.gl(),t)},_initViewer:function(){if(!this._canvas.initGL())return this._domElement.removeChild(this._canvas.domElement()),this._domElement.innerHTML='<div style="vertical-align:middle; text-align:center;"><h1>WebGL not supported</h1><p>Your browser does not support WebGL. You might want to try Chrome, Firefox, IE 11, or newer versions of Safari</p><p>If you are using a recent version of one of the above browsers, your graphic card might be blocked. Check the browser documentation for details on how to unblock it.</p></div>',this._domElement.style.width=this._options.width+"px",this._domElement.style.height=this._options.height+"px",!1;this._initPickBuffer(),this._2dcontext=this._textureCanvas.getContext("2d"),this._float32Allocator=new o(Float32Array),this._uint16Allocator=new o(Uint16Array),this._cam=new s(this._canvas.gl()),this._cam.setUpsamplingFactor(this._canvas.superSamplingFactor()),this._cam.setOutlineWidth(this._options.outlineWidth);var t="screendoor"===this._options.transparency;this._cam.setScreenDoorTransparency(t),this._cam.fog(this._options.fog),this._cam.setFogColor(this._options.background),this._cam.setOutlineColor(this._options.outlineColor),this._cam.setSelectionColor(this._options.selectionColor),this._cam.setFieldOfViewY(this._options.fov*Math.PI/180),this._mouseHandler.setCam(this._cam);var e=this._canvas,r=/(iPad|iPhone|iPod)/g.test(navigator.userAgent)?"highp":"mediump";return this._shaderCatalog={hemilight:e.initShader(u.HEMILIGHT_VS,u.PRELUDE_FS+u.HEMILIGHT_FS,r),phong:e.initShader(u.HEMILIGHT_VS,u.PRELUDE_FS+u.PHONG_FS,r),outline:e.initShader(u.OUTLINE_VS,u.PRELUDE_FS+u.OUTLINE_FS,r),lines:e.initShader(u.LINES_VS,u.PRELUDE_FS+u.LINES_FS,r),text:e.initShader(u.TEXT_VS,u.TEXT_FS,r),selectLines:e.initShader(u.SELECT_LINES_VS,u.SELECT_LINES_FS,r),select:e.initShader(u.SELECT_VS,u.SELECT_FS,r)},this._boundDraw=n.bind(this,this._draw),this._touchHandler=new l(this._canvas.domElement(),this,this._cam),this._initialized||(this._initialized=!0,this._dispatchEvent({name:"viewerReadyEvent"},"viewerReady",this)),!0},requestRedraw:function(){this._redrawRequested||(this._redrawRequested=!0,p(this._boundDraw))},boundingClientRect:function(){return this._canvas.domElement().getBoundingClientRect()},_drawWithPass:function(t){for(var e=0,r=this._objects.length;e!==r;++e)this._objects[e].draw(this._cam,this._shaderCatalog,this._options.style,t)},_initKeyboardInput:function(){var t=document.createElement("div");t.setAttribute("style","overflow:hidden;width:0;height:0"),this._keyInput=document.createElement("textarea"),this._domElement.appendChild(t),t.appendChild(this._keyInput),this._keyInput.focus()},focus:function(){this._keyInput.focus()},_initCanvas:function(){var t={antialias:this._options.antialias,height:this._options.height,width:this._options.width,backgroundColor:this._options.background};this._canvas=new i.Canvas(this._domElement,t),this._textureCanvas=document.createElement("canvas"),this._textureCanvas.style.display="none",this._domElement.appendChild(this._textureCanvas),this._mouseHandler=new h(this._canvas,this,this._cam,this._options.animateTime),this._canvas.domElement().addEventListener("mousedown",n.bind(this,this._gainFocus))},_gainFocus:function(){this._keyInput.focus()},setRotation:function(t,e){if(0==(e|=0))return this._cam.setRotation(t),void this.requestRedraw();var r;9===t.length?(r=v.create(),v.fromMat3(r,t)):r=v.clone(t),this._animControl.add(_.rotate(this._cam.rotation(),r,e)),this.requestRedraw()},setCamera:function(t,e,r,n){n|=0,this.setCenter(e,n),this.setRotation(t,n),this.setZoom(r,n)},_animateCam:function(){this._animControl.run(this._cam)&&this.requestRedraw()},_draw:function(){if(null!==this._canvas){this._redrawRequested=!1,this._animateCam(),this._canvas.bind(),this._ensureSize();var t=this._canvas.gl();t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT);var e=this._options.slabMode.update(this._objects,this._cam);null!==e&&this._cam.setNearFar(e.near,e.far),t.enable(t.CULL_FACE),this._options.outline&&(t.cullFace(t.BACK),t.enable(t.CULL_FACE),this._drawWithPass("outline")),t.cullFace(t.FRONT),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),this._drawWithPass("normal")}},setCenter:function(t,e){0!=(e|=0)?(this._animControl.add(_.move(this._cam.center(),m.clone(t),e)),this.requestRedraw()):this._cam.setCenter(t)},setZoom:function(t,e){0!=(e|=0)?(this._animControl.add(_.zoom(this._cam.zoom(),t,e)),this.requestRedraw()):this._cam.setZoom(t)},centerOn:function(t,e){this.setCenter(t.center(),e)},clear:function(){for(var t=0;t<this._objects.length;++t)this._objects[t].destroy();this._objects=[]},addListener:function(t,e){if("keypress"===t||"keydown"===t||"keyup"===t)console.log("keypress"),this._keyInput.addEventListener(t,e,!1);else{var r=this.listenerMap[t];if(void 0===r&&(r=[],this.listenerMap[t]=r),"center"===e){var i=n.bind(this._mouseHandler,this._mouseHandler._centerOnClicked);r.push(i)}else r.push(e);this._initialized&&"viewerReady"===t&&e(this,null)}},_dispatchEvent:function(t,e,r){var n=this.listenerMap[e];n&&n.forEach((function(e){e(r,t)}))},RENDER_MODES:["sline","lines","trace","lineTrace","cartoon","tube","spheres","ballsAndSticks","points"],renderAs:function(t,e,r,n){for(var i=!1,a=0;a<this.RENDER_MODES.length;++a)if(this.RENDER_MODES[a]===r){i=!0;break}if(i)return this[r](t,e,n);console.error("render mode",r,"not supported")},_handleStandardMolOptions:function(t,e){return(t=this._handleStandardOptions(t)).showRelated=t.showRelated||"asym",t.showRelated&&"asym"!==t.showRelated&&null===e.assembly(t.showRelated)&&(console.error("no assembly with name",t.showRelated,". Falling back to asymmetric unit"),t.showRelated="asym"),t},_handleStandardOptions:function(t){return(t=n.copy(t)).float32Allocator=this._float32Allocator,t.uint16Allocator=this._uint16Allocator,t.idPool=this._objectIdManager,t},lineTrace:function(t,r,n){var i=this._handleStandardMolOptions(n,r);i.color=i.color||e.uniform([1,0,1]),i.lineWidth=i.lineWidth||4;var a=c.lineTrace(r,this._canvas.gl(),i);return this.add(t,a)},spheres:function(t,r,n){var i=this._handleStandardMolOptions(n,r);i.color=i.color||e.byElement(),i.sphereDetail=this.options("sphereDetail"),i.radiusMultiplier=i.radiusMultiplier||1;var a=c.spheres(r,this._canvas.gl(),i);return this.add(t,a)},sline:function(t,r,n){var i=this._handleStandardMolOptions(n,r);i.color=i.color||e.uniform([1,0,1]),i.splineDetail=i.splineDetail||this.options("splineDetail"),i.strength=i.strength||1,i.lineWidth=i.lineWidth||4;var a=c.sline(r,this._canvas.gl(),i);return this.add(t,a)},cartoon:function(t,r,n){var i=this._handleStandardMolOptions(n,r);i.color=i.color||e.bySS(),i.strength=i.strength||1,i.splineDetail=i.splineDetail||this.options("splineDetail"),i.arcDetail=i.arcDetail||this.options("arcDetail"),i.radius=i.radius||.3,i.forceTube=i.forceTube||!1;var a=c.cartoon(r,this._canvas.gl(),i);return this.add(t,a)},surface:function(t,e,r){var n=this._handleStandardOptions(r),i=c.surface(e,this._canvas.gl(),n);return this.add(t,i)},tube:function(t,e,r){return(r=r||{}).forceTube=!0,this.cartoon(t,e,r)},ballsAndSticks:function(t,r,n){var i=this._handleStandardMolOptions(n,r);i.color=i.color||e.byElement(),i.radius=i.radius||.3,i.arcDetail=2*(i.arcDetail||this.options("arcDetail")),i.sphereDetail=i.sphereDetail||this.options("sphereDetail");var a=c.ballsAndSticks(r,this._canvas.gl(),i);return this.add(t,a)},lines:function(t,r,n){var i=this._handleStandardMolOptions(n,r);i.color=i.color||e.byElement(),i.lineWidth=i.lineWidth||4;var a=c.lines(r,this._canvas.gl(),i);return this.add(t,a)},points:function(t,r,n){var i=this._handleStandardMolOptions(n,r);i.color=i.color||e.byElement(),i.pointSize=i.pointSize||1;var a=c.points(r,this._canvas.gl(),i);return this.add(t,a)},trace:function(t,r,n){var i=this._handleStandardMolOptions(n,r);i.color=i.color||e.uniform([1,0,0]),i.radius=i.radius||.3,i.arcDetail=2*(i.arcDetail||this.options("arcDetail")),i.sphereDetail=i.sphereDetail||this.options("sphereDetail");var a=c.trace(r,this._canvas.gl(),i);return this.add(t,a)},_updateProjectionIntervals:function(t,e,r){r.eachAtom((function(r){for(var n=r.pos(),i=0;i<3;++i)e[i].update(m.dot(n,t[i]))}));for(var n=0;n<3;++n)e[n].extend(1.5)},fitTo:function(t){var e=this._cam.mainAxes(),r=[new n.Range,new n.Range,new n.Range];if(t instanceof O)t.updateProjectionIntervals(e[0],e[1],e[2],r[0],r[1],r[2]);else if(void 0!==t.eachAtom)this._updateProjectionIntervals(e,r,t);else if(void 0!==t.length)for(var i=0;i<t.length;++i)this._updateProjectionIntervals(e,r,t[i]);this._fitToIntervals(e,r)},_fitToIntervals:function(t,e){if(e[0].empty()||e[1].empty()||e[2].empty())console.error("could not determine interval. No objects shown?");else{var r=e[0].center(),n=e[1].center(),i=e[2].center(),a=[r*t[0][0]+n*t[1][0]+i*t[2][0],r*t[0][1]+n*t[1][1]+i*t[2][1],r*t[0][2]+n*t[1][2]+i*t[2][2]],o=this._cam.fieldOfViewY(),s=this._cam.aspectRatio(),u=e[0].length()/s,l=e[1].length(),h=.5*Math.max(u,l)/Math.tan(.5*o),c=h+.5*e[2].length(),d=Math.max(h-.5,.1),f=1+h+e[2].length();this._cam.setNearFar(d,f),this.setCamera(this._cam.rotation(),a,c,this._options.animateTime),this.requestRedraw()}},autoZoom:function(){var t=this._cam.mainAxes(),e=[new n.Range,new n.Range,new n.Range];this.forEach((function(r){r.visible()&&r.updateProjectionIntervals(t[0],t[1],t[2],e[0],e[1],e[2])})),this._fitToIntervals(t,e)},slabInterval:function(){},autoSlab:function(){var t=this._options._slabMode.update(this._objects,this._cam);null!==t&&this._cam.setNearFar(t.near,t.far),this.requestRedraw()},rockAndRoll:function(t){return void 0===t?null!==this._rockAndRoll:t?(null===this._rockAndRoll&&(this._rockAndRoll=_.rockAndRoll(),this._animControl.add(this._rockAndRoll),this.requestRedraw()),!0):(this._animControl.remove(this._rockAndRoll),this._rockAndRoll=null,this.requestRedraw(),!1)},spin:function(t,e){return void 0===t?null!==this._spin:!1===t?(this._animControl.remove(this._spin),this._spin=null,this.requestRedraw(),!1):(!0===t&&(t=Math.PI/8),e=e||[0,1,0],null===this._spin?(this._spin=_.spin(e,t),this._animControl.add(this._spin)):(this._spin.setSpeed(t),this._spin.setAxis(e)),this.requestRedraw(),!0)},slabMode:function(t,e){var r=g(t,e=e||{}),n=r.update(this._objects,this._cam);null!==n&&this._cam.setNearFar(n.near,n.far),this._options.slabMode=r,this.requestRedraw()},label:function(t,e,r,n){var i=new d(this._canvas.gl(),this._textureCanvas,this._2dcontext,r,e,n);return this.add(t,i),i},customMesh:function(t,e){var r=this._handleStandardOptions(e),n=new f(t,this._canvas.gl(),r.float32Allocator,r.uint16Allocator,r.idPool);return this.add(t,n),n},_drawPickingScene:function(){var t=this._canvas.gl();t.clearColor(0,0,0,0),t.disable(t.BLEND),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.clearColor(this._options.background[0],this._options.background[1],this._options.background[2],1),t.cullFace(t.FRONT),t.enable(t.CULL_FACE),this._drawWithPass("select")},pick:function(t){this._pickBuffer.bind(),this._drawPickingScene();var e=new Uint8Array(4),r=this._canvas.gl();r.readPixels(t.x,this._options.height-t.y,1,1,r.RGBA,r.UNSIGNED_BYTE,e),this._pickBuffer.release(),e.data&&(e=e.data);var n=e[0]|e[1]<<8|e[2]<<16,i=e[3],a=this._objectIdManager.objectForId(n);if(void 0===a)return null;var o=m.create(),s=null,u=null;return 255!==i?(s=a.atom,u=a.geom.symWithIndex(i),m.transformMat4(o,a.atom.pos(),u)):void 0!==a.atom?(s=a.atom,o=a.atom.pos()):(s=a.userData,o=a.center),new b(s,a.geom,i<255?i:null,o,a,u)},add:function(t,e){return e.name(t),this._objects.push(e),this._objects.sort((function(t,e){return t.order()-e.order()})),this.requestRedraw(),e},_globToRegex:function(t){var e=t.replace(".","\\.").replace("*",".*");return new RegExp("^"+e+"$")},forEach:function(){var t,e="*";2===arguments.length?(t=arguments[1],e=arguments[0]):t=arguments[0];for(var r=this._globToRegex(e),n=0;n<this._objects.length;++n){var i=this._objects[n];r.test(i.name())&&t(i,n)}},get:function(t){for(var e=0;e<this._objects.length;++e)if(this._objects[e].name()===t)return this._objects[e];return console.error("could not find object with name",t),null},hide:function(t){this.forEach(t,(function(t){t.hide()}))},show:function(t){this.forEach(t,(function(t){t.show()}))},rm:function(t){for(var e=[],r=this._globToRegex(t),n=0;n<this._objects.length;++n){var i=this._objects[n];r.test(i.name())?i.destroy():e.push(i)}this._objects=e},all:function(){return this._objects},isWebGLSupported:function(){return this._canvas.isWebGLSupported()},destroy:function(){this.clear(),this._canvas.destroy(),this._canvas=null}},A.prototype.on=A.prototype.addListener,{Viewer:function(t,e){return new A(t,e)},isWebGLSupported:i.isWebGLSupported}}(r,i,a,o,s,u,l,h,b,A,y,S),w=function(){function t(t,e){this._chains=t||[],this._matrices=e||[]}function e(t){this._name=t,this._generators=[]}return t.prototype={addChain:function(t){this._chains.push(t)},chains:function(){return this._chains},addMatrix:function(t){this._matrices.push(t)},matrices:function(){return this._matrices},matrix:function(t){return this._matrices[t]}},e.prototype={name:function(){return this._name},generators:function(){return this._generators},generator:function(t){return this._generators[t]},addGenerator:function(t){this._generators.push(t)}},{SymGenerator:t,Assembly:e}}(),E=function(){var e=t.vec3;function r(){}function i(t,e,n,i,a,o,s,u){r.call(this),this._residue=t,this._bonds=[],this._isHetatm=!!o,this._name=e,this._pos=n,this._index=a,this._element=i,this._occupancy=void 0!==s?s:null,this._tempFactor=void 0!==u?u:null}function a(t,e){r.call(this),this._resView=t,this._atom=e,this._bonds=[]}return r.prototype={bondCount:function(){return this.bonds().length},eachBond:function(t){for(var e=this.bonds(),r=0,n=e.length;r<n;++r)t(e[r])},isConnectedTo:function(t){if(null===t)return!1;for(var e=t.full(),r=this.full(),n=this.bonds(),i=0,a=n.length;i<a;++i){var o=n[i];if(o.atom_one()===r&&o.atom_two()===e||o.atom_one()===e&&o.atom_two()===r)return!0}return!1}},n.derive(i,r,{addBond:function(t){this._bonds.push(t)},name:function(){return this._name},bonds:function(){return this._bonds},residue:function(){return this._residue},structure:function(){return this._residue.structure()},full:function(){return this},qualifiedName:function(){return this.residue().qualifiedName()+"."+this.name()},pos:function(){return this._pos},setPos:function(t){e.copy(this._pos,t)},element:function(){return this._element},index:function(){return this._index},prop:function(t){return this[t]()},occupancy:function(){return this._occupancy},tempFactor:function(){return this._tempFactor},isHetatm:function(){return this._isHetatm}}),n.derive(a,r,{full:function(){return this._atom},name:function(){return this._atom.name()},pos:function(){return this._atom.pos()},element:function(){return this._atom.element()},residue:function(){return this._resView},bonds:function(){return this._atom.bonds()},index:function(){return this._atom.index()},occupancy:function(){return this._atom.occupancy()},tempFactor:function(){return this._atom.tempFactor()},qualifiedName:function(){return this._atom.qualifiedName()},isHetatm:function(){return this._atom.isHetatm()}}),{Atom:i,AtomView:a}}(),T=function(e){var r=t.vec3,i=e.Atom,a=e.AtomView;function o(){}function s(t,e,r,n){o.call(this),this._name=e,this._num=r,this._insCode=n,this._atoms=[],this._ss="C",this._chain=t,this._isAminoacid=!1,this._isNucleotide=!1,this._index=t.residues().length}function u(t,e){o.call(this),this._chainView=t,this._atoms=[],this._residue=e}return o.prototype={prop:function(t){return this[t]()},isWater:function(){return"HOH"===this.name()||"DOD"===this.name()},eachAtom:function(t,e){e|=0;for(var r=0;r<this._atoms.length;r+=1){if(!1===t(this._atoms[r],e))return!1;e+=1}return e},qualifiedName:function(){var t=this.chain().name()+"."+this.name()+this.num();return"\0"===this.insCode()?t:t+this.insCode()},atom:function(t){if("string"==typeof t){for(var e=0;e<this._atoms.length;++e)if(this._atoms[e].name()===t)return this._atoms[e];return null}return t>=this._atoms.length&&t<0?null:this._atoms[t]},centralAtom:function(){return this.isAminoacid()?this.atom("CA"):this.isNucleotide()?this.atom("C3'"):null},center:function(){var t=0,e=r.create();return this.eachAtom((function(n){r.add(e,e,n.pos()),t+=1})),t>0&&r.scale(e,e,1/t),e},isAminoacid:function(){return this._isAminoacid},isNucleotide:function(){return this._isNucleotide}},n.derive(s,o,{_deduceType:function(){this._isNucleotide=null!==this.atom("P")&&null!==this.atom("C3'"),this._isAminoacid=null!==this.atom("N")&&null!==this.atom("CA")&&null!==this.atom("C")&&null!==this.atom("O")},name:function(){return this._name},insCode:function(){return this._insCode},num:function(){return this._num},full:function(){return this},addAtom:function(t,e,r,n,a,o){var s=new i(this,t,e,r,this.structure().nextAtomIndex(),n,a,o);return this._atoms.push(s),s},ss:function(){return this._ss},setSS:function(t){this._ss=t},index:function(){return this._index},atoms:function(){return this._atoms},chain:function(){return this._chain},structure:function(){return this._chain.structure()}}),n.derive(u,o,{addAtom:function(t,e){if(e)for(var r=0;r<this._atoms.length;++r){var n=this._atoms[r];if(n.index()===t.index())return n}var i=new a(this,t.full());return this._atoms.push(i),i},removeAtom:function(t){var e=this._atoms.length;return this._atoms=this._atoms.filter((function(e){return e.index()!==t.index()})),e!==this._atoms.length},full:function(){return this._residue},num:function(){return this._residue.num()},insCode:function(){return this._residue.insCode()},ss:function(){return this._residue.ss()},index:function(){return this._residue.index()},chain:function(){return this._chainView},name:function(){return this._residue.name()},atoms:function(){return this._atoms},qualifiedName:function(){return this._residue.qualifiedName()},containsResidue:function(t){return this._residue.full()===t.full()},isAminoacid:function(){return this._residue.isAminoacid()},isNucleotide:function(){return this._residue.isNucleotide()},isWater:function(){return this._residue.isWater()}}),{ResidueView:u,Residue:s}}(E),x=function(){var e,r,n,i,a=t.vec3;function o(){this._trace=[]}function s(t,e,r){this._fullTrace=t,this._fullTraceBegin=e,this._fullTraceEnd=r,this._isNTerminal=0===this._fullTraceBegin,this._isCTerminal=this._fullTrace.length()===this._fullTraceEnd;var n=this._fullTraceEnd-this._fullTraceBegin;this._isCTerminal||++n,this._isNTerminal||(++n,this._fullTraceBegin-=1),this._length=n}return o.prototype={push:function(t){this._trace.push(t)},length:function(){return this._trace.length},residueAt:function(t){return this._trace[t]},posAt:function(t,e){return a.copy(t,this._trace[e].centralAtom().pos()),t},normalAt:function(t,e){var r=this._trace[e];return r.isAminoacid()&&a.sub(t,r.atom("O").pos(),r.atom("C").pos()),a.normalize(t,t),t},centralAtomAt:function(t){return this._trace[t].centralAtom()},tangentAt:(e=a.create(),r=a.create(),function(t,n){n>0?this.posAt(e,n-1):this.posAt(e,n),n<this._trace.length-1?this.posAt(r,n+1):this.posAt(r,n),a.sub(t,r,e)}),fullTraceIndex:function(t){return t},subsets:function(t){for(var e=0,r=0,n=[];r<t.length&&e<this._trace.length;){for(var i=t[r].full().index();this._trace.length>e&&this._trace[e].index()<i;)++e;if(e>=this._trace.length)break;for(var a=this._trace[e].index();t.length>r&&t[r].full().index()<a;)++r;if(r>=t.length)break;for(var o=e;t.length>r&&this._trace.length>e&&t[r].full().index()===this._trace[e].index();)++r,++e;var u=e;n.push(new s(this,o,u))}return n}},o.prototype.smoothPosAt=o.prototype.posAt,o.prototype.smoothNormalAt=o.prototype.normalAt,s.prototype={length:function(){return this._length},residueAt:function(t){return this._fullTrace.residueAt(this._fullTraceBegin+t)},_interpolate:(n=a.create(),i=a.create(),function(t,e,r,o){return this.tangentAt(n,e),this.tangentAt(i,r),a.scale(n,n,o),a.scale(i,i,o),c.cubicHermiteInterpolate(t,this.centralAtomAt(e).pos(),n,this.centralAtomAt(r).pos(),i,.5,0),t}),smoothPosAt:function(t,e,r){if(0===e&&!this._isNTerminal)return this._interpolate(t,e,e+1,r);if(e===this._length-1&&!this._isCTerminal)return this._interpolate(t,e-1,e,r);var n=this.centralAtomAt(e);return a.copy(t,n.pos()),t},smoothNormalAt:function(t,e){return this._fullTrace.normalAt(t,e+this._fullTraceBegin),t},posAt:function(t,e){var r=this.centralAtomAt(e),n=null;return a.copy(t,r.pos()),0!==e||this._isNTerminal||(n=this.centralAtomAt(e+1),a.add(t,t,n.pos()),a.scale(t,t,.5)),e!==this._length-1||this._isCTerminal||(n=this.centralAtomAt(e-1),a.add(t,t,n.pos()),a.scale(t,t,.5)),t},centralAtomAt:function(t){return this.residueAt(t).centralAtom()},fullTraceIndex:function(t){return this._fullTraceBegin+t},tangentAt:function(t,e){return this._fullTrace.tangentAt(t,e+this._fullTraceBegin)}},{TraceSubset:s,BackboneTrace:o}}(),M=function(e,r){var i=t.vec3,a=e.Residue,o=e.ResidueView;function s(t,e){return t<<8|e.charCodeAt(0)}function u(t,e){return t.num()<e.num()}function l(t){return{num:function(){return t}}}function h(){}function c(t,e){h.call(this),this._structure=t,this._name=e,this._cachedTraces=[],this._residues=[],this._rnumsOrdered=!0}function d(t,e,r){var n,a;if(t?(n=e.atom("C"),a=r.atom("N")):(n=e.atom("O3'"),a=r.atom("P")),n.isConnectedTo(a))return!1;var o=i.sqrDist(n.pos(),a.pos());return Math.abs(o-2.25)>1}function f(t,e){e.length()<2||t.push(e)}function _(t,e,r){if(0===t.length)return!0;if(!e)return!1;var n=s(r.num(),r.insCode()),i=t[t.length-1];return s(i.num(),i.insCode())<n}function m(t,e){h.call(this),this._chain=e,this._residues=[],this._molView=t,this._residueMap={},this._rnumsOrdered=!0}return h.prototype={eachAtom:function(t,e){e|=0;for(var r=0;r<this._residues.length;r+=1)if(!1===(e=this._residues[r].eachAtom(t,e)))return!1;return e},atomCount:function(){for(var t=0,e=this.residues(),r=0;r<e.length;++r)t+=e[r].atoms().length;return t},eachResidue:function(t){for(var e=0;e<this._residues.length;e+=1)if(!1===t(this._residues[e]))return!1},residues:function(){return this._residues},structure:function(){return this._structure},asView:function(){var t=this.structure().createEmptyView();return t.addChain(this,!0),t},residueByRnum:function(t){var e=this.residues();if(this._rnumsOrdered){var r=n.binarySearch(e,l(t),u);return-1===r?null:e[r]}for(var i=0;i<e.length;++i)if(e[i].num()===t)return e[i];return null},residuesInRnumRange:function(t,e){var r,i,a=[],o=this.residues();if(!0===this._rnumsOrdered){var s=n.indexFirstLargerEqualThan(o,l(t),u);if(-1===s)return a;var h=n.indexLastSmallerEqualThan(o,l(e),u);if(-1===h)return a;for(r=s;r<=h;++r)a.push(this._residues[r])}else for(r=0,i=o.length;r!==i;++r){var c=o[r];c.num()>=t&&c.num()<=e&&a.push(c)}return a},prop:function(t){return this[t]()}},n.derive(c,h,{name:function(){return this._name},full:function(){return this},addResidue:function(t,e,r){var n=new a(this,t,e,r=r||"\0");return this._rnumsOrdered=_(this._residues,this._rnumsOrdered,n),this._residues.push(n),n},assignSS:function(t,e,r){for(var n=s(t[0],t[1]),i=s(e[0],e[1]),a=1;a<this._residues.length-1;++a){var o=this._residues[a],u=s(o.num(),o.insCode());u<=n||u>=i||o.setSS(r)}},eachBackboneTrace:function(t){this._cacheBackboneTraces();for(var e=0;e<this._cachedTraces.length;++e)t(this._cachedTraces[e])},_cacheBackboneTraces:function(){if(!(this._cachedTraces.length>0)){for(var t=new r.BackboneTrace,e=null,n=0;n<this._residues.length;n+=1){var i=this._residues[n],a=i.isAminoacid(),o=i.isNucleotide();!0===e&&!a||!1===e&&!o||null===e&&!o&&!a?(f(this._cachedTraces,t),e=null,t=new r.BackboneTrace):0!==t.length()?(d(e,this._residues[n-1],i)&&(f(this._cachedTraces,t),t=new r.BackboneTrace),t.push(i)):(t.push(i),e=i.isAminoacid())}f(this._cachedTraces,t)}},backboneTraces:function(){var t=[];return this.eachBackboneTrace((function(e){t.push(e)})),t}}),n.derive(m,h,{addResidue:function(t,e){var r=new o(this,t.full());if(this._rnumsOrdered=_(this._residues,this._rnumsOrdered,t),this._residues.push(r),this._residueMap[t.full().index()]=r,e)for(var n=t.atoms(),i=0;i<n.length;++i)r.addAtom(n[i].full(),!1);return r},addAtom:function(t){var e=this._residueMap[t.residue().full().index()];return void 0===e&&(e=this.addResidue(t.residue())),e.addAtom(t,!0)},removeAtom:function(t,e){var r=this._residueMap[t.residue().full().index()];if(void 0===r)return!1;var n=r.removeAtom(t);return n&&0===r.atoms().length&&e&&(delete this._residueMap[t.residue().full().index()],this._residues=this._residues.filter((function(t){return t!==r}))),n},containsResidue:function(t){var e=this._residueMap[t.full().index()];return void 0!==e&&e.full()===t.full()},eachBackboneTrace:function(t){for(var e=this._chain.backboneTraces(),r=0;r<e.length;++r)for(var n=e[r].subsets(this._residues),i=0;i<n.length;++i)t(n[i])},backboneTraces:function(){var t=[];return this.eachBackboneTrace((function(e){t.push(e)})),t},full:function(){return this._chain},name:function(){return this._chain.name()},structure:function(){return this._molView}}),{Chain:c,ChainView:m}}(T,x),q=t.vec3,F={Bond:function(t,e){var r={atom_one:t,atom_two:e};return{atom_one:function(){return r.atom_one},atom_two:function(){return r.atom_two},mid_point:function(t){return t||(t=q.create()),q.add(t,r.atom_one.pos(),r.atom_two.pos()),q.scale(t,t,.5),t}}}},D=function(){function t(t,e){for(var r=0;r<e.length;++r)if(!e[r](t))return!1;return!0}function e(t,e){var r=t.residues();e.rnumRange&&(r=t.residuesInRnumRange(e.rnumRange[0],e.rnumRange[1]));var n,i,a=[];if(void 0!==e.rindexRange){for(n=e.rindexRange[0],i=Math.min(r.length-1,e.rindexRange[1]);n<=i;++n)a.push(r[n]);return a}if(e.rindices&&void 0!==e.rindices.length){for(a=[],n=0;n<e.rindices.length;++n)a.push(r[e.rindices[n]]);return a}return r}return{dict:function(r,n,i){var a=function(t){var e=[];if(void 0!==t.rname&&e.push((function(e){return e.name()===t.rname})),void 0!==t.rnames&&e.push((function(e){for(var r=e.name(),n=0;n<t.rnames.length;++n)if(r===t.rnames[n])return!0;return!1})),void 0!==t.rnums){for(var r={},n=0;n<t.rnums.length;++n)r[t.rnums[n]]=!0;e.push((function(t){var e=t.num();return!0===r[e]}))}return void 0!==t.rnum&&e.push((function(e){return e.num()===t.rnum})),e}(i),o=function(t){var e=[];return void 0!==t.aname&&e.push((function(e){return e.name()===t.aname})),void 0!==t.hetatm&&e.push((function(e){return e.isHetatm()===t.hetatm})),void 0!==t.anames&&e.push((function(e){for(var r=e.name(),n=0;n<t.anames.length;++n)if(r===t.anames[n])return!0;return!1})),e}(i),s=function(t){var e=[];return void 0!==t.cname&&(t.chain=t.cname),void 0!==t.cnames&&(t.chains=t.cnames),void 0!==t.chain&&e.push((function(e){return e.name()===t.chain})),void 0!==t.chains&&e.push((function(e){for(var r=e.name(),n=0;n<t.chains.length;++n)if(r===t.chains[n])return!0;return!1})),e}(i);i.rindex&&(i.rindices=[i.rindex]);for(var u=0;u<r._chains.length;++u){var l=r._chains[u];if(t(l,s))for(var h=e(l,i),c=null,d=0;d<h.length;++d)if(t(h[d],a)){c||(c=n.addChain(l,!1));for(var f=null,_=h[d].atoms(),m=0;m<_.length;++m)t(_[m],o)&&(f||(f=c.addResidue(h[d],!1)),f.addAtom(_[m]))}}return n}}}(),z=function(e,r,i){var a,o=t.vec3,s=e.Chain,u=e.ChainView,l=r.Bond,h={H:.31,HE:.28,LI:1.28,BE:.96,B:.84,C:.76,N:.71,O:.66,F:.57,NE:.58,NA:1.66,MG:1.41,AL:1.21,SI:1.11,P:1.07,S:1.05,CL:1.02,AR:1.06,K:2.03,CA:1.76,SC:1.7,TI:1.6,V:1.53,CR:1.39,MN:1.39,FE:1.32,CO:1.26,NI:1.24,CU:1.32,ZN:1.22,GA:1.22,GE:1.2,AS:1.19,SE:1.2,BR:1.2,KR:1.16,RB:2.2,SR:1.95,Y:1.9,ZR:1.75,NB:1.64,MO:1.54,TC:1.47,RU:1.46,RH:1.42,PD:1.39,AG:1.45,CD:1.44,IN:1.42,SN:1.39,SB:1.39,TE:1.38,I:1.39,XE:1.4,CS:2.44,BA:2.15,LA:2.07,CE:2.04,PR:2.03,ND:2.01,PM:1.99,SM:1.98,EU:1.98,GD:1.96,TB:1.94,DY:1.92,HO:1.92,ER:1.89,TM:1.9,YB:1.87,LU:1.87,HF:1.75,TA:1.7,W:1.62,RE:1.51,OS:1.44,IR:1.41,PT:1.36,AU:1.36,HG:1.32,TL:1.45,PB:1.46,BI:1.48,PO:1.4,AT:1.5,RN:1.5,FR:2.6,RA:2.21,AC:2.15,TH:2.06,PA:2,U:1.96,NP:1.9,PU:1.87,AM:1.8,CM:1.69};function d(t){var e=h[t.toUpperCase()];return void 0!==e?e:1.5}function f(){}function _(){f.call(this),this._chains=[],this._assemblies=[],this._nextAtomIndex=0}function m(t){f.call(this),this._mol=t,this._chains=[]}return f.prototype={eachResidue:function(t){for(var e=0;e<this._chains.length;e+=1)if(!1===this._chains[e].eachResidue(t))return!1},eachAtom:function(t,e){e|=0;for(var r=0;r<this._chains.length;r+=1)if(!1===(e=this._chains[r].eachAtom(t,e)))return!1},residueCount:function(){for(var t=this.chains(),e=0,r=0;r<t.length;++r)e+=t[r].residues().length;return e},eachChain:function(t){for(var e=this.chains(),r=0;r<e.length;++r)if(!1===t(e[r]))return},atomCount:function(){for(var t=this.chains(),e=0,r=0;r<t.length;++r)e+=t[r].atomCount();return e},atoms:function(){var t=[];return this.eachAtom((function(e){t.push(e)})),t},atom:function(t){var e=t.split("."),r=this.chain(e[0]);if(null===r)return null;var n=r.residueByRnum(parseInt(e[1],10));return null===n?null:n.atom(e[2])},center:function(){var t=o.create(),e=0;return this.eachAtom((function(r){o.add(t,t,r.pos()),e+=1})),e&&o.scale(t,t,1/e),t},boundingSphere:function(){var t=this.center(),e=0;return this.eachAtom((function(r){e=Math.max(e,o.sqrDist(t,r.pos()))})),new c.Sphere(t,Math.sqrt(e))},backboneTraces:function(){for(var t=this.chains(),e=[],r=0;r<t.length;++r)Array.prototype.push.apply(e,t[r].backboneTraces());return e},select:function(t){return"protein"===t?this.residueSelect((function(t){return t.isAminoacid()})):"water"===t?this.residueSelect((function(t){return t.isWater()})):"ligand"===t?this.residueSelect((function(t){return!t.isAminoacid()&&!t.isWater()})):i.dict(this,new m(this),t||{})},residueSelect:function(t){console.time("Mol.residueSelect");for(var e=new m(this.full()),r=0;r<this._chains.length;++r)for(var n=this._chains[r],i=null,a=n.residues(),o=0;o<a.length;++o)t(a[o])&&(i||(i=e.addChain(n,!1)),i.addResidue(a[o],!0));return console.timeEnd("Mol.residueSelect"),e},atomSelect:function(t){console.time("Mol.atomSelect");for(var e=new m(this.full()),r=0;r<this._chains.length;++r)for(var n=this._chains[r],i=null,a=n.residues(),o=0;o<a.length;++o)for(var s=null,u=a[o],l=u.atoms(),h=0;h<l.length;++h)t(l[h])&&(i||(i=e.addChain(n,!1)),s||(s=i.addResidue(u,!1)),s.addAtom(l[h]));return console.timeEnd("Mol.atomSelect"),e},assembly:function(t){for(var e=this.assemblies(),r=0;r<e.length;++r)if(e[r].name()===t)return e[r];return null},chainsByName:function(t){for(var e={},r=this.chains(),n=0;n<r.length;++n)e[r[n].name()]=r[n];for(var i=[],a=0;a<t.length;++a){var o=e[t[a]];void 0!==o&&i.push(o)}return i},selectWithin:(a=o.create(),function(t,e){console.time("Mol.selectWithin");var r=(e=e||{}).radius||4,n=r*r,i=!!e.matchResidues,s=[];t.eachAtom((function(t){s.push(t)}));for(var u=new m(this.full()),l=null,h=null,c=this.chains(),d=!1,f=0;f<c.length;++f){var _=c[f].residues();h=null;for(var v=0;v<_.length;++v){l=null,d=!1;for(var p=_[v].atoms(),g=0;g<p.length&&!d;++g)for(var b=0;b<s.length;++b)if(o.sub(a,p[g].pos(),s[b].pos()),!(o.sqrLen(a)>n)){if(h||(h=u.addChain(c[f].full(),!1)),l||(l=h.addResidue(_[v].full(),i)),i){d=!0;break}l.addAtom(p[g].full());break}}}return console.timeEnd("Mol.selectWithin"),u}),createEmptyView:function(){return new m(this.full())}},n.derive(_,f,{addAssembly:function(t){this._assemblies.push(t)},setAssemblies:function(t){this._assemblies=t},assemblies:function(){return this._assemblies},chains:function(){return this._chains},full:function(){return this},containsResidue:function(t){return t.full().structure()===this},chainByName:function(t){for(var e=0;e<this._chains.length;++e)if(this._chains[e].name()===t)return this._chains[e];return null},chain:function(t){return this.chainByName(t)},nextAtomIndex:function(){var t=this._nextAtomIndex;return this._nextAtomIndex+=1,t},addChain:function(t){var e=new s(this,t);return this._chains.push(e),e},connect:function(t,e){var r=new l(t,e);return t.addBond(r),e.addBond(r),r},deriveConnectivity:function(){console.time("Mol.deriveConnectivity");var t=this,e=null;this.eachResidue((function(r){for(var n,i,a,s,u,l=r.atoms(),h=l.length,c=0;c<h;c+=1)for(var f=l[c],_=f.pos(),m=d(f.element()),v=0;v<c;v+=1){var p=l[v],g=d(p.element()),b=m+g-.3,A=m+g+.3;(n=o.sqrDist(_,p.pos()))<A*A&&n>b*b&&t.connect(f,p)}r._deduceType(),null!==e&&(r.isAminoacid()&&e.isAminoacid()&&(i=t,a=r,s=e.atom("C"),u=a.atom("N"),s&&u&&o.sqrDist(s.pos(),u.pos())<1.6*1.6&&i.connect(u,s)),r.isNucleotide()&&e.isNucleotide()&&function(t,e,r){var n=e.atom("O3'"),i=r.atom("P");n&&i&&o.sqrDist(n.pos(),i.pos())<1.7*1.7&&t.connect(n,i)}(t,e,r)),e=r})),console.timeEnd("Mol.deriveConnectivity")}}),n.derive(m,f,{full:function(){return this._mol},assemblies:function(){return this._mol.assemblies()},addChain:function(t,e){var r=new u(this,t.full());if(this._chains.push(r),e)for(var n=t.residues(),i=0;i<n.length;++i)r.addResidue(n[i],!0);return r},addAtom:function(t){var e=this.chain(t.residue().chain().name());return null===e&&(e=this.addChain(t.residue().chain())),e.addAtom(t)},removeAtom:function(t,e){if(null===t)return!1;var r=this.chain(t.residue().chain().name());if(null===r)return!1;var n=r.removeAtom(t,e);return n&&0===r.residues().length&&(this._chains=this._chains.filter((function(t){return t!==r}))),n},containsResidue:function(t){if(!t)return!1;var e=this.chain(t.chain().name());return!!e&&e.containsResidue(t)},addResidues:function(t,e){var r=this,n={};return t.forEach((function(t){var i=t.chain().name();void 0===n[i]&&(n[i]=r.addChain(t.chain(),!1)),n[i].addResidue(t,e)})),n},chains:function(){return this._chains},chain:function(t){for(var e=0;e<this._chains.length;++e)if(this._chains[e].name()===t)return this._chains[e];return null}}),{MolView:m,Mol:_}}(M,F,D),V=function(t){var e,r=Math.pow(2,-52),n=1e-64/r,i=0,a=0,o=0,s=0,u=0,l=t,h=l.length,c=l[0].length;if(h<c)throw"Need more rows than columns";var d=new Array(c),f=new Array(c);for(a=0;a<c;a++)d[a]=f[a]=0;var _=[];for(a=0;a<c;++a){var m=[];for(_.push([]),o=0;o<c;++o)m.push(0);_.push(m)}function v(t,e){return(t=Math.abs(t))>(e=Math.abs(e))?t*Math.sqrt(1+e*e/t/t):0==e?t:e*Math.sqrt(1+t*t/e/e)}var p=0,g=0,b=0,A=0,y=0,S=0,R=0;for(a=0;a<c;a++){for(d[a]=g,R=0,u=a+1,o=a;o<h;o++)R+=l[o][a]*l[o][a];if(R<=n)g=0;else for(p=l[a][a],g=Math.sqrt(R),p>=0&&(g=-g),b=p*g-R,l[a][a]=p-g,o=u;o<c;o++){for(R=0,s=a;s<h;s++)R+=l[s][a]*l[s][o];for(p=R/b,s=a;s<h;s++)l[s][o]+=p*l[s][a]}for(f[a]=g,R=0,o=u;o<c;o++)R+=l[a][o]*l[a][o];if(R<=n)g=0;else{for(p=l[a][a+1],g=Math.sqrt(R),p>=0&&(g=-g),b=p*g-R,l[a][a+1]=p-g,o=u;o<c;o++)d[o]=l[a][o]/b;for(o=u;o<h;o++){for(R=0,s=u;s<c;s++)R+=l[o][s]*l[a][s];for(s=u;s<c;s++)l[o][s]+=R*d[s]}}(y=Math.abs(f[a])+Math.abs(d[a]))>A&&(A=y)}for(a=c-1;-1!=a;a+=-1){if(0!=g){for(b=g*l[a][a+1],o=u;o<c;o++)_[o][a]=l[a][o]/b;for(o=u;o<c;o++){for(R=0,s=u;s<c;s++)R+=l[a][s]*_[s][o];for(s=u;s<c;s++)_[s][o]+=R*_[s][a]}}for(o=u;o<c;o++)_[a][o]=0,_[o][a]=0;_[a][a]=1,g=d[a],u=a}for(a=c-1;-1!=a;a+=-1){for(u=a+1,g=f[a],o=u;o<c;o++)l[a][o]=0;if(0!=g){for(b=l[a][a]*g,o=u;o<c;o++){for(R=0,s=u;s<h;s++)R+=l[s][a]*l[s][o];for(p=R/b,s=a;s<h;s++)l[s][o]+=p*l[s][a]}for(o=a;o<h;o++)l[o][a]=l[o][a]/g}else for(o=a;o<h;o++)l[o][a]=0;l[a][a]+=1}for(r*=A,s=c-1;-1!=s;s+=-1)for(var C=0;C<50;C++){var w=!1;for(u=s;-1!=u;u+=-1){if(Math.abs(d[u])<=r){w=!0;break}if(Math.abs(f[u-1])<=r)break}if(!w){i=0,R=1;var E=u-1;for(a=u;a<s+1&&(p=R*d[a],d[a]=i*d[a],!(Math.abs(p)<=r));a++)for(b=v(p,g=f[a]),f[a]=b,i=g/b,R=-p/b,o=0;o<h;o++)y=l[o][E],S=l[o][a],l[o][E]=y*i+S*R,l[o][a]=-y*R+S*i}if(S=f[s],u==s){if(S<0)for(f[s]=-S,o=0;o<c;o++)_[o][s]=-_[o][s];break}if(C>=49)throw"Error: no convergence.";for(A=f[u],g=v(p=(((y=f[s-1])-S)*(y+S)+((g=d[s-1])-(b=d[s]))*(g+b))/(2*b*y),1),p=p<0?((A-S)*(A+S)+b*(y/(p-g)-b))/A:((A-S)*(A+S)+b*(y/(p+g)-b))/A,i=1,R=1,a=u+1;a<s+1;a++){for(g=d[a],y=f[a],b=R*g,g*=i,S=v(p,b),d[a-1]=S,p=A*(i=p/S)+g*(R=b/S),g=-A*R+g*i,b=y*R,y*=i,o=0;o<c;o++)A=_[o][a-1],S=_[o][a],_[o][a-1]=A*i+S*R,_[o][a]=-A*R+S*i;for(S=v(p,b),f[a-1]=S,p=(i=p/S)*g+(R=b/S)*y,A=-R*g+i*y,o=0;o<h;o++)y=l[o][a-1],S=l[o][a],l[o][a-1]=y*i+S*R,l[o][a]=-y*R+S*i}d[u]=0,d[s]=p,f[s]=A}for(a=0;a<f.length;a++)f[a]<r&&(f[a]=0);for(a=0;a<c;a++)for(o=a-1;o>=0;o--)if(f[o]<f[a]){for(i=f[o],f[o]=f[a],f[a]=i,s=0;s<l.length;s++)e=l[s][a],l[s][a]=l[s][o],l[s][o]=e;for(s=0;s<_.length;s++)e=_[s][a],_[s][a]=_[s][o],_[s][o]=e;a=o}return{U:l,S:f,V:_}},I=function(){var e,r,n,i,a,o,s,u,l,h,c=t.vec3,d=t.mat3,f=(t.quat,function(t,e){if(c.set(e,0,0,0),0!==t.length){for(var r=0;r<t.length;++r){var n=t[r];c.add(e,e,n.pos())}c.scale(e,e,1/t.length)}}),_=(e=c.create(),r=c.create(),function(t,n,i,a,o){o[0]=0,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=0,o[6]=0,o[7]=0,o[8]=0;for(var s=0;s<n.length;++s){c.sub(e,t[s].pos(),i),c.sub(r,n[s].pos(),a);var u=e,l=r;o[0]+=u[0]*l[0],o[1]+=u[0]*l[1],o[2]+=u[0]*l[2],o[3]+=u[1]*l[0],o[4]+=u[1]*l[1],o[5]+=u[1]*l[2],o[6]+=u[2]*l[0],o[7]+=u[2]*l[1],o[8]+=u[2]*l[2]}});function m(t){if(null==t||"all"===t)return null;if("backbone"===t)return{CA:!0,C:!0,O:!0,N:!0};if(void 0!==t.substr){for(var e={},r=t.split(","),n=0;n<r.length;++n)e[r[n].trim()]=!0;return e}for(e={},n=0;n<t.length;++n)e[t[n]]=!0;return e}function v(t,e,r,n,i){for(var a=t.atoms(),o=e.atoms(),s=0;s<a.length;++s){var u=a[s];if(null===i||!0===i[u.name()])for(var l=0;l<o.length;++l){var h=o[l];if(h.name()===u.name()){r.push(u),n.push(h);break}}}}function p(t,e,r,n){for(var i=t.full().createEmptyView(),a=e.full().createEmptyView(),o=Math.min(t.chains().length,e.chains().length),s=m(r),u=0;u<o;++u){var l=t.chains()[u],h=e.chains()[u],c=n(l,h),d=c[0],f=c[1];if(d.length!==f.length)return console.error("chains",l.name()," and",h.name()," do not contain the same number of residues."),null;for(var _=i.addChain(l),p=a.addChain(h),g=0;g<d.length;++g){var b=d[g],A=f[g],y=[],S=[];if(v(b,A,y,S,s),0!==y.length)for(var R=_.addResidue(b),C=p.addResidue(A),w=0;w<y.length;++w)R.addAtom(y[w]),C.addAtom(S[w])}}return[i,a]}return{superpose:(n=c.create(),i=c.create(),a=c.create(),o=d.create(),s=d.create(),u=d.create(),l=d.create(),h=d.create(),function(t,e){var r=t.atoms(),m=e.atoms();if(f(m,n),f(r,i),r.length!==m.length)return console.error("atom counts do not match ("+r.length+"in structure vs "+m.length+" in reference)"),!1;if(r.length<3)return console.error("at least 3 atoms are required for superposition"),!1;_(r,m,i,n,s);var v=[[s[0],s[1],s[2]],[s[3],s[4],s[5]],[s[6],s[7],s[8]]],p=V(v);l[0]=p.U[0][0],l[1]=p.U[0][1],l[2]=p.U[0][2],l[3]=p.U[1][0],l[4]=p.U[1][1],l[5]=p.U[1][2],l[6]=p.U[2][0],l[7]=p.U[2][1],l[8]=p.U[2][2];var g=d.determinant(l);h[0]=p.V[0][0],h[1]=p.V[0][1],h[2]=p.V[0][2],h[3]=p.V[1][0],h[4]=p.V[1][1],h[5]=p.V[1][2],h[6]=p.V[2][0],h[7]=p.V[2][1],h[8]=p.V[2][2];var b=d.determinant(h);d.identity(u),g*b<0&&(console.log("determinants smaller than zero!"),u[8]=-1,d.mul(l,l,u)),console.log(d.str(l)),d.mul(o,d.transpose(h,h),l);for(var A=t.full().atoms(),y=0;y<A.length;++y){var S=A[y];c.sub(a,S.pos(),i),c.transformMat3(a,a,o),c.add(a,n,a),S.setPos(a)}return!0}),matchResiduesByNum:function(t,e,r){return p(t,e,r,(function(t,e){for(var r=[],n=[],i=t.residues(),a=0;a<i.length;++a){var o=e.residueByRnum(i[a].num());null!==o&&(r.push(i[a]),n.push(o))}return[r,n]}))},matchResiduesByIndex:function(t,e,r){return p(t,e,r,(function(t,e){return[t.residues(),e.residues()]}))},parseAtomNames:m,addAtomsPresentInBoth:v}}(),z=function(e){var r,n,i=t.vec3,a=(r=i.create(),n=i.create(),function(t,e,a,o){for(var s=Math.max(0,e-2);s<=e;++s)for(var u=2;u<5;++u)if(!(s+u>=t.length())){var l=i.dist(t.posAt(r,s),t.posAt(n,s+u));if(Math.abs(l-a[u-2])>o)return!1}return!0}),o=function(t,e){return a(t,e,[5.45,5.18,6.37],2.1)},s=function(t,e){return a(t,e,[6.1,10.4,13],1.42)};function u(t){for(var e=0;e<t.length();++e)o(t,e)?t.residueAt(e).setSS("H"):s(t,e)?t.residueAt(e).setSS("E"):t.residueAt(e).setSS("C")}return{Mol:z.Mol,MolView:z.MolView,assignHelixSheet:function(t){console.time("mol.assignHelixSheet");for(var e=t.chains(),r=0;r<e.length;++r)e[r].eachBackboneTrace(u);console.timeEnd("mol.assignHelixSheet")},superpose:e.superpose,matchResiduesByIndex:e.matchResiduesByIndex,matchResiduesByNum:e.matchResiduesByNum}}(I),P=function(e){var r=t.vec3,n=t.mat4;function i(){this._assemblies={},this._current=null}function a(t){if(" "!==t[0]){var e=t.trim();if(4===e.length){for(var r=0,n=e.charCodeAt(r);r<4&&(n<65||n>122||n>90&&n<97);)++r,n=e.charCodeAt(r);return e[r]}var i=e.charCodeAt(0);return i>=48&&i<=57?e[1]:e.substr(0,2)}return t[1]}function o(t){this._helices=[],this._sheets=[],this._conect=[],this._serialToAtomMap={},this._structure=new z.Mol,this._remark350Reader=new i,this._currChain=null,this._currRes=null,this._currAtom=null,this._options={},this._options.conectRecords=!!t.conectRecords}function s(t){return t.split(/\r\n|\r|\n/g)}function u(t,e){console.time("pdb");for(var r=e||{},n=s(t),i=new o(r),a=[],u=0;u<n.length;u++){var l=i.processLine(n[u]);if(l===i.ERROR)return console.timeEnd("pdb"),null;if(l!==i.CONTINUE){var h=i.finish();if(null!==h&&a.push(h),l!==i.MODEL_COMPLETE||!r.loadAllModels)break}}var c=i.finish();return null!==c&&a.push(c),console.timeEnd("pdb"),r.loadAllModels?a:a[0]}function l(){this._structure=new z.Mol,this._reset(),this._sawEnd=!1}function h(t){console.time("sdf");for(var e=new l,r=s(t),n=0;n<r.length&&e.processLine(r[n]);n++);var i=e.finish();return console.timeEnd("sdf"),i}function c(t,e){var r=new XMLHttpRequest;r.open("GET",t,!0),r.onload=function(){r.response&&e(r.response)},r.send(null)}return i.prototype={assemblies:function(){var t=[];for(var e in this._assemblies)this._assemblies.hasOwnProperty(e)&&t.push(this._assemblies[e]);return t},assembly:function(t){return this._assemblies[t]},nextLine:function(t){if("B"===(t=t.substr(11))[0]&&"BIOMOLECULE:"===t.substr(0,12)){var r=t.substr(13).trim();return this._currentAssembly=new e.Assembly(r),void(this._assemblies[r]=this._currentAssembly)}if("APPLY THE FOLLOWING TO CHAINS:"!==t.substr(0,30)&&"                   AND CHAINS:"!==t.substr(0,30)){if("  BIOMT"===t.substr(0,7)){for(var i=parseInt(t[7],10)-1,a=0;" "!==t[12+a];)a+=1;var o=parseFloat(t.substr(13+a,9)),s=parseFloat(t.substr(23+a,9)),u=parseFloat(t.substr(33+a,9)),l=parseFloat(t.substr(43+a,14));return this._currentMatrix[0+i]=o,this._currentMatrix[4+i]=s,this._currentMatrix[8+i]=u,this._currentMatrix[12+i]=l,void(2===i&&(this._currentSymGen.addMatrix(this._currentMatrix),this._currentMatrix=n.create()))}}else{var h=t.substr(30).split(",");"A"===t[0]&&(this._currentSymGen=new e.SymGenerator,this._currentAssembly.addGenerator(this._currentSymGen)),this._currentMatrix=n.create();for(var c=0;c<h.length;++c){var d=h[c].trim();d.length&&this._currentSymGen.addChain(d)}}}},o.prototype={CONTINUE:1,MODEL_COMPLETE:2,FILE_END:3,ERROR:4,parseHelixRecord:function(t){var e=parseInt(t.substr(21,4),10),r=" "===t[25]?"\0":t[25],n=parseInt(t.substr(33,4),10),i=" "===t[37]?"\0":t[37],a=t[19];return this._helices.push({first:[e,r],last:[n,i],chainName:a}),!0},parseSheetRecord:function(t){var e=parseInt(t.substr(22,4),10),r=" "===t[26]?"\0":t[26],n=parseInt(t.substr(33,4),10),i=" "===t[37]?"\0":t[37],a=t[21];return this._sheets.push({first:[e,r],last:[n,i],chainName:a}),!0},parseAndAddAtom:function(t){var e=t[16];if(" "!==e&&"A"!==e)return!0;var n="H"===t[0],i=t[21],o=t.substr(17,3).trim(),s=t.substr(12,4),u=s.trim(),l=parseInt(t.substr(22,4),10);l!=l&&(l=1);var h=" "===t[26]?"\0":t[26],c=!1,d=!1;this._currChain&&this._currChain.name()===i||(d=!0,c=!0),this._currRes&&this._currRes.num()===l&&this._currRes.insCode()===h||(c=!0),d&&(this._currChain=this._structure.chain(i)||this._structure.addChain(i)),c&&(this._currRes=this._currChain.addResidue(o,l,h));for(var f=r.create(),_=0;_<3;++_)f[_]=parseFloat(t.substr(30+8*_,8));var m=t.substr(76,2).trim();""===m&&(m=a(s));var v=parseFloat(t.substr(54,6).trim()),p=parseFloat(t.substr(60,6).trim()),g=this._currRes.addAtom(u,f,m,n,isNaN(v)?null:v,isNaN(p)?null:p);if(this._options.conectRecords){var b=parseInt(t.substr(6,5).trim(),10);this._serialToAtomMap[b]=g}return!0},parseConectRecord:function(t){for(var e=parseInt(t.substr(6,5).trim(),10),r=[],n=0;n<4;++n){var i=parseInt(t.substr(11+5*n,6).trim(),10);isNaN(i)||i>e||r.push(i)}return this._conect.push({from:e,to:r}),!0},processLine:function(t){var e=t.substr(0,6);return"ATOM  "===e||"HETATM"===e?this.parseAndAddAtom(t)?this.CONTINUE:this.ERROR:"REMARK"===e?("350"===t.substr(7,3)&&this._remark350Reader.nextLine(t),this.CONTINUE):"HELIX "===e?this.parseHelixRecord(t)?this.CONTINUE:this.ERROR:"SHEET "===e?this.parseSheetRecord(t)?this.CONTINUE:this.ERROR:this._options.conectRecords&&"CONECT"===e?this.parseConectRecord(t)?this.CONTINUE:this.ERROR:"END   "===e?this.FILE_END:"ENDMDL"===e?this.MODEL_COMPLETE:this.CONTINUE},finish:function(){if(null===this._currChain)return null;var t,e=null;for(t=0;t<this._sheets.length;++t){var r=this._sheets[t];(e=this._structure.chain(r.chainName))&&e.assignSS(r.first,r.last,"E")}for(t=0;t<this._helices.length;++t){var n=this._helices[t];(e=this._structure.chain(n.chainName))&&e.assignSS(n.first,n.last,"H")}this._structure.setAssemblies(this._remark350Reader.assemblies()),this._options.conectRecords&&this._assignBondsFromConectRecords(this._structure),this._structure.deriveConnectivity(),console.log("imported",this._structure.chains().length,"chain(s),",this._structure.residueCount(),"residue(s)");var i=this._structure;return this._structure=new z.Mol,this._currChain=null,this._currRes=null,this._currAtom=null,i},_assignBondsFromConectRecords:function(t){for(var e=0;e<this._conect.length;++e)for(var r=this._conect[e],n=this._serialToAtomMap[r.from],i=0;i<r.to.length;++i){var a=this._serialToAtomMap[r.to[i]];t.connect(n,a)}}},l.prototype={processLine:function(t){var e=this._state;if(e<3){if(0===e){var r=t.trim();if(0===r.length)return!1;this._title=r}return this._sawEnd=!1,this._state++,!0}if(3===e){if(this._expectedAtomCount=parseInt(t.substr(0,3).trim(),10),this._expectedBondCount=parseInt(t.substr(3,3).trim(),10),isNaN(this._expectedAtomCount)||isNaN(this._expectedBondCount))return console.error("invalid bond definition"),!1;this._state++;var n=""+(this._structure.chains().length+1);this._currentChain=this._structure.addChain(n),this._currentResidue=this._currentChain.addResidue(this._title,1)}if(4===e){for(var i=[0,0,0],a=0;a<3;++a)if(i[a]=parseFloat(t.substr(10*a,10).trim()),isNaN(i[a]))return console.error("invalid atom position"),!1;var o=t.substr(31,3).trim();this._currentResidue.addAtom(o,i,o,!1),this._atomCount++,this._atomCount===this._expectedAtomCount&&this._state++}if(5===e){var s=parseInt(t.substr(0,3).trim(),10)-1,u=parseInt(t.substr(3,3).trim(),10)-1;if(isNaN(s)||isNaN(u))return console.error("invalid bond definition"),!1;var l=this._currentResidue.atoms();this._structure.connect(l[s],l[u]),this._bondCount++,this._bondCount===this._expectedBondCount&&this._state++}return"M  END"===t.substr(0,6)&&(this._sawEnd=!0,this._state++),"$$$$"===t.substr(0,4)&&this._reset(),!0},_reset:function(){this._state=0,this._currentResidue=null,this._currentChain=null,this._expectedAtomCount=null,this._expectedBondount=null,this._atomCount=0,this._bondCount=0,this._title=""},finish:function(){return this._sawEnd?this._structure:(console.error("truncated SDF file"),null)}},{pdb:u,sdf:h,Remark350Reader:i,fetchPdb:function(t,e,r){c(t,(function(t){var n=u(t,r);e(n)}))},fetchSdf:function(t,e){c(t,(function(t){var r=h(t);e(r)}))},guessAtomElementFromName:a}}(w),L=function(){var e,r,n,i,a,o,s,u,l,h,d,f=t.vec3,_=t.mat3,m=(e=f.create(),r=f.create(),function(t,n){f.set(e,0,0,0);var i=0;t.eachCentralAtom((function(t,r){f.add(e,e,r),i+=1})),0!==i&&(f.scale(e,e,1/i),n[0]=0,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=0,n[6]=0,n[7]=0,n[8]=0,t.eachCentralAtom((function(t,i){f.sub(r,i,e);var a=r[0],o=r[1],s=r[2];n[0]+=o*o+s*s,n[1]-=a*o,n[2]-=a*s,n[5]-=o*s,n[4]+=a*a+s*s,n[8]+=a*a+o*o})),n[3]=n[1],n[6]=n[2],n[7]=n[5])});return{principalAxes:(n=_.create(),i=_.create(),a=f.create(),o=f.create(),s=f.create(),u=f.create(),l=f.create(),h=f.create(),d=f.create(),function(t){m(t,n);var e=c.diagonalizer(n);_.fromQuat(i,e);var r=!0;t.eachCentralAtom((function(t,e){f.transformMat3(s,e,i),r?(f.copy(a,s),f.copy(o,s),r=!1):(f.min(a,a,s),f.max(o,o,s))})),f.sub(u,o,a);var v=[[u[0],0],[u[1],1],[u[2],2]];v.sort((function(t,e){return e[0]-t[0]}));var p=v[0][1],g=v[1][1];f.set(l,i[p+0],i[p+3],i[p+6]),f.set(h,i[g+0],i[g+3],i[g+6]),f.cross(d,l,h);var b=_.create();return b[0]=l[0],b[1]=h[0],b[2]=d[0],b[3]=l[1],b[4]=h[1],b[5]=d[1],b[6]=l[2],b[7]=h[2],b[8]=d[2],b})}}(),{Viewer:C.Viewer,isWebGLSupported:C.isWebGLSupported,io:P,color:e,mol:z,rgb:{setColorPalette:e.setColorPalette,hex2rgb:e.hex2rgb},vec3:t.vec3,vec4:t.vec4,mat3:t.mat3,mat4:t.mat4,quat:t.quat,viewpoint:L}})?n.apply(e,i):n)||(t.exports=a)},function(t,e){t.exports=window.ReactDOM},function(t,e){var r=function(t){return{description:"For a given Gene (or List of Genes) returns the corresponding Protein(s) products.",from:"Gene",select:["primaryIdentifier","symbol","proteins.primaryIdentifier","proteins.primaryAccession","proteins.name","proteins.length"],where:[{path:"Gene.id",op:"=",value:t}]}};t.exports=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:imjs;return new Promise((function(i,a){new n.Service({root:e}).records(r(t)).then((function(t){t.length?i(t[0]):a("No associated proteins found.")})).catch(a)}))}},function(t,e){t.exports=function(t,e){return e||(e=window.fetch),e("https://search.rcsb.org/rcsbsearch/v1/query?json=".concat(encodeURIComponent(JSON.stringify({query:{type:"group",logical_operator:"and",nodes:[{type:"terminal",service:"text",parameters:{operator:"exact_match",value:t,attribute:"rcsb_polymer_entity_container_identifiers.reference_sequence_identifiers.database_accession"}},{type:"terminal",service:"text",parameters:{operator:"exact_match",value:"UniProt",attribute:"rcsb_polymer_entity_container_identifiers.reference_sequence_identifiers.database_name"}}]},return_type:"entry"})))).then((function(e){if(200!==e.status)throw"PDB returned no entities for UniProtKB accession "+t;return e.json()})).then((function(t){return t.result_set.map((function(t){return t.identifier})).filter((function(t){return 4===String(t).length}))}))}},function(t,e){var r=function(t){return{description:"for a specified protein give its identifer and accession.",from:"Protein",select:["primaryAccession","canonicalProtein.primaryAccession"],joins:["canonicalProtein"],where:[{path:"Protein.id",op:"=",value:t}]}};t.exports=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:imjs;return new Promise((function(i,a){new n.Service({root:e}).records(r(t)).then((function(t){t.length?i(t[0]):a("Protein not found.")})).catch(a)}))}},function(t,e,r){"use strict";r.r(e),r.d(e,"main",(function(){return x}));var n=r(0),i=r.n(n),a=r(2),o=r.n(a),s=r(1),u=r.n(s);var l=function(t){var e=t.text;return i.a.createElement("div",{className:"loading-container"},i.a.createElement("span",{className:"loading-text"},e),i.a.createElement("div",{className:"loading"},i.a.createElement("div",null,i.a.createElement("span",null),i.a.createElement("span",null),i.a.createElement("span",null),i.a.createElement("span",null))))},h=r(3),c=r.n(h),d=r(4),f=r.n(d),_=r(5),m=r.n(_),v=[["#FFFFFF","hydrogen (H)"],["#000000","carbon (C)"],["#2233FF","nitrogen (N)"],["#FF2200","oxygen (O)"],["#1FF01F","fluorine (F), chlorine (Cl)"],["#992200","bromine (Br)"],["#6600BB","iodine (I)"],["#00FFFF","noble gases (He, Ne, Ar, Xe, Kr)"],["#FF9900","phosphorus (P)"],["#FFE522","sulfur (S)"],["#FFAA77","boron (B), most transition metals"],["#7700FF","alkali metals (Li, Na, K, Rb, Cs, Fr)"],["#007700","alkaline earth metals (Be, Mg, Ca, Sr, Ba, Ra)"],["#999999","titanium (Ti)"],["#DD7700","iron (Fe)"],["#DD77FF","other elements"]],p=[["#FF0080","α helix"],["#A00080","3".concat("₁₀"," helix")],["#600080","π helix"],["#FFC800","β strand"],["#6080FF","(β) turn"],["#FFFFFF","other"],["#AE00FE","DNA"],["#FD0162","RNA"],["#A6A6FA","Carbohydrate"],["#808080","other"]],g=function(t){var e="uniform"==t.colorMode?v:p;return React.createElement("div",{className:"color-table"},React.createElement("table",null,React.createElement("tbody",null,e.map((function(t){return React.createElement("tr",{className:"color-table-row"},React.createElement("td",null,React.createElement("div",{className:"color-table-box",style:{background:t[0]}})),React.createElement("td",null,t[1]))})))))};function b(t){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function A(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function y(t,e){return(y=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function S(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=w(t);if(e){var i=w(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return R(this,r)}}function R(t,e){return!e||"object"!==b(e)&&"function"!=typeof e?C(t):e}function C(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function w(t){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function E(t){return null!==t.match(/^([OPQ][0-9][A-Z0-9]{3}[0-9]|[A-NR-Z][0-9]([A-Z][A-Z0-9]{2}[0-9]){1,2})$/)}var T=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&y(t,e)}(o,t);var e,r,n,a=S(o);function o(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(e=a.call(this,t)).visualizer=i.a.createRef(),e.state={structureReady:!0,pdbIds:null,filteredPdbIds:null,selectedId:0,viewerMode:"cartoon",colorMode:"uniform",error:null,searchedId:"",hoveredId:null},e.initVisualizer=e.initVisualizer.bind(C(e)),e.handleSearch=e.handleSearch.bind(C(e)),e.fetchTitle=e.fetchTitle.bind(C(e)),e}return e=o,(r=[{key:"componentDidMount",value:function(){var t=this,e=this.props,r=e.entity,n=r.value,i=r.class,a=e.serviceUrl;if(!e.testing){this.setState({structureReady:!1});var o=function(e){f()(e).then((function(e){t.setState({pdbIds:e,filteredPdbIds:e}),t.initVisualizer(e),t.fetchTitle(e[0])})).catch((function(e){e="string"==typeof e?e:"Failed to reach PDB. Please try again later.",t.setState({error:e})}))};"Protein"===i?m()(n,a).then((function(t){o(t.canonicalProtein&&t.canonicalProtein.primaryAccession||t.primaryAccession)})):c()(n,a).then((function(t){var e=t.proteins.map((function(t){return t.primaryAccession}));e.sort((function(t,e){return t.length-e.length}));var r=e.filter(E),n=r.filter((function(t){return t.startsWith("P")}));o(n[0]||r[0]||e[0])})).catch((function(e){return t.setState({error:e})}))}}},{key:"initVisualizer",value:function(t,e){var r=this,n=this.state,i=n.colorMode,a=n.viewerMode,o=n.pdbIds,s=n.selectedId;t||(t=o),e||(e=s),u.a.io.fetchPdb("https://files.rcsb.org/download/".concat(t[e],".pdb"),(function(t){if(!t)return r.setState({error:"No structure found in RCSB Protein Data Bank"});r.setState({structureReady:!0},(function(){var e=r.visualizer.current;e.innerHTML="";var n=u.a.Viewer(e,{quality:"medium",antialias:!0,outline:!1,slabMode:"auto"}),o=n.renderAs("structure",t,a,{color:"uniform"===i?u.a.color.ssSuccession():u.a.color.bySS(),showRelated:"1"}),s=u.a.viewpoint.principalAxes(o);n.setRotation(s),n.autoZoom()}))}))}},{key:"updateSelected",value:function(t){this.setState({selectedId:t,focusedIdTitle:"",detailsLoading:!0});var e=this.state.filteredPdbIds[t];this.fetchTitle(e),this.visualizer.current.innerHTML="",this.setState({structureReady:!1}),this.initVisualizer(null,t)}},{key:"fetchTitle",value:function(t){var e=this;fetch("https://data.rcsb.org/graphql?query=".concat(encodeURIComponent('{entry(entry_id:"'.concat(t,'"){struct{title}}}')))).then((function(t){return t.json()})).then((function(t){return e.setState({detailsLoading:!1,focusedIdTitle:t.data.entry.struct.title})}))}},{key:"changeViewerMode",value:function(t){var e=this;this.setState({viewerMode:t.target.value},(function(){e.visualizer.current.innerHTML="",e.setState({structureReady:!1}),e.initVisualizer()}))}},{key:"changeColoringMode",value:function(t){this.setState({colorMode:t.target.value},this.initVisualizer)}},{key:"handleSearch",value:function(t){var e=this,r=t.target.value;this.setState({filteredPdbIds:this.state.pdbIds.filter((function(t){return-1!==t.toLowerCase().indexOf(r.toLowerCase())}))},(function(){return e.fetchTitle(e.state.filteredPdbIds[0])}))}},{key:"render",value:function(){var t,e=this;this.state.filteredPdbIds&&(t=this.state.filteredPdbIds.map((function(t,r){return i.a.createElement("div",{key:r},i.a.createElement("div",{className:"option ".concat(e.state.selectedId==r&&"selected"),onClick:function(){return e.updateSelected(r)}},t),e.state.selectedId===r&&i.a.createElement("div",{className:"details-panel"},e.state.detailsLoading?i.a.createElement(l,null):i.a.createElement(i.a.Fragment,null,i.a.createElement("span",null,e.state.focusedIdTitle),i.a.createElement("a",{href:"https://www.rcsb.org/structure/".concat(t),rel:"noopener noreferrer",target:"_blank",className:"pdb-link"},"open PDB page"))))})));var r=["sline","lines","trace","lineTrace","cartoon","tube","spheres"].map((function(t){return i.a.createElement("option",{key:t,value:t},t)})),n=["uniform","By Secondary Structure"].map((function(t){return i.a.createElement("option",{key:t,value:t},t)}));return this.state.error?i.a.createElement("div",{className:"viz-container error"},this.state.error):t?i.a.createElement("div",{className:"rootContainer"},this.state.structureReady?i.a.createElement("div",{className:"viz-container",ref:this.visualizer}):i.a.createElement("div",{className:"viz-container"},i.a.createElement(l,{text:"Initialising Visualizer..."})),i.a.createElement("div",{className:"select-box"},i.a.createElement("div",{className:"input-row"},i.a.createElement("span",{className:"heading"},"Select viewer:"),i.a.createElement("select",{placeholder:"Select viewer mode",className:"viewer-select",value:this.state.viewerMode,onChange:this.changeViewerMode.bind(this)},r)),i.a.createElement("div",{className:"input-row"},i.a.createElement("span",{className:"heading"},"Select coloring:"),i.a.createElement("select",{placeholder:"Select coloring mode",className:"viewer-select",value:this.state.colorMode,onChange:this.changeColoringMode.bind(this)},n)),i.a.createElement("input",{className:"heading",placeholder:"Filter PDB entities",onChange:this.handleSearch}),i.a.createElement("div",{className:"structure-list"},t.length?t:"No search results!"),i.a.createElement("div",null,i.a.createElement(g,{colorMode:this.state.colorMode})))):i.a.createElement("div",{className:"rootContainer"},i.a.createElement(l,{text:"Fetching associated PDB entities"}))}}])&&A(e.prototype,r),n&&A(e,n),o}(i.a.Component);function x(t,e,r,n,a){if(n||(n={}),!(t&&e&&r&&n&&a))throw new Error("Call main with correct signature");o.a.render(i.a.createElement(T,{serviceUrl:e.root,entity:r.Protein||r.Gene,config:a,testing:n.testing}),t)}}]);